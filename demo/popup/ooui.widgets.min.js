!function(OO){"use strict";var n;OO.ui={},OO.ui.bind=$.proxy,OO.ui.Keys={UNDEFINED:0,BACKSPACE:8,DELETE:46,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,SHIFT:16,SPACE:32},OO.ui.MouseButtons={LEFT:1,MIDDLE:2,RIGHT:3},OO.ui.elementId=0,OO.ui.generateElementId=function(){return OO.ui.elementId++,"ooui-"+OO.ui.elementId},OO.ui.isFocusableElement=function(t){var e,i=t[0];return!i.disabled&&(!(!$.expr.pseudos.visible(i)||t.parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length)&&("true"===i.contentEditable||(0<=t.prop("tabIndex")||(e=i.nodeName.toLowerCase(),-1!==["input","select","textarea","button","object"].indexOf(e)||("a"===e||"area"===e)&&void 0!==t.attr("href")))))},OO.ui.findFocusable=function(t,e){var i=$([]),n=t.find("input, select, textarea, button, object, a, area, [contenteditable], [tabindex]");return e&&(n=Array.prototype.reverse.call(n)),n.each(function(){var t=$(this);if(OO.ui.isFocusableElement(t))return i=t,!1}),i},OO.ui.getUserLanguages=function(){return["en"]},OO.ui.getLocalValue=function(t,e,i){var n,o,s;if(t[e])return t[e];for(n=0,o=(s=OO.ui.getUserLanguages()).length;n<o;n++)if(t[e=s[n]])return t[e];if(t[i])return t[i];for(e in t)return t[e]},OO.ui.contains=function(t,e,i){var n;for(Array.isArray(t)||(t=[t]),n=t.length-1;0<=n;n--)if(i&&e===t[n]||$.contains(t[n],e))return!0;return!1},OO.ui.debounce=function(i,n,o){var s;return function(){var t=this,e=arguments;o&&!s&&i.apply(t,e),s&&!n||(clearTimeout(s),s=setTimeout(function(){s=null,o||i.apply(t,e)},n))}},OO.ui.warnDeprecation=function(t){void 0!==OO.getProp(window,"console","warn")&&console.warn(t)},OO.ui.throttle=function(t,e){function i(){s=null,l=Date.now(),t.apply(n,o)}var n,o,s,l=0;return function(){var t=e-(Date.now()-l);n=this,o=arguments,t<=0?(clearTimeout(s),i()):s=s||setTimeout(i,t)}},OO.ui.now=function(){return OO.ui.warnDeprecation("OO.ui.now() is deprecated, use Date.now() instead"),Date.now()},OO.ui.infuse=function(t,e){return OO.ui.Element.static.infuse(t,e)},OO.ui.msg=function(t){var e=OO.ui.msg.messages[t],n=Array.prototype.slice.call(arguments,1);return e="string"==typeof e?e.replace(/\$(\d+)/g,function(t,e){var i=parseInt(e,10);return void 0!==n[i-1]?n[i-1]:"$"+e}):"["+t+"]"},OO.ui.deferMsg=function(){var t=arguments;return function(){return OO.ui.msg.apply(OO.ui,t)}},OO.ui.resolveMsg=function(t){return"function"==typeof t?t():t},OO.ui.isSafeUrl=function(t){var e,i;function n(t,e){return t.substr(0,e.length)===e}if(i=["bitcoin","ftp","ftps","geo","git","gopher","http","https","irc","ircs","magnet","mailto","mms","news","nntp","redis","sftp","sip","sips","sms","ssh","svn","tel","telnet","urn","worldwind","xmpp"],""===t)return!0;for(e=0;e<i.length;e++)if(n(t,i[e]+":"))return!0;return!(!n(t,"/")&&!n(t,"./"))||!(!n(t,"?")&&!n(t,"#"))},OO.ui.isMobile=function(){return!1},OO.ui.getViewportSpacing=function(){return{top:0,right:0,bottom:0,left:0}},OO.ui.getDefaultOverlay=function(){return OO.ui.$defaultOverlay||(OO.ui.$defaultOverlay=$("<div>").addClass("oo-ui-defaultOverlay"),$(document.body).append(OO.ui.$defaultOverlay)),OO.ui.$defaultOverlay},OO.ui.msg.messages={"ooui-outline-control-move-down":"Move item down","ooui-outline-control-move-up":"Move item up","ooui-outline-control-remove":"Remove item","ooui-toolbar-more":"More","ooui-toolgroup-expand":"More","ooui-toolgroup-collapse":"Fewer","ooui-item-remove":"Remove","ooui-dialog-message-accept":"OK","ooui-dialog-message-reject":"Cancel","ooui-dialog-process-error":"Something went wrong","ooui-dialog-process-dismiss":"Dismiss","ooui-dialog-process-retry":"Try again","ooui-dialog-process-continue":"Continue","ooui-combobox-button-label":"Dropdown for combobox","ooui-selectfile-button-select":"Select a file","ooui-selectfile-not-supported":"File selection is not supported","ooui-selectfile-placeholder":"No file is selected","ooui-selectfile-dragdrop-placeholder":"Drop file here","ooui-field-help":"Help"},OO.ui.mixin={},OO.ui.Element=function(t){OO.ui.isDemo&&(this.initialConfig=t),t=t||{},this.$=function(){return OO.ui.warnDeprecation("this.$ is deprecated, use global $ instead"),$.apply(this,arguments)},this.elementId=null,this.visible=!0,this.data=t.data,this.$element=t.$element||$(document.createElement(this.getTagName())),this.elementGroup=null,Array.isArray(t.classes)&&this.$element.addClass(t.classes),t.id&&this.setElementId(t.id),t.text&&this.$element.text(t.text),t.content&&this.$element.append(t.content.map(function(t){return"string"==typeof t?t?document.createTextNode(t):void 0:t instanceof OO.ui.HtmlSnippet?t.toString():t instanceof OO.ui.Element?t.$element:t})),t.$content&&this.$element.append(t.$content)},OO.initClass(OO.ui.Element),OO.ui.Element.static.tagName="div",OO.ui.Element.static.infuse=function(t,e){var i=OO.ui.Element.static.unsafeInfuse(t,e,!1);return"string"==typeof t&&OO.ui.warnDeprecation("Passing a string ID to infuse is deprecated. Use an HTMLElement or jQuery collection instead."),i},OO.ui.Element.static.unsafeInfuse=function(t,i,n){var e,o,s,l,u,a,r,h,d,p,c;if("string"==typeof t?(e=t,o=$(document.getElementById(e))):e=(o=$(t)).attr("id"),!o.length)throw s="string"==typeof t?"Widget not found: "+t:t&&t.selector?"Widget not found: "+t.selector:"Widget not found",new Error(s);if(o[0].oouiInfused&&(o=o[0].oouiInfused),l=o.data("ooui-infused")){if(!0===l)throw new Error("Circular dependency! "+e);return n&&(p=l.constructor.static.gatherPreInfuseState(o,l),n.done(l.restorePreInfuseState.bind(l,p)),(c=o.data("ooui-infused-children"))&&c.length&&c.forEach(function(t){var e=t.constructor.static.gatherPreInfuseState(o,t);n.done(t.restorePreInfuseState.bind(t,e))})),l}if(!(l=o.attr("data-ooui")))throw new Error("No infusion data found: "+e);try{l=JSON.parse(l)}catch(t){l=null}if(!l||!l._)throw new Error("No valid infusion data found: "+e);if("Tag"===l._)return new OO.ui.Element($.extend({},i,{$element:o}));if(a=l._.split("."),void 0===(u=OO.getProp.apply(OO,[window].concat(a))))throw new Error("Unknown widget type: id: "+e+", class: "+l._);for(r=u.parent;void 0!==r&&r!==OO.ui.Element;)r=r.parent;if(r!==OO.ui.Element)throw new Error("Unknown widget type: id: "+e+", class: "+l._);return n||(d=$.Deferred(),n=d.promise()),o.data("ooui-infused",!0),l.id=e,c=[],l=OO.copy(l,null,function(t){var e;if(OO.isPlainObject(t)){if(t.tag)return e=OO.ui.Element.static.unsafeInfuse(t.tag,i,n),c.push(e),c.push.apply(c,e.$element.data("ooui-infused-children")||[]),e.$element.removeData("ooui-infused-children"),e;if(void 0!==t.html)return new OO.ui.HtmlSnippet(t.html)}}),l=u.static.reusePreInfuseDOM(o[0],l),p=u.static.gatherPreInfuseState(o[0],l),h=new u($.extend({},i,l)),o[0].oouiInfused=h.$element,d&&(o[0]!==h.$element[0]&&o.replaceWith(h.$element),d.resolve()),h.$element.data("ooui-infused",h),h.$element.data("ooui-infused-children",c),h.$element.attr("data-ooui",""),n.done(h.restorePreInfuseState.bind(h,p)),h},OO.ui.Element.static.reusePreInfuseDOM=function(t,e){return e},OO.ui.Element.static.gatherPreInfuseState=function(){return{}},OO.ui.Element.static.getJQuery=function(t,e){function i(t){return $(t,i.context)}return i.context=this.getDocument(t),e&&(i.$iframe=e),i},OO.ui.Element.static.getDocument=function(t){return t[0]&&t[0].ownerDocument||t.context||t.ownerDocument||t.document||t.nodeType===Node.DOCUMENT_NODE&&t||null},OO.ui.Element.static.getWindow=function(t){return this.getDocument(t).defaultView},OO.ui.Element.static.getDir=function(t){var e,i;return t instanceof $&&(t=t[0]),e=t.nodeType===Node.DOCUMENT_NODE,i=void 0!==t.document,(e||i)&&(i&&(t=t.document),t=t.body),$(t).css("direction")},OO.ui.Element.static.getFrameOffset=function(t,e,i){var n,o,s,l,u;if(e=e||window,i=i||{top:0,left:0},t.parent===t)return i;for(n=0,o=(s=t.parent.document.getElementsByTagName("iframe")).length;n<o;n++)if(s[n].contentWindow===t){l=s[n];break}return l&&(u=l.getBoundingClientRect(),i.left+=u.left,i.top+=u.top,t!==e&&this.getFrameOffset(t.parent,i)),i},OO.ui.Element.static.getRelativePosition=function(t,e){for(var i,n,o=t.offset(),s=e.offset(),l=this.getDocument(t),u=this.getDocument(e);l!==u;){if(!(i=l.defaultView.frameElement))throw new Error("$element frame is not contained in $anchor frame");n=$(i).offset(),o.left+=n.left,o.top+=n.top,l=i.ownerDocument}return o.left-=s.left,o.top-=s.top,o},OO.ui.Element.static.getBorders=function(t){var e=t.ownerDocument.defaultView.getComputedStyle(t,null),i=$(t);return{top:parseFloat(e?e.borderTopWidth:i.css("borderTopWidth"))||0,left:parseFloat(e?e.borderLeftWidth:i.css("borderLeftWidth"))||0,bottom:parseFloat(e?e.borderBottomWidth:i.css("borderBottomWidth"))||0,right:parseFloat(e?e.borderRightWidth:i.css("borderRightWidth"))||0}},OO.ui.Element.static.getDimensions=function(t){var e,i,n=t.ownerDocument||t.document,o=n.defaultView;return o===t||t===n.documentElement?{borders:{top:0,left:0,bottom:0,right:0},scroll:{top:(i=$(o)).scrollTop(),left:i.scrollLeft()},scrollbar:{right:0,bottom:0},rect:{top:0,left:0,bottom:i.innerHeight(),right:i.innerWidth()}}:(e=$(t),{borders:this.getBorders(t),scroll:{top:e.scrollTop(),left:e.scrollLeft()},scrollbar:{right:e.innerWidth()-t.clientWidth,bottom:e.innerHeight()-t.clientHeight},rect:t.getBoundingClientRect()})},OO.ui.Element.static.getScrollLeft=(n=null,function(t){var e=t.window===t||t===t.ownerDocument.body||t===t.ownerDocument.documentElement,i=e?$(window).scrollLeft():t.scrollLeft;return"rtl"===(e?"ltr":$(t).css("direction"))&&(null===n&&function(){var t=$("<div>").attr({dir:"rtl",style:"font-size: 14px; width: 4px; height: 1px; position: absolute; top: -1000px; overflow: scroll;"}).text("ABCD"),e=t[0];t.appendTo("body"),n=0<e.scrollLeft?"default":(e.scrollLeft=1,0===e.scrollLeft?"negative":"reverse"),t.remove()}(),"reverse"===n?i=-i:"default"===n&&(i=i-t.scrollWidth+t.clientWidth)),i}),OO.ui.Element.static.getRootScrollableElement=function(t){var e,i;return void 0===OO.ui.scrollableElement&&(e=(i=t.ownerDocument.body).scrollTop,(i.scrollTop=1)===Math.round(i.scrollTop)?(i.scrollTop=e,OO.ui.scrollableElement="body"):OO.ui.scrollableElement="documentElement"),t.ownerDocument[OO.ui.scrollableElement]},OO.ui.Element.static.getClosestScrollableContainer=function(t,e){var i,n,o=["overflow-x","overflow-y"],s=$(t).parent();if("x"!==e&&"y"!==e||(o=["overflow-"+e]),$(t).is("html, body"))return this.getRootScrollableElement(t);for(;s.length;){if(s[0]===this.getRootScrollableElement(t))return s[0];for(i=o.length;i--;)if("auto"===(n=s.css(o[i]))||"scroll"===n)return s[0];s=s.parent()}return this.getRootScrollableElement(t)},OO.ui.Element.static.scrollIntoView=function(t,e){var i,n,o,s,l,u,a,r,h,d,p=$.Deferred();if(e=e||{},r=$.extend({top:0,bottom:0,left:0,right:0},e.padding),h=!1!==e.animate,n={},l=t instanceof HTMLElement?this.getDimensions(t).rect:t,o=e.scrollContainer||(t instanceof HTMLElement?this.getClosestScrollableContainer(t,e.direction):this.getClosestScrollableContainer(document.body)),s=$(o),u=this.getDimensions(o),a=$(this.getWindow(o)),i=s.is("html, body")?{top:l.top,bottom:a.innerHeight()-l.bottom,left:l.left,right:a.innerWidth()-l.right}:{top:l.top-(u.rect.top+u.borders.top),bottom:u.rect.bottom-u.borders.bottom-u.scrollbar.bottom-l.bottom,left:l.left-(u.rect.left+u.borders.left),right:u.rect.right-u.borders.right-u.scrollbar.right-l.right},e.direction&&"y"!==e.direction||(i.top<r.top?n.scrollTop=u.scroll.top+i.top-r.top:i.bottom<r.bottom&&(n.scrollTop=u.scroll.top+Math.min(i.top-r.top,-i.bottom+r.bottom))),e.direction&&"x"!==e.direction||(i.left<r.left?n.scrollLeft=u.scroll.left+i.left-r.left:i.right<r.right&&(n.scrollLeft=u.scroll.left+Math.min(i.left-r.left,-i.right+r.right))),$.isEmptyObject(n))p.resolve();else if(h)s.stop(!0).animate(n,void 0===e.duration?"fast":e.duration),s.queue(function(t){p.resolve(),t()});else{for(d in s.stop(!0),n)s[d](n[d]);p.resolve()}return p.promise()},OO.ui.Element.static.reconsiderScrollbars=function(t){var e,i,n,o,s=[];for(n=t.scrollLeft,o=t.scrollTop;t.firstChild;)s.push(t.firstChild),t.removeChild(t.firstChild);for(t.offsetHeight,e=0,i=s.length;e<i;e++)t.appendChild(s[e]);t.scrollLeft=n,t.scrollTop=o},OO.ui.Element.prototype.toggle=function(t){return(t=void 0===t?!this.visible:!!t)!==this.isVisible()&&(this.visible=t,this.$element.toggleClass("oo-ui-element-hidden",!this.visible),this.emit("toggle",t)),this},OO.ui.Element.prototype.isVisible=function(){return this.visible},OO.ui.Element.prototype.getData=function(){return this.data},OO.ui.Element.prototype.setData=function(t){return this.data=t,this},OO.ui.Element.prototype.setElementId=function(t){return this.elementId=t,this.$element.attr("id",t),this},OO.ui.Element.prototype.getElementId=function(){return null===this.elementId&&this.setElementId(OO.ui.generateElementId()),this.elementId},OO.ui.Element.prototype.supports=function(t){var e,i,n=0;for(e=0,i=(t=Array.isArray(t)?t:[t]).length;e<i;e++)"function"==typeof this[t[e]]&&n++;return t.length===n},OO.ui.Element.prototype.updateThemeClasses=function(){OO.ui.theme.queueUpdateElementClasses(this)},OO.ui.Element.prototype.getTagName=function(){return this.constructor.static.tagName},OO.ui.Element.prototype.isElementAttached=function(){return $.contains(this.getElementDocument(),this.$element[0])},OO.ui.Element.prototype.getElementDocument=function(){return OO.ui.Element.static.getDocument(this.$element)},OO.ui.Element.prototype.getElementWindow=function(){return OO.ui.Element.static.getWindow(this.$element)},OO.ui.Element.prototype.getClosestScrollableElementContainer=function(){return OO.ui.Element.static.getClosestScrollableContainer(this.$element[0])},OO.ui.Element.prototype.getElementGroup=function(){return this.elementGroup},OO.ui.Element.prototype.setElementGroup=function(t){return this.elementGroup=t,this},OO.ui.Element.prototype.scrollElementIntoView=function(t){return!this.isElementAttached()||!this.isVisible()||this.getElementGroup()&&!this.getElementGroup().isVisible()?$.Deferred().resolve():OO.ui.Element.static.scrollIntoView(this.$element[0],t)},OO.ui.Element.prototype.restorePreInfuseState=function(){},OO.ui.HtmlSnippet=function(t){this.content=t},OO.initClass(OO.ui.HtmlSnippet),OO.ui.HtmlSnippet.prototype.toString=function(){return this.content},OO.ui.Layout=function(t){t=t||{},OO.ui.Layout.parent.call(this,t),OO.EventEmitter.call(this),this.$element.addClass("oo-ui-layout")},OO.inheritClass(OO.ui.Layout,OO.ui.Element),OO.mixinClass(OO.ui.Layout,OO.EventEmitter),OO.ui.Layout.prototype.resetScroll=function(){return this.$element[0].scrollTop=0,this},OO.ui.Widget=function(t){t=$.extend({disabled:!1},t),OO.ui.Widget.parent.call(this,t),OO.EventEmitter.call(this),this.disabled=null,this.wasDisabled=null,this.$element.addClass("oo-ui-widget"),this.setDisabled(!!t.disabled)},OO.inheritClass(OO.ui.Widget,OO.ui.Element),OO.mixinClass(OO.ui.Widget,OO.EventEmitter),OO.ui.Widget.prototype.isDisabled=function(){return this.disabled},OO.ui.Widget.prototype.setDisabled=function(t){var e;return this.disabled=!!t,(e=this.isDisabled())!==this.wasDisabled&&(this.$element.toggleClass("oo-ui-widget-disabled",e),this.$element.toggleClass("oo-ui-widget-enabled",!e),this.$element.attr("aria-disabled",e.toString()),this.emit("disable",e),this.updateThemeClasses()),this.wasDisabled=e,this},OO.ui.Widget.prototype.updateDisabled=function(){return this.setDisabled(this.disabled),this},OO.ui.Widget.prototype.getInputId=function(){return null},OO.ui.Widget.prototype.simulateLabelClick=function(){},OO.ui.Theme=function(){this.elementClassesQueue=[],this.debouncedUpdateQueuedElementClasses=OO.ui.debounce(this.updateQueuedElementClasses)},OO.initClass(OO.ui.Theme),OO.ui.Theme.prototype.getElementClasses=function(){return{on:[],off:[]}},OO.ui.Theme.prototype.updateElementClasses=function(t){var e=$([]),i=this.getElementClasses(t);t.$icon&&(e=e.add(t.$icon)),t.$indicator&&(e=e.add(t.$indicator)),e.removeClass(i.off).addClass(i.on)},OO.ui.Theme.prototype.updateQueuedElementClasses=function(){var t;for(t=0;t<this.elementClassesQueue.length;t++)this.updateElementClasses(this.elementClassesQueue[t]);this.elementClassesQueue=[]},OO.ui.Theme.prototype.queueUpdateElementClasses=function(t){-1===this.elementClassesQueue.lastIndexOf(t)&&(this.elementClassesQueue.push(t),this.debouncedUpdateQueuedElementClasses())},OO.ui.Theme.prototype.getDialogTransitionDuration=function(){return 0},OO.ui.mixin.TabIndexedElement=function(t){t=$.extend({tabIndex:0},t),this.$tabIndexed=null,this.tabIndex=null,this.connect(this,{disable:"onTabIndexedElementDisable"}),this.setTabIndex(t.tabIndex),this.setTabIndexedElement(t.$tabIndexed||this.$element)},OO.initClass(OO.ui.mixin.TabIndexedElement),OO.ui.mixin.TabIndexedElement.prototype.setTabIndexedElement=function(t){var e=this.tabIndex;return this.setTabIndex(null),this.$tabIndexed=t,this.tabIndex=e,this.updateTabIndex()},OO.ui.mixin.TabIndexedElement.prototype.setTabIndex=function(t){return t=/^-?\d+$/.test(t)?Number(t):null,this.tabIndex!==t&&(this.tabIndex=t,this.updateTabIndex()),this},OO.ui.mixin.TabIndexedElement.prototype.updateTabIndex=function(){return this.$tabIndexed&&(null!==this.tabIndex?this.$tabIndexed.attr({tabindex:this.isDisabled()?-1:this.tabIndex,"aria-disabled":this.isDisabled().toString()}):this.$tabIndexed.removeAttr("tabindex aria-disabled")),this},OO.ui.mixin.TabIndexedElement.prototype.onTabIndexedElementDisable=function(){this.updateTabIndex()},OO.ui.mixin.TabIndexedElement.prototype.getTabIndex=function(){return this.tabIndex},OO.ui.mixin.TabIndexedElement.prototype.getInputId=function(){var t;return this.$tabIndexed&&this.isLabelableNode(this.$tabIndexed)?(void 0===(t=this.$tabIndexed.attr("id"))&&(t=OO.ui.generateElementId(),this.$tabIndexed.attr("id",t)),t):null},OO.ui.mixin.TabIndexedElement.prototype.isLabelableNode=function(t){var e=(t.prop("tagName")||"").toLowerCase();return"input"===e&&"hidden"!==t.attr("type")||-1!==["button","meter","output","progress","select","textarea"].indexOf(e)},OO.ui.mixin.TabIndexedElement.prototype.focus=function(){return this.isDisabled()||this.$tabIndexed.trigger("focus"),this},OO.ui.mixin.TabIndexedElement.prototype.blur=function(){return this.$tabIndexed.trigger("blur"),this},OO.ui.mixin.TabIndexedElement.prototype.simulateLabelClick=function(){this.focus()},OO.ui.mixin.ButtonElement=function(t){t=t||{},this.$button=null,this.framed=null,this.active=void 0!==t.active&&t.active,this.onDocumentMouseUpHandler=this.onDocumentMouseUp.bind(this),this.onMouseDownHandler=this.onMouseDown.bind(this),this.onDocumentKeyUpHandler=this.onDocumentKeyUp.bind(this),this.onKeyDownHandler=this.onKeyDown.bind(this),this.onClickHandler=this.onClick.bind(this),this.onKeyPressHandler=this.onKeyPress.bind(this),this.$element.addClass("oo-ui-buttonElement"),this.toggleFramed(void 0===t.framed||t.framed),this.setButtonElement(t.$button||$("<a>"))},OO.initClass(OO.ui.mixin.ButtonElement),OO.ui.mixin.ButtonElement.static.cancelButtonMouseDownEvents=!0,OO.ui.mixin.ButtonElement.prototype.setButtonElement=function(t){this.$button&&this.$button.removeClass("oo-ui-buttonElement-button").removeAttr("role accesskey").off({mousedown:this.onMouseDownHandler,keydown:this.onKeyDownHandler,click:this.onClickHandler,keypress:this.onKeyPressHandler}),this.$button=t.addClass("oo-ui-buttonElement-button").on({mousedown:this.onMouseDownHandler,keydown:this.onKeyDownHandler,click:this.onClickHandler,keypress:this.onKeyPressHandler}),"A"===this.$button.prop("tagName").toUpperCase()&&this.$button.attr("role","button")},OO.ui.mixin.ButtonElement.prototype.onMouseDown=function(t){if(!this.isDisabled()&&t.which===OO.ui.MouseButtons.LEFT)return this.$element.addClass("oo-ui-buttonElement-pressed"),this.getElementDocument().addEventListener("mouseup",this.onDocumentMouseUpHandler,!0),!this.constructor.static.cancelButtonMouseDownEvents&&void 0},OO.ui.mixin.ButtonElement.prototype.onDocumentMouseUp=function(t){this.isDisabled()||t.which!==OO.ui.MouseButtons.LEFT||(this.$element.removeClass("oo-ui-buttonElement-pressed"),this.getElementDocument().removeEventListener("mouseup",this.onDocumentMouseUpHandler,!0))},OO.ui.mixin.ButtonElement.prototype.onClick=function(t){if(!this.isDisabled()&&t.which===OO.ui.MouseButtons.LEFT&&this.emit("click"))return!1},OO.ui.mixin.ButtonElement.prototype.onKeyDown=function(t){this.isDisabled()||t.which!==OO.ui.Keys.SPACE&&t.which!==OO.ui.Keys.ENTER||(this.$element.addClass("oo-ui-buttonElement-pressed"),this.getElementDocument().addEventListener("keyup",this.onDocumentKeyUpHandler,!0))},OO.ui.mixin.ButtonElement.prototype.onDocumentKeyUp=function(t){this.isDisabled()||t.which!==OO.ui.Keys.SPACE&&t.which!==OO.ui.Keys.ENTER||(this.$element.removeClass("oo-ui-buttonElement-pressed"),this.getElementDocument().removeEventListener("keyup",this.onDocumentKeyUpHandler,!0))},OO.ui.mixin.ButtonElement.prototype.onKeyPress=function(t){if(!this.isDisabled()&&(t.which===OO.ui.Keys.SPACE||t.which===OO.ui.Keys.ENTER)&&this.emit("click"))return!1},OO.ui.mixin.ButtonElement.prototype.isFramed=function(){return this.framed},OO.ui.mixin.ButtonElement.prototype.toggleFramed=function(t){return(t=void 0===t?!this.framed:!!t)!==this.framed&&(this.framed=t,this.$element.toggleClass("oo-ui-buttonElement-frameless",!t).toggleClass("oo-ui-buttonElement-framed",t),this.updateThemeClasses()),this},OO.ui.mixin.ButtonElement.prototype.setActive=function(t){return this.active=!!t,this.$element.toggleClass("oo-ui-buttonElement-active",this.active),this.updateThemeClasses(),this},OO.ui.mixin.ButtonElement.prototype.isActive=function(){return this.active},OO.ui.mixin.GroupElement=function(t){t=t||{},OO.EmitterList.call(this,t),this.$group=null,this.setGroupElement(t.$group||$("<div>"))},OO.mixinClass(OO.ui.mixin.GroupElement,OO.EmitterList),OO.ui.mixin.GroupElement.prototype.setGroupElement=function(t){var e,i;for(this.$group=t,e=0,i=this.items.length;e<i;e++)this.$group.append(this.items[e].$element)},OO.ui.mixin.GroupElement.prototype.findItemFromData=function(t){var e,i,n,o=OO.getHash(t);for(e=0,i=this.items.length;e<i;e++)if(n=this.items[e],o===OO.getHash(n.getData()))return n;return null},OO.ui.mixin.GroupElement.prototype.findItemsFromData=function(t){var e,i,n,o=OO.getHash(t),s=[];for(e=0,i=this.items.length;e<i;e++)n=this.items[e],o===OO.getHash(n.getData())&&s.push(n);return s},OO.ui.mixin.GroupElement.prototype.addItems=function(t,e){return 0===t.length||(OO.EmitterList.prototype.addItems.call(this,t,e),this.emit("change",this.getItems())),this},OO.ui.mixin.GroupElement.prototype.moveItem=function(t,e){return this.insertItemElements(t,e),e=OO.EmitterList.prototype.moveItem.call(this,t,e)},OO.ui.mixin.GroupElement.prototype.insertItem=function(t,e){return t.setElementGroup(this),this.insertItemElements(t,e),e=OO.EmitterList.prototype.insertItem.call(this,t,e)},OO.ui.mixin.GroupElement.prototype.insertItemElements=function(t,e){void 0===e||e<0||e>=this.items.length?this.$group.append(t.$element):0===e?this.$group.prepend(t.$element):this.items[e].$element.before(t.$element)},OO.ui.mixin.GroupElement.prototype.removeItems=function(t){var e,i,n;if(0===t.length)return this;for(e=0,i=t.length;e<i;e++)n=t[e],-1!==this.items.indexOf(n)&&(n.setElementGroup(null),n.$element.detach());return OO.EmitterList.prototype.removeItems.call(this,t),this.emit("change",this.getItems()),this},OO.ui.mixin.GroupElement.prototype.clearItems=function(){var t,e;for(t=0,e=this.items.length;t<e;t++)this.items[t].setElementGroup(null),this.items[t].$element.detach();return OO.EmitterList.prototype.clearItems.call(this),this.emit("change",this.getItems()),this},OO.ui.mixin.LabelElement=function(t){t=t||{},this.$label=null,this.label=null,this.invisibleLabel=null,this.setLabel(t.label||this.constructor.static.label),this.setLabelElement(t.$label||$("<span>")),this.setInvisibleLabel(t.invisibleLabel)},OO.initClass(OO.ui.mixin.LabelElement),OO.ui.mixin.LabelElement.static.label=null,OO.ui.mixin.LabelElement.static.highlightQuery=function(t,e,i){var n,o,s,l=-1,u=$("<span>");if(i)for(o=t.length,s=e.length,n=0;-1===l&&n<=o-s;n++)0===i(e,t.slice(n,n+s))&&(l=n);else l=t.toLowerCase().indexOf(e.toLowerCase());return e.length&&-1!==l?u.append(document.createTextNode(t.slice(0,l)),$("<span>").addClass("oo-ui-labelElement-label-highlight").text(t.slice(l,l+e.length)),document.createTextNode(t.slice(l+e.length))):u.text(t),u.contents()},OO.ui.mixin.LabelElement.prototype.setLabelElement=function(t){this.$label&&this.$label.removeClass("oo-ui-labelElement-label").empty(),this.$label=t.addClass("oo-ui-labelElement-label"),this.setLabelContent(this.label)},OO.ui.mixin.LabelElement.prototype.setLabel=function(t){return t=("string"==typeof(t="function"==typeof t?OO.ui.resolveMsg(t):t)||t instanceof $)&&t.length||t instanceof OO.ui.HtmlSnippet&&t.toString().length?t:null,this.label!==t&&(this.$label&&this.setLabelContent(t),this.label=t,this.emit("labelChange")),this.$element.toggleClass("oo-ui-labelElement",!!this.label&&!this.invisibleLabel),this},OO.ui.mixin.LabelElement.prototype.setInvisibleLabel=function(t){return t=!!t,this.invisibleLabel!==t&&(this.invisibleLabel=t,this.emit("labelChange")),this.$label.toggleClass("oo-ui-labelElement-invisible",this.invisibleLabel),this.$element.toggleClass("oo-ui-labelElement",!!this.label&&!this.invisibleLabel),this},OO.ui.mixin.LabelElement.prototype.setHighlightedQuery=function(t,e,i){return this.setLabel(this.constructor.static.highlightQuery(t,e,i))},OO.ui.mixin.LabelElement.prototype.getLabel=function(){return this.label},OO.ui.mixin.LabelElement.prototype.setLabelContent=function(t){"string"==typeof t?t.match(/^\s*$/)?this.$label.html("&nbsp;"):this.$label.text(t):t instanceof OO.ui.HtmlSnippet?this.$label.html(t.toString()):t instanceof $?this.$label.empty().append(t):this.$label.empty()},OO.ui.mixin.IconElement=function(t){t=t||{},this.$icon=null,this.icon=null,this.setIcon(t.icon||this.constructor.static.icon),this.setIconElement(t.$icon||$("<span>"))},OO.initClass(OO.ui.mixin.IconElement),OO.ui.mixin.IconElement.static.icon=null,OO.ui.mixin.IconElement.static.iconTitle=null,OO.ui.mixin.IconElement.prototype.setIconElement=function(t){this.$icon&&this.$icon.removeClass("oo-ui-iconElement-icon oo-ui-icon-"+this.icon).removeAttr("title"),this.$icon=t.addClass("oo-ui-iconElement-icon").toggleClass("oo-ui-iconElement-noIcon",!this.icon).toggleClass("oo-ui-icon-"+this.icon,!!this.icon),null!==this.iconTitle&&this.$icon.attr("title",this.iconTitle),this.updateThemeClasses()},OO.ui.mixin.IconElement.prototype.setIcon=function(t){return t="string"==typeof(t=OO.isPlainObject(t)?OO.ui.getLocalValue(t,null,"default"):t)&&t.trim().length?t.trim():null,this.icon!==t&&(this.$icon&&(null!==this.icon&&this.$icon.removeClass("oo-ui-icon-"+this.icon),null!==t&&this.$icon.addClass("oo-ui-icon-"+t)),this.icon=t),this.$element.toggleClass("oo-ui-iconElement",!!this.icon),this.$icon&&this.$icon.toggleClass("oo-ui-iconElement-noIcon",!this.icon),this.updateThemeClasses(),this},OO.ui.mixin.IconElement.prototype.getIcon=function(){return this.icon},OO.ui.mixin.IconElement.prototype.getIconTitle=function(){return this.iconTitle},OO.ui.mixin.IndicatorElement=function(t){t=t||{},this.$indicator=null,this.indicator=null,this.setIndicator(t.indicator||this.constructor.static.indicator),this.setIndicatorElement(t.$indicator||$("<span>"))},OO.initClass(OO.ui.mixin.IndicatorElement),OO.ui.mixin.IndicatorElement.static.indicator=null,OO.ui.mixin.IndicatorElement.static.indicatorTitle=null,OO.ui.mixin.IndicatorElement.prototype.setIndicatorElement=function(t){this.$indicator&&this.$indicator.removeClass("oo-ui-indicatorElement-indicator oo-ui-indicator-"+this.indicator).removeAttr("title"),this.$indicator=t.addClass("oo-ui-indicatorElement-indicator").toggleClass("oo-ui-indicatorElement-noIndicator",!this.indicator).toggleClass("oo-ui-indicator-"+this.indicator,!!this.indicator),null!==this.indicatorTitle&&this.$indicator.attr("title",this.indicatorTitle),this.updateThemeClasses()},OO.ui.mixin.IndicatorElement.prototype.setIndicator=function(t){return t="string"==typeof t&&t.length?t.trim():null,this.indicator!==t&&(this.$indicator&&(null!==this.indicator&&this.$indicator.removeClass("oo-ui-indicator-"+this.indicator),null!==t&&this.$indicator.addClass("oo-ui-indicator-"+t)),this.indicator=t),this.$element.toggleClass("oo-ui-indicatorElement",!!this.indicator),this.$indicator&&this.$indicator.toggleClass("oo-ui-indicatorElement-noIndicator",!this.indicator),this.updateThemeClasses(),this},OO.ui.mixin.IndicatorElement.prototype.getIndicator=function(){return this.indicator},OO.ui.mixin.IndicatorElement.prototype.getIndicatorTitle=function(){return this.indicatorTitle},OO.ui.mixin.FlaggedElement=function(t){t=t||{},this.flags={},this.$flagged=null,this.setFlags(t.flags||this.constructor.static.flags),this.setFlaggedElement(t.$flagged||this.$element)},OO.initClass(OO.ui.mixin.FlaggedElement),OO.ui.mixin.FlaggedElement.static.flags=null,OO.ui.mixin.FlaggedElement.prototype.setFlaggedElement=function(t){var e=Object.keys(this.flags).map(function(t){return"oo-ui-flaggedElement-"+t});this.$flagged&&this.$flagged.removeClass(e),this.$flagged=t.addClass(e)},OO.ui.mixin.FlaggedElement.prototype.hasFlag=function(t){return this.flags&&t in this.flags},OO.ui.mixin.FlaggedElement.prototype.getFlags=function(){return Object.keys(this.flags||{})},OO.ui.mixin.FlaggedElement.prototype.clearFlags=function(){var t,e,i={},n=[];for(t in this.flags)e="oo-ui-flaggedElement-"+t,i[t]=!1,delete this.flags[t],n.push(e);return this.$flagged&&this.$flagged.removeClass(n),this.updateThemeClasses(),this.emit("flag",i),this},OO.ui.mixin.FlaggedElement.prototype.setFlags=function(t){var e,i,n,o,s={},l=[],u=[],a="oo-ui-flaggedElement-";if("string"==typeof t)o=a+t,this.flags[t]||(this.flags[t]=!0,l.push(o));else if(Array.isArray(t))for(e=0,i=t.length;e<i;e++)o=a+(n=t[e]),this.flags[n]||(s[n]=!0,this.flags[n]=!0,l.push(o));else if(OO.isPlainObject(t))for(n in t)o=a+n,t[n]?this.flags[n]||(s[n]=!0,this.flags[n]=!0,l.push(o)):this.flags[n]&&(s[n]=!1,delete this.flags[n],u.push(o));return this.$flagged&&this.$flagged.addClass(l).removeClass(u),this.updateThemeClasses(),this.emit("flag",s),this},OO.ui.mixin.TitledElement=function(t){t=t||{},this.$titled=null,this.title=null,this.setTitle(void 0!==t.title?t.title:this.constructor.static.title),this.setTitledElement(t.$titled||this.$element)},OO.initClass(OO.ui.mixin.TitledElement),OO.ui.mixin.TitledElement.static.title=null,OO.ui.mixin.TitledElement.prototype.setTitledElement=function(t){this.$titled&&this.$titled.removeAttr("title"),this.$titled=t,this.updateTitle()},OO.ui.mixin.TitledElement.prototype.setTitle=function(t){return t="string"==typeof(t="function"==typeof t?OO.ui.resolveMsg(t):t)?t:null,this.title!==t&&(this.title=t,this.updateTitle()),this},OO.ui.mixin.TitledElement.prototype.updateTitle=function(){var t=this.getTitle();return this.$titled&&(null!==t?(this.formatTitleWithAccessKey&&(t=this.formatTitleWithAccessKey(t)),this.$titled.attr("title",t)):this.$titled.removeAttr("title")),this},OO.ui.mixin.TitledElement.prototype.getTitle=function(){return this.title},OO.ui.mixin.AccessKeyedElement=function(t){t=t||{},this.$accessKeyed=null,this.accessKey=null,this.setAccessKey(t.accessKey||null),this.setAccessKeyedElement(t.$accessKeyed||this.$element),this.updateTitle&&this.updateTitle()},OO.initClass(OO.ui.mixin.AccessKeyedElement),OO.ui.mixin.AccessKeyedElement.static.accessKey=null,OO.ui.mixin.AccessKeyedElement.prototype.setAccessKeyedElement=function(t){this.$accessKeyed&&this.$accessKeyed.removeAttr("accesskey"),this.$accessKeyed=t,this.accessKey&&this.$accessKeyed.attr("accesskey",this.accessKey)},OO.ui.mixin.AccessKeyedElement.prototype.setAccessKey=function(t){return t="string"==typeof t?OO.ui.resolveMsg(t):null,this.accessKey!==t&&(this.$accessKeyed&&(null!==t?this.$accessKeyed.attr("accesskey",t):this.$accessKeyed.removeAttr("accesskey")),this.accessKey=t,this.updateTitle&&this.updateTitle()),this},OO.ui.mixin.AccessKeyedElement.prototype.getAccessKey=function(){return this.accessKey},OO.ui.mixin.AccessKeyedElement.prototype.formatTitleWithAccessKey=function(t){var e;return this.$accessKeyed&&(e=$.fn.updateTooltipAccessKeys&&$.fn.updateTooltipAccessKeys.getAccessKeyLabel?$.fn.updateTooltipAccessKeys.getAccessKeyLabel(this.$accessKeyed[0]):this.getAccessKey())&&(t+=" ["+e+"]"),t},OO.ui.ButtonWidget=function(t){t=t||{},OO.ui.ButtonWidget.parent.call(this,t),OO.ui.mixin.ButtonElement.call(this,t),OO.ui.mixin.IconElement.call(this,t),OO.ui.mixin.IndicatorElement.call(this,t),OO.ui.mixin.LabelElement.call(this,t),OO.ui.mixin.TitledElement.call(this,$.extend({$titled:this.$button},t)),OO.ui.mixin.FlaggedElement.call(this,t),OO.ui.mixin.TabIndexedElement.call(this,$.extend({$tabIndexed:this.$button},t)),OO.ui.mixin.AccessKeyedElement.call(this,$.extend({$accessKeyed:this.$button},t)),this.href=null,this.target=null,this.noFollow=!1,this.connect(this,{disable:"onDisable"}),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-buttonWidget").append(this.$button),this.setActive(t.active),this.setHref(t.href),this.setTarget(t.target),this.setNoFollow(t.noFollow)},OO.inheritClass(OO.ui.ButtonWidget,OO.ui.Widget),OO.mixinClass(OO.ui.ButtonWidget,OO.ui.mixin.ButtonElement),OO.mixinClass(OO.ui.ButtonWidget,OO.ui.mixin.IconElement),OO.mixinClass(OO.ui.ButtonWidget,OO.ui.mixin.IndicatorElement),OO.mixinClass(OO.ui.ButtonWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.ButtonWidget,OO.ui.mixin.TitledElement),OO.mixinClass(OO.ui.ButtonWidget,OO.ui.mixin.FlaggedElement),OO.mixinClass(OO.ui.ButtonWidget,OO.ui.mixin.TabIndexedElement),OO.mixinClass(OO.ui.ButtonWidget,OO.ui.mixin.AccessKeyedElement),OO.ui.ButtonWidget.static.cancelButtonMouseDownEvents=!1,OO.ui.ButtonWidget.static.tagName="span",OO.ui.ButtonWidget.prototype.getHref=function(){return this.href},OO.ui.ButtonWidget.prototype.getTarget=function(){return this.target},OO.ui.ButtonWidget.prototype.getNoFollow=function(){return this.noFollow},OO.ui.ButtonWidget.prototype.setHref=function(t){return null===(t="string"==typeof t?t:null)||OO.ui.isSafeUrl(t)||(t="./"+t),t!==this.href&&(this.href=t,this.updateHref()),this},OO.ui.ButtonWidget.prototype.updateHref=function(){return null===this.href||this.isDisabled()?this.$button.removeAttr("href"):this.$button.attr("href",this.href),this},OO.ui.ButtonWidget.prototype.onDisable=function(){this.updateHref()},OO.ui.ButtonWidget.prototype.setTarget=function(t){return(t="string"==typeof t?t:null)!==this.target&&(null!==(this.target=t)?this.$button.attr("target",t):this.$button.removeAttr("target")),this},OO.ui.ButtonWidget.prototype.setNoFollow=function(t){return(t="boolean"!=typeof t||t)!==this.noFollow&&((this.noFollow=t)?this.$button.attr("rel","nofollow"):this.$button.removeAttr("rel")),this},OO.ui.ButtonGroupWidget=function(t){t=t||{},OO.ui.ButtonGroupWidget.parent.call(this,t),OO.ui.mixin.GroupElement.call(this,$.extend({$group:this.$element},t)),OO.ui.mixin.TitledElement.call(this,t),this.$element.addClass("oo-ui-buttonGroupWidget"),Array.isArray(t.items)&&this.addItems(t.items)},OO.inheritClass(OO.ui.ButtonGroupWidget,OO.ui.Widget),OO.mixinClass(OO.ui.ButtonGroupWidget,OO.ui.mixin.GroupElement),OO.mixinClass(OO.ui.ButtonGroupWidget,OO.ui.mixin.TitledElement),OO.ui.ButtonGroupWidget.static.tagName="span",OO.ui.ButtonGroupWidget.prototype.focus=function(){return this.isDisabled()||this.items[0]&&this.items[0].focus(),this},OO.ui.ButtonGroupWidget.prototype.simulateLabelClick=function(){this.focus()},OO.ui.IconWidget=function(t){t=t||{},OO.ui.IconWidget.parent.call(this,t),OO.ui.mixin.IconElement.call(this,$.extend({$icon:this.$element},t)),OO.ui.mixin.TitledElement.call(this,$.extend({$titled:this.$element},t)),OO.ui.mixin.LabelElement.call(this,$.extend({$label:this.$element,invisibleLabel:!0},t)),OO.ui.mixin.FlaggedElement.call(this,$.extend({$flagged:this.$element},t)),this.$element.addClass("oo-ui-iconWidget"),this.$element.removeClass("oo-ui-labelElement-label")},OO.inheritClass(OO.ui.IconWidget,OO.ui.Widget),OO.mixinClass(OO.ui.IconWidget,OO.ui.mixin.IconElement),OO.mixinClass(OO.ui.IconWidget,OO.ui.mixin.TitledElement),OO.mixinClass(OO.ui.IconWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.IconWidget,OO.ui.mixin.FlaggedElement),OO.ui.IconWidget.static.tagName="span",OO.ui.IndicatorWidget=function(t){t=t||{},OO.ui.IndicatorWidget.parent.call(this,t),OO.ui.mixin.IndicatorElement.call(this,$.extend({$indicator:this.$element},t)),OO.ui.mixin.TitledElement.call(this,$.extend({$titled:this.$element},t)),OO.ui.mixin.LabelElement.call(this,$.extend({$label:this.$element,invisibleLabel:!0},t)),this.$element.addClass("oo-ui-indicatorWidget"),this.$element.removeClass("oo-ui-labelElement-label")},OO.inheritClass(OO.ui.IndicatorWidget,OO.ui.Widget),OO.mixinClass(OO.ui.IndicatorWidget,OO.ui.mixin.IndicatorElement),OO.mixinClass(OO.ui.IndicatorWidget,OO.ui.mixin.TitledElement),OO.mixinClass(OO.ui.IndicatorWidget,OO.ui.mixin.LabelElement),OO.ui.IndicatorWidget.static.tagName="span",OO.ui.LabelWidget=function(t){t=t||{},OO.ui.LabelWidget.parent.call(this,t),OO.ui.mixin.LabelElement.call(this,$.extend({$label:this.$element},t)),OO.ui.mixin.TitledElement.call(this,t),this.input=t.input,this.input&&(this.input.getInputId()?this.$element.attr("for",this.input.getInputId()):this.$label.on("click",function(){this.input.simulateLabelClick()}.bind(this))),this.$element.addClass("oo-ui-labelWidget")},OO.inheritClass(OO.ui.LabelWidget,OO.ui.Widget),OO.mixinClass(OO.ui.LabelWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.LabelWidget,OO.ui.mixin.TitledElement),OO.ui.LabelWidget.static.tagName="label",OO.ui.MessageWidget=function(t){t=t||{},OO.ui.MessageWidget.parent.call(this,t),OO.ui.mixin.IconElement.call(this,t),OO.ui.mixin.LabelElement.call(this,t),OO.ui.mixin.TitledElement.call(this,t),OO.ui.mixin.FlaggedElement.call(this,t),this.setType(t.type),this.setInline(t.inline),this.$element.append(this.$icon,this.$label).addClass("oo-ui-messageWidget")},OO.inheritClass(OO.ui.MessageWidget,OO.ui.Widget),OO.mixinClass(OO.ui.MessageWidget,OO.ui.mixin.IconElement),OO.mixinClass(OO.ui.MessageWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.MessageWidget,OO.ui.mixin.TitledElement),OO.mixinClass(OO.ui.MessageWidget,OO.ui.mixin.FlaggedElement),OO.ui.MessageWidget.static.iconMap={notice:"infoFilled",error:"error",warning:"alert",success:"check"},OO.ui.MessageWidget.prototype.setInline=function(t){t=!!t,this.inline!==t&&(this.inline=t,this.$element.toggleClass("oo-ui-messageWidget-block",!this.inline))},OO.ui.MessageWidget.prototype.setType=function(t){-1===Object.keys(this.constructor.static.iconMap).indexOf(t)&&(t="notice"),this.type!==t&&(this.clearFlags(),this.setFlags(t),this.setIcon(this.constructor.static.iconMap[t]),this.$icon.removeClass("oo-ui-image-"+this.type),this.$icon.addClass("oo-ui-image-"+t),"error"===t?(this.$element.attr("role","alert"),this.$element.removeAttr("aria-live")):(this.$element.removeAttr("role"),this.$element.attr("aria-live","polite")),this.type=t)},OO.ui.mixin.PendingElement=function(t){t=t||{},this.pending=0,this.$pending=null,this.setPendingElement(t.$pending||this.$element)},OO.initClass(OO.ui.mixin.PendingElement),OO.ui.mixin.PendingElement.prototype.setPendingElement=function(t){this.$pending&&this.$pending.removeClass("oo-ui-pendingElement-pending"),this.$pending=t,0<this.pending&&this.$pending.addClass("oo-ui-pendingElement-pending")},OO.ui.mixin.PendingElement.prototype.isPending=function(){return!!this.pending},OO.ui.mixin.PendingElement.prototype.pushPending=function(){return 0===this.pending&&(this.$pending.addClass("oo-ui-pendingElement-pending"),this.updateThemeClasses()),this.pending++,this},OO.ui.mixin.PendingElement.prototype.popPending=function(){return 1===this.pending&&(this.$pending.removeClass("oo-ui-pendingElement-pending"),this.updateThemeClasses()),this.pending=Math.max(0,this.pending-1),this},OO.ui.mixin.FloatableElement=function(t){t=t||{},this.$floatable=null,this.$floatableContainer=null,this.$floatableWindow=null,this.$floatableClosestScrollable=null,this.floatableOutOfView=!1,this.onFloatableScrollHandler=this.position.bind(this),this.onFloatableWindowResizeHandler=this.position.bind(this),this.setFloatableContainer(t.$floatableContainer),this.setFloatableElement(t.$floatable||this.$element),this.setVerticalPosition(t.verticalPosition||"below"),this.setHorizontalPosition(t.horizontalPosition||"start"),this.hideWhenOutOfView=void 0===t.hideWhenOutOfView||!!t.hideWhenOutOfView},OO.ui.mixin.FloatableElement.prototype.setFloatableElement=function(t){this.$floatable&&(this.$floatable.removeClass("oo-ui-floatableElement-floatable"),this.$floatable.css({left:"",top:""})),this.$floatable=t.addClass("oo-ui-floatableElement-floatable"),this.position()},OO.ui.mixin.FloatableElement.prototype.setFloatableContainer=function(t){this.$floatableContainer=t,this.$floatable&&this.position()},OO.ui.mixin.FloatableElement.prototype.setVerticalPosition=function(t){if(-1===["below","above","top","bottom","center"].indexOf(t))throw new Error("Invalid value for vertical position: "+t);this.verticalPosition!==t&&(this.verticalPosition=t,this.$floatable&&this.position())},OO.ui.mixin.FloatableElement.prototype.setHorizontalPosition=function(t){if(-1===["before","after","start","end","center"].indexOf(t))throw new Error("Invalid value for horizontal position: "+t);this.horizontalPosition!==t&&(this.horizontalPosition=t,this.$floatable&&this.position())},OO.ui.mixin.FloatableElement.prototype.togglePositioning=function(t){var e;return this.$floatable&&this.$floatableContainer&&(!(t=void 0===t?!this.positioning:!!t)||this.warnedUnattached||this.isElementAttached()||(OO.ui.warnDeprecation("FloatableElement#togglePositioning: Before calling this method, the element must be attached to the DOM."),this.warnedUnattached=!0),this.positioning!==t&&(this.positioning=t,e=OO.ui.Element.static.getClosestScrollableContainer(this.$floatableContainer[0]),$(e).is("html, body")&&(e=OO.ui.Element.static.getWindow(e)),t?(this.$floatableWindow=$(this.getElementWindow()),this.$floatableWindow.on("resize",this.onFloatableWindowResizeHandler),this.$floatableClosestScrollable=$(e),this.$floatableClosestScrollable.on("scroll",this.onFloatableScrollHandler),this.position()):(this.$floatableWindow&&(this.$floatableWindow.off("resize",this.onFloatableWindowResizeHandler),this.$floatableWindow=null),this.$floatableClosestScrollable&&(this.$floatableClosestScrollable.off("scroll",this.onFloatableScrollHandler),this.$floatableClosestScrollable=null),this.$floatable.css({left:"",right:"",top:""})))),this},OO.ui.mixin.FloatableElement.prototype.isElementInViewport=function(t,e){var i,n,o,s,l,u,a,r,h,d=t.css("direction");return i=t[0].getBoundingClientRect(),e[0]===window?(h=OO.ui.getViewportSpacing(),(n={top:0,left:0,right:document.documentElement.clientWidth,bottom:document.documentElement.clientHeight}).top+=h.top,n.left+=h.left,n.right-=h.right,n.bottom-=h.bottom):n=e[0].getBoundingClientRect(),o=i.top>=n.top&&i.top<=n.bottom,s=i.bottom>=n.top&&i.bottom<=n.bottom,l=i.left>=n.left&&i.left<=n.right,u=i.right>=n.left&&i.right<=n.right,r="rtl"===d?(a=u,l):(a=l,u),("below"!==this.verticalPosition||s)&&(("above"!==this.verticalPosition||o)&&(!("before"===this.horizontalPosition&&!a)&&(!("after"===this.horizontalPosition&&!r)&&(i.top<=n.bottom&&i.bottom>=n.top&&i.left<=n.right&&i.right>=n.left))))},OO.ui.mixin.FloatableElement.prototype.isFloatableOutOfView=function(){return this.floatableOutOfView},OO.ui.mixin.FloatableElement.prototype.position=function(){return this.positioning?!this.isElementAttached()||this.$floatableClosestScrollable[0]!==this.getElementWindow()&&!$.contains(this.getElementDocument(),this.$floatableClosestScrollable[0])?this:(this.floatableOutOfView=this.hideWhenOutOfView&&!this.isElementInViewport(this.$floatableContainer,this.$floatableClosestScrollable),this.floatableOutOfView?this.$floatable.addClass("oo-ui-element-hidden"):(this.$floatable.removeClass("oo-ui-element-hidden"),this.$floatable.css(this.computePosition()),this.clip&&this.clip()),this):this},OO.ui.mixin.FloatableElement.prototype.computePosition=function(){var t,e,i,n,o,s,l,u,a={top:"",left:"",bottom:"",right:""},r=this.$floatableContainer.css("direction"),h=this.$floatable.offsetParent();return h.is("html")&&(h=$(h[0].ownerDocument.body)),t=h.is("body"),e="scroll"===h.css("overflow-x")||"auto"===h.css("overflow-x"),i="scroll"===h.css("overflow-y")||"auto"===h.css("overflow-y"),s=h.innerWidth()-h.prop("clientWidth"),o=h.innerHeight()-h.prop("clientHeight"),l=i&&!t?h.scrollTop():0,u=e&&!t?OO.ui.Element.static.getScrollLeft(h[0]):0,(n=t?this.$floatableContainer.offset():OO.ui.Element.static.getRelativePosition(this.$floatableContainer,h)).bottom=n.top+this.$floatableContainer.outerHeight(),n.right=n.left+this.$floatableContainer.outerWidth(),n.start="rtl"===r?n.right:n.left,n.end="rtl"===r?n.left:n.right,"below"===this.verticalPosition?a.top=n.bottom:"above"===this.verticalPosition?a.bottom=h.outerHeight()-n.top:"top"===this.verticalPosition?a.top=n.top:"bottom"===this.verticalPosition?a.bottom=h.outerHeight()-n.bottom:"center"===this.verticalPosition&&(a.top=n.top+(this.$floatableContainer.height()-this.$floatable.height())/2),"before"===this.horizontalPosition?a.end=n.start:"after"===this.horizontalPosition?a.start=n.end:"start"===this.horizontalPosition?a.start=n.start:"end"===this.horizontalPosition?a.end=n.end:"center"===this.horizontalPosition&&(a.left=n.left+(this.$floatableContainer.width()-this.$floatable.width())/2),void 0!==a.start&&("rtl"===r?a.right=(t?$(h[0].ownerDocument.documentElement):h).outerWidth()-a.start:a.left=a.start,delete a.start),void 0!==a.end&&("rtl"===r?a.left=a.end:a.right=(t?$(h[0].ownerDocument.documentElement):h).outerWidth()-a.end,delete a.end),""!==a.top&&(a.top+=l),""!==a.bottom&&(a.bottom-=l),""!==a.left&&(a.left+=u),""!==a.right&&(a.right-=u),""!==a.bottom&&(a.bottom-=o),"rtl"===r?""!==a.left&&(a.left-=s):""!==a.right&&(a.right-=s),a},OO.ui.mixin.ClippableElement=function(t){t=t||{},this.$clippable=null,this.$clippableContainer=null,this.clipping=!1,this.clippedHorizontally=!1,this.clippedVertically=!1,this.$clippableScrollableContainer=null,this.$clippableScroller=null,this.$clippableWindow=null,this.idealWidth=null,this.idealHeight=null,this.onClippableScrollHandler=this.clip.bind(this),this.onClippableWindowResizeHandler=this.clip.bind(this),t.$clippableContainer&&this.setClippableContainer(t.$clippableContainer),this.setClippableElement(t.$clippable||this.$element)},OO.ui.mixin.ClippableElement.prototype.setClippableElement=function(t){this.$clippable&&(this.$clippable.removeClass("oo-ui-clippableElement-clippable"),this.$clippable.css({width:"",height:"",overflowX:"",overflowY:""}),OO.ui.Element.static.reconsiderScrollbars(this.$clippable[0])),this.$clippable=t.addClass("oo-ui-clippableElement-clippable"),this.clip()},OO.ui.mixin.ClippableElement.prototype.setClippableContainer=function(t){this.$clippableContainer=t,this.$clippable&&this.clip()},OO.ui.mixin.ClippableElement.prototype.toggleClipping=function(t){return!(t=void 0===t?!this.clipping:!!t)||this.warnedUnattached||this.isElementAttached()||(OO.ui.warnDeprecation("ClippableElement#toggleClipping: Before calling this method, the element must be attached to the DOM."),this.warnedUnattached=!0),this.clipping!==t&&((this.clipping=t)?(this.$clippableScrollableContainer=$(this.getClosestScrollableElementContainer()),this.$clippableScroller=this.$clippableScrollableContainer.is("html, body")?$(OO.ui.Element.static.getWindow(this.$clippableScrollableContainer)):this.$clippableScrollableContainer,this.$clippableScroller.on("scroll",this.onClippableScrollHandler),this.$clippableWindow=$(this.getElementWindow()).on("resize",this.onClippableWindowResizeHandler),this.clip()):(this.$clippable.css({width:"",height:"",maxWidth:"",maxHeight:"",overflowX:"",overflowY:""}),OO.ui.Element.static.reconsiderScrollbars(this.$clippable[0]),this.$clippableScrollableContainer=null,this.$clippableScroller.off("scroll",this.onClippableScrollHandler),this.$clippableScroller=null,this.$clippableWindow.off("resize",this.onClippableWindowResizeHandler),this.$clippableWindow=null)),this},OO.ui.mixin.ClippableElement.prototype.isClipping=function(){return this.clipping},OO.ui.mixin.ClippableElement.prototype.isClipped=function(){return this.clippedHorizontally||this.clippedVertically},OO.ui.mixin.ClippableElement.prototype.isClippedHorizontally=function(){return this.clippedHorizontally},OO.ui.mixin.ClippableElement.prototype.isClippedVertically=function(){return this.clippedVertically},OO.ui.mixin.ClippableElement.prototype.setIdealSize=function(t,e){this.idealWidth=t,this.idealHeight=e,this.clipping||this.$clippable.css({width:t,height:e})},OO.ui.mixin.ClippableElement.prototype.getHorizontalAnchorEdge=function(){return this.computePosition&&this.positioning&&""!==this.computePosition().right?"right":"left"},OO.ui.mixin.ClippableElement.prototype.getVerticalAnchorEdge=function(){return this.computePosition&&this.positioning&&""!==this.computePosition().bottom?"bottom":"top"},OO.ui.mixin.ClippableElement.prototype.clip=function(){var t,e,i,n,o,s,l,u,a,r,h,d,p,c,g,m,f,b,y,W,I;if(!this.clipping)return this;return i=OO.ui.getViewportSpacing(),this.$clippableScrollableContainer.is("html, body")?(p=$(this.$clippableScrollableContainer[0].ownerDocument.body),(c={top:0,left:0,right:document.documentElement.clientWidth,bottom:document.documentElement.clientHeight}).top+=i.top,c.left+=i.left,c.right-=i.right,c.bottom-=i.bottom):(c=(p=this.$clippableScrollableContainer)[0].getBoundingClientRect(),c=$.extend({},c)),m=p.css("direction"),f=p.innerWidth()-p.prop("clientWidth"),b=p.innerHeight()-p.prop("clientHeight"),c.bottom-=b,"rtl"===m?c.left+=f:c.right-=f,c.top+=7,c.left+=7,c.right-=7,c.bottom-=7,t=(h=this.$clippableContainer||this.$clippable).outerHeight()-this.$clippable.outerHeight(),e=h.outerWidth()-this.$clippable.outerWidth(),d=h[0].getBoundingClientRect(),d=$.extend({},d),"right"===this.getHorizontalAnchorEdge()?d.left=c.left:d.right=c.right,"bottom"===this.getVerticalAnchorEdge()?d.top=c.top:d.bottom=c.bottom,y=c,W=d,(I={}).top=Math.max(y.top,W.top),I.left=Math.max(y.left,W.left),I.bottom=Math.min(y.bottom,W.bottom),I.right=Math.min(y.right,W.right),g=I,n=Math.max(0,g.right-g.left),o=Math.max(0,g.bottom-g.top),n=Math.min(n,document.documentElement.clientWidth-i.left-i.right),o=Math.min(o,document.documentElement.clientHeight-i.top-i.right),s=Math.ceil(n-e),l=Math.ceil(o-t),u=this.$clippable.prop("scrollWidth"),r=l<this.$clippable.prop("scrollHeight"),(a=s<u)?(this.$clippable.css("overflowX","scroll"),this.$clippable[0].offsetHeight,this.$clippable.css({width:Math.max(0,s),maxWidth:""})):this.$clippable.css({overflowX:"",width:this.idealWidth||"",maxWidth:Math.max(0,s)}),r?(this.$clippable.css("overflowY","scroll"),this.$clippable[0].offsetHeight,this.$clippable.css({height:Math.max(0,l),maxHeight:""})):this.$clippable.css({overflowY:"",height:this.idealHeight||"",maxHeight:Math.max(0,l)}),(this.clippedHorizontally&&!a||this.clippedVertically&&!r)&&OO.ui.Element.static.reconsiderScrollbars(this.$clippable[0]),this.clippedHorizontally=a,this.clippedVertically=r,this},OO.ui.PopupWidget=function(t){t=t||{},OO.ui.PopupWidget.parent.call(this,t),this.$body=$("<div>"),this.$popup=$("<div>"),OO.ui.mixin.LabelElement.call(this,t),OO.ui.mixin.ClippableElement.call(this,$.extend({$clippable:this.$body,$clippableContainer:this.$popup},t)),OO.ui.mixin.FloatableElement.call(this,t),this.$anchor=$("<div>"),this.$container=t.$container,this.containerPadding=void 0!==t.containerPadding?t.containerPadding:10,this.autoClose=!!t.autoClose,this.transitionTimeout=null,this.anchored=!1,this.onDocumentMouseDownHandler=this.onDocumentMouseDown.bind(this),this.onDocumentKeyDownHandler=this.onDocumentKeyDown.bind(this),this.setSize(t.width,t.height),this.toggleAnchor(void 0===t.anchor||t.anchor),this.setAlignment(t.align||"center"),this.setPosition(t.position||"below"),this.setAutoFlip(void 0===t.autoFlip||t.autoFlip),this.setAutoCloseIgnore(t.$autoCloseIgnore),this.$body.addClass("oo-ui-popupWidget-body"),this.$anchor.addClass("oo-ui-popupWidget-anchor"),this.$popup.addClass("oo-ui-popupWidget-popup").append(this.$body),this.$element.addClass("oo-ui-popupWidget").append(this.$popup,this.$anchor),t.$content instanceof $&&this.$body.append(t.$content),t.padded&&this.$body.addClass("oo-ui-popupWidget-body-padded"),t.head&&(this.closeButton=new OO.ui.ButtonWidget({framed:!1,icon:"close"}),this.closeButton.connect(this,{click:"onCloseButtonClick"}),this.$head=$("<div>").addClass("oo-ui-popupWidget-head").append(this.$label,this.closeButton.$element),this.$popup.prepend(this.$head)),t.$footer&&(this.$footer=$("<div>").addClass("oo-ui-popupWidget-footer").append(t.$footer),this.$popup.append(this.$footer)),this.visible=!1,this.$element.addClass("oo-ui-element-hidden")},OO.inheritClass(OO.ui.PopupWidget,OO.ui.Widget),OO.mixinClass(OO.ui.PopupWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.PopupWidget,OO.ui.mixin.ClippableElement),OO.mixinClass(OO.ui.PopupWidget,OO.ui.mixin.FloatableElement),OO.ui.PopupWidget.prototype.onDocumentMouseDown=function(t){this.isVisible()&&!OO.ui.contains(this.$element.add(this.$autoCloseIgnore).get(),t.target,!0)&&this.toggle(!1)},OO.ui.PopupWidget.prototype.bindDocumentMouseDownListener=function(){this.getElementDocument().addEventListener("mousedown",this.onDocumentMouseDownHandler,!0),this.getElementDocument().addEventListener("click",this.onDocumentMouseDownHandler,!0)},OO.ui.PopupWidget.prototype.onCloseButtonClick=function(){this.isVisible()&&this.toggle(!1)},OO.ui.PopupWidget.prototype.unbindDocumentMouseDownListener=function(){this.getElementDocument().removeEventListener("mousedown",this.onDocumentMouseDownHandler,!0),this.getElementDocument().removeEventListener("click",this.onDocumentMouseDownHandler,!0)},OO.ui.PopupWidget.prototype.onDocumentKeyDown=function(t){t.which===OO.ui.Keys.ESCAPE&&this.isVisible()&&(this.toggle(!1),t.preventDefault(),t.stopPropagation())},OO.ui.PopupWidget.prototype.bindDocumentKeyDownListener=function(){this.getElementDocument().addEventListener("keydown",this.onDocumentKeyDownHandler,!0)},OO.ui.PopupWidget.prototype.unbindDocumentKeyDownListener=function(){this.getElementDocument().removeEventListener("keydown",this.onDocumentKeyDownHandler,!0)},OO.ui.PopupWidget.prototype.toggleAnchor=function(t){t=void 0===t?!this.anchored:!!t,this.anchored!==t&&(t?(this.$element.addClass("oo-ui-popupWidget-anchored"),this.$element.addClass("oo-ui-popupWidget-anchored-"+this.anchorEdge)):(this.$element.removeClass("oo-ui-popupWidget-anchored"),this.$element.removeClass("oo-ui-popupWidget-anchored-"+this.anchorEdge)),this.anchored=t)},OO.ui.PopupWidget.prototype.setAnchorEdge=function(t){if(-1===["top","bottom","start","end"].indexOf(t))throw new Error("Invalid value for edge: "+t);null!==this.anchorEdge&&this.$element.removeClass("oo-ui-popupWidget-anchored-"+this.anchorEdge),this.anchorEdge=t,this.anchored&&this.$element.addClass("oo-ui-popupWidget-anchored-"+t)},OO.ui.PopupWidget.prototype.hasAnchor=function(){return this.anchored},OO.ui.PopupWidget.prototype.toggle=function(t){var e,i,n;return e=(t=void 0===t?!this.isVisible():!!t)!==this.isVisible(),!t||this.warnedUnattached||this.isElementAttached()||(OO.ui.warnDeprecation("PopupWidget#toggle: Before calling this method, the popup must be attached to the DOM."),this.warnedUnattached=!0),t&&!this.$floatableContainer&&this.isElementAttached()&&this.setFloatableContainer(this.$element.parent()),e&&t&&this.autoFlip&&(this.isAutoFlipped=!1),OO.ui.PopupWidget.parent.prototype.toggle.call(this,t),e&&(this.togglePositioning(t&&!!this.$floatableContainer),t?(this.autoClose&&(this.bindDocumentMouseDownListener(),this.bindDocumentKeyDownListener()),this.updateDimensions(),this.toggleClipping(!0),this.autoFlip&&("above"!==this.popupPosition&&"below"!==this.popupPosition||(this.isClippedVertically()||this.isFloatableOutOfView())&&(i=this.$element.height(),this.isAutoFlipped=!this.isAutoFlipped,this.position(),(this.isClippedVertically()||this.isFloatableOutOfView())&&this.$element.height()<i&&(this.isAutoFlipped=!this.isAutoFlipped,this.position())),"before"!==this.popupPosition&&"after"!==this.popupPosition||(this.isClippedHorizontally()||this.isFloatableOutOfView())&&(n=this.$element.width(),this.isAutoFlipped=!this.isAutoFlipped,this.toggleClipping(!1),this.position(),this.toggleClipping(!0),(this.isClippedHorizontally()||this.isFloatableOutOfView())&&this.$element.width()<n&&(this.isAutoFlipped=!this.isAutoFlipped,this.toggleClipping(!1),this.position(),this.toggleClipping(!0)))),this.emit("ready")):(this.toggleClipping(!1),this.autoClose&&(this.unbindDocumentMouseDownListener(),this.unbindDocumentKeyDownListener()))),this},OO.ui.PopupWidget.prototype.setSize=function(t,e,i){this.width=void 0!==t?t:320,this.height=void 0!==e?e:null,this.isVisible()&&this.updateDimensions(i)},OO.ui.PopupWidget.prototype.updateDimensions=function(t){var e=this;clearTimeout(this.transitionTimeout),t&&this.$element.addClass("oo-ui-popupWidget-transitioning"),this.position(),t?this.transitionTimeout=setTimeout(function(){e.$element.removeClass("oo-ui-popupWidget-transitioning")},200):this.$element.removeClass("oo-ui-popupWidget-transitioning")},OO.ui.PopupWidget.prototype.computePosition=function(){var t,e,i,n,o,s,l,u,a,r,h,d,p,c,g,m,f,b,y,W,I={},x={left:"",right:"",top:"",bottom:""},v={forwards:"start",center:"center",backwards:this.anchored?"before":"end"};return this.$container||(this.$container=$(this.getClosestScrollableElementContainer())),t=this.$container.css("direction"),this.$popup.css({width:null!==this.width?this.width:"auto",height:null!==this.height?this.height:"auto"}),e={ltr:{"force-left":"backwards","force-right":"forwards"},rtl:{"force-left":"forwards","force-right":"backwards"}}[t][this.align]||this.align,y=this.popupPosition,this.isAutoFlipped&&(y={above:"below",below:"above",before:"after",after:"before"}[y]),n=(i="before"===y||"after"===y)?"top":"rtl"===t?"right":"left",o=i?"bottom":"rtl"===t?"left":"right",s=i?"top":"left",l=i?"bottom":"right",u=i?"Height":"Width",a=i?this.height||this.$popup.height():this.width||this.$popup.width(),this.setAnchorEdge({above:"bottom",below:"top",before:"end",after:"start"}[y]),this.horizontalPosition=i?y:v[e],this.verticalPosition=i?{forwards:"top",center:"center",backwards:"bottom"}[e]:y,p=OO.ui.mixin.FloatableElement.prototype.computePosition.call(this),c=i?""!==p.top?"top":"bottom":""!==p.left?"left":"right",(m=this.$floatableContainer.offset())[l]=m[s]+this.$floatableContainer["outer"+u](),f=this.$element.offsetParent()[0]===document.documentElement?{top:0,left:0}:this.$element.offsetParent().offset(),c==s?(I[s]=f[s]+p[s],I[l]=I[s]+a):(I[l]=f[s]+this.$element.offsetParent()["inner"+u]()-p[l],I[s]=I[l]-a),g=this.anchored?(h=(n==l?-1:1)*((m[n]+m[o])/2-I[n]),r=this.$anchor[0]["scroll"+u],h+(d=parseFloat(this.$anchor.css("margin-"+n)))<2*r?(c==n?-1:1)*(2*r-(h+d)):a-2*r<h+d?(c==o?-1:1)*(h+d-(a-2*r)):0):0,(b=this.$container[0]===document.documentElement?{top:0,left:0}:this.$container.offset())[l]=b[s]+this.$container["inner"+u](),this.$container[0]===document.documentElement&&(W=OO.ui.getViewportSpacing(),b[s]+=W[s],b[l]-=W[l]),I[s]+=(c==s?1:-1)*g,I[l]+=(c==s?1:-1)*g,b[s]+this.containerPadding>I[s]?g+=(c==s?1:-1)*(b[s]+this.containerPadding-I[s]):b[l]-this.containerPadding<I[l]&&(g+=(c==l?1:-1)*(I[l]-(b[l]-this.containerPadding))),this.anchored&&(h+=(c==n?-1:1)*g,x[n]=h,this.$anchor.css(x)),p[c]+=g,p},OO.ui.PopupWidget.prototype.setAlignment=function(t){-1<["force-left","force-right","backwards","forwards","center"].indexOf(t)?this.align=t:this.align="center",this.position()},OO.ui.PopupWidget.prototype.getAlignment=function(){return this.align},OO.ui.PopupWidget.prototype.setPosition=function(t){-1===["above","below","before","after"].indexOf(t)&&(t="below"),this.popupPosition=t,this.position()},OO.ui.PopupWidget.prototype.getPosition=function(){return this.popupPosition},OO.ui.PopupWidget.prototype.setAutoFlip=function(t){t=!!t,this.autoFlip!==t&&(this.autoFlip=t)},OO.ui.PopupWidget.prototype.setAutoCloseIgnore=function(t){this.$autoCloseIgnore=t},OO.ui.PopupWidget.prototype.getBodyId=function(){var t=this.$body.attr("id");return void 0===t&&(t=OO.ui.generateElementId(),this.$body.attr("id",t)),t},OO.ui.mixin.PopupElement=function(t){t=t||{},this.popup=new OO.ui.PopupWidget($.extend({autoClose:!0,$floatableContainer:this.$element},t.popup,{$autoCloseIgnore:this.$element.add(t.popup&&t.popup.$autoCloseIgnore)}))},OO.ui.mixin.PopupElement.prototype.getPopup=function(){return this.popup},OO.ui.PopupButtonWidget=function(t){t=t||{},OO.ui.PopupButtonWidget.parent.call(this,t),OO.ui.mixin.PopupElement.call(this,t),this.$overlay=(!0===t.$overlay?OO.ui.getDefaultOverlay():t.$overlay)||this.$element,this.connect(this,{click:"onAction"}),this.$element.addClass("oo-ui-popupButtonWidget"),this.popup.$element.addClass("oo-ui-popupButtonWidget-popup").toggleClass("oo-ui-popupButtonWidget-framed-popup",this.isFramed()).toggleClass("oo-ui-popupButtonWidget-frameless-popup",!this.isFramed()),this.$overlay.append(this.popup.$element)},OO.inheritClass(OO.ui.PopupButtonWidget,OO.ui.ButtonWidget),OO.mixinClass(OO.ui.PopupButtonWidget,OO.ui.mixin.PopupElement),OO.ui.PopupButtonWidget.prototype.onAction=function(){this.popup.toggle()},OO.ui.mixin.GroupWidget=function(t){OO.ui.mixin.GroupElement.call(this,t)},OO.mixinClass(OO.ui.mixin.GroupWidget,OO.ui.mixin.GroupElement),OO.ui.mixin.GroupWidget.prototype.setDisabled=function(t){var e,i;if(OO.ui.Widget.prototype.setDisabled.call(this,t),this.items)for(e=0,i=this.items.length;e<i;e++)this.items[e].updateDisabled();return this},OO.ui.mixin.ItemWidget=function(){},OO.ui.mixin.ItemWidget.prototype.isDisabled=function(){return this.disabled||this.elementGroup instanceof OO.ui.Widget&&this.elementGroup.isDisabled()},OO.ui.mixin.ItemWidget.prototype.setElementGroup=function(t){return OO.ui.Element.prototype.setElementGroup.call(this,t),this.updateDisabled(),this},OO.ui.OptionWidget=function(t){t=t||{},OO.ui.OptionWidget.parent.call(this,t),OO.ui.mixin.ItemWidget.call(this),OO.ui.mixin.LabelElement.call(this,t),OO.ui.mixin.FlaggedElement.call(this,t),OO.ui.mixin.AccessKeyedElement.call(this,t),OO.ui.mixin.TitledElement.call(this,t),this.highlighted=!1,this.pressed=!1,this.setSelected(!!t.selected),this.$element.data("oo-ui-optionWidget",this).attr("tabindex","-1").attr("role","option").addClass("oo-ui-optionWidget").append(this.$label)},OO.inheritClass(OO.ui.OptionWidget,OO.ui.Widget),OO.mixinClass(OO.ui.OptionWidget,OO.ui.mixin.ItemWidget),OO.mixinClass(OO.ui.OptionWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.OptionWidget,OO.ui.mixin.FlaggedElement),OO.mixinClass(OO.ui.OptionWidget,OO.ui.mixin.AccessKeyedElement),OO.mixinClass(OO.ui.OptionWidget,OO.ui.mixin.TitledElement),OO.ui.OptionWidget.static.selectable=!0,OO.ui.OptionWidget.static.highlightable=!0,OO.ui.OptionWidget.static.pressable=!0,OO.ui.OptionWidget.static.scrollIntoViewOnSelect=!1,OO.ui.OptionWidget.prototype.isSelectable=function(){return this.constructor.static.selectable&&!this.disabled&&this.isVisible()},OO.ui.OptionWidget.prototype.isHighlightable=function(){return this.constructor.static.highlightable&&!this.disabled&&this.isVisible()},OO.ui.OptionWidget.prototype.isPressable=function(){return this.constructor.static.pressable&&!this.disabled&&this.isVisible()},OO.ui.OptionWidget.prototype.isSelected=function(){return this.selected},OO.ui.OptionWidget.prototype.isHighlighted=function(){return this.highlighted},OO.ui.OptionWidget.prototype.isPressed=function(){return this.pressed},OO.ui.OptionWidget.prototype.setSelected=function(t){return this.constructor.static.selectable&&(this.selected=!!t,this.$element.toggleClass("oo-ui-optionWidget-selected",t).attr("aria-selected",t.toString()),t&&this.constructor.static.scrollIntoViewOnSelect&&this.scrollElementIntoView(),this.updateThemeClasses()),this},OO.ui.OptionWidget.prototype.setHighlighted=function(t){return this.constructor.static.highlightable&&(this.highlighted=!!t,this.$element.toggleClass("oo-ui-optionWidget-highlighted",t),this.updateThemeClasses()),this},OO.ui.OptionWidget.prototype.setPressed=function(t){return this.constructor.static.pressable&&(this.pressed=!!t,this.$element.toggleClass("oo-ui-optionWidget-pressed",t),this.updateThemeClasses()),this},OO.ui.OptionWidget.prototype.getMatchText=function(){var t=this.getLabel();return"string"==typeof t?t:this.$label.text()},OO.ui.SelectWidget=function(t){t=t||{},OO.ui.SelectWidget.parent.call(this,t),OO.ui.mixin.GroupWidget.call(this,$.extend({$group:this.$element},t)),this.pressed=!1,this.selecting=null,this.multiselect=!!t.multiselect,this.onDocumentMouseUpHandler=this.onDocumentMouseUp.bind(this),this.onDocumentMouseMoveHandler=this.onDocumentMouseMove.bind(this),this.onDocumentKeyDownHandler=this.onDocumentKeyDown.bind(this),this.onDocumentKeyPressHandler=this.onDocumentKeyPress.bind(this),this.keyPressBuffer="",this.keyPressBufferTimer=null,this.blockMouseOverEvents=0,this.connect(this,{toggle:"onToggle"}),this.$element.on({focusin:this.onFocus.bind(this),mousedown:this.onMouseDown.bind(this),mouseover:this.onMouseOver.bind(this),mouseleave:this.onMouseLeave.bind(this)}),this.$element.addClass("oo-ui-selectWidget oo-ui-selectWidget-unpressed").attr("role","listbox"),this.setFocusOwner(this.$element),Array.isArray(t.items)&&this.addItems(t.items)},OO.inheritClass(OO.ui.SelectWidget,OO.ui.Widget),OO.mixinClass(OO.ui.SelectWidget,OO.ui.mixin.GroupWidget),OO.ui.SelectWidget.static.normalizeForMatching=function(t){var e=t.trim().replace(/\s+/," ").toLowerCase();return e.normalize&&(e=e.normalize()),e},OO.ui.SelectWidget.prototype.onFocus=function(t){var e;if(t.target===this.$element[0])this.findSelectedItem()||(e=this.findFirstSelectableItem());else{if(-1!==t.target.tabIndex)return;e=this.findTargetItem(t)}e&&(e.constructor.static.highlightable?this.highlightItem(e):this.selectItem(e)),t.target!==this.$element[0]&&this.$focusOwner.trigger("focus")},OO.ui.SelectWidget.prototype.onMouseDown=function(t){var e;return this.isDisabled()||t.which!==OO.ui.MouseButtons.LEFT||(this.togglePressed(!0),(e=this.findTargetItem(t))&&e.isSelectable()&&(this.pressItem(e),this.selecting=e,this.getElementDocument().addEventListener("mouseup",this.onDocumentMouseUpHandler,!0),this.getElementDocument().addEventListener("mousemove",this.onDocumentMouseMoveHandler,!0))),!1},OO.ui.SelectWidget.prototype.onDocumentMouseUp=function(t){var e;return this.togglePressed(!1),this.selecting||(e=this.findTargetItem(t))&&e.isSelectable()&&(this.selecting=e),!this.isDisabled()&&t.which===OO.ui.MouseButtons.LEFT&&this.selecting&&(this.pressItem(null),this.chooseItem(this.selecting),this.selecting=null),this.getElementDocument().removeEventListener("mouseup",this.onDocumentMouseUpHandler,!0),this.getElementDocument().removeEventListener("mousemove",this.onDocumentMouseMoveHandler,!0),!1},OO.ui.SelectWidget.prototype.onDocumentMouseMove=function(t){var e;!this.isDisabled()&&this.pressed&&(e=this.findTargetItem(t))&&e!==this.selecting&&e.isSelectable()&&(this.pressItem(e),this.selecting=e)},OO.ui.SelectWidget.prototype.onMouseOver=function(t){var e;if(!this.blockMouseOverEvents)return this.isDisabled()||(e=this.findTargetItem(t),this.highlightItem(e&&e.isHighlightable()?e:null)),!1},OO.ui.SelectWidget.prototype.onMouseLeave=function(){return this.isDisabled()||this.highlightItem(null),!1},OO.ui.SelectWidget.prototype.onDocumentKeyDown=function(t){var e,i=!1,n=this.findSelectedItems(),o=this.findHighlightedItem()||(Array.isArray(n)?n[0]:n),s=this.getItems()[0];if(!this.isDisabled()&&this.isVisible()){switch(t.keyCode){case OO.ui.Keys.ENTER:o&&(this.chooseItem(o),i=!0);break;case OO.ui.Keys.UP:case OO.ui.Keys.LEFT:this.clearKeyPressBuffer(),e=o?this.findRelativeSelectableItem(o,-1):s,i=!0;break;case OO.ui.Keys.DOWN:case OO.ui.Keys.RIGHT:this.clearKeyPressBuffer(),e=o?this.findRelativeSelectableItem(o,1):s,i=!0;break;case OO.ui.Keys.ESCAPE:case OO.ui.Keys.TAB:o&&o.setHighlighted(!1),this.unbindDocumentKeyDownListener(),this.unbindDocumentKeyPressListener(),i=!1}e&&(e.constructor.static.highlightable?this.highlightItem(e):this.chooseItem(e),this.scrollItemIntoView(e)),i&&(t.preventDefault(),t.stopPropagation())}},OO.ui.SelectWidget.prototype.bindDocumentKeyDownListener=function(){this.getElementDocument().addEventListener("keydown",this.onDocumentKeyDownHandler,!0)},OO.ui.SelectWidget.prototype.unbindDocumentKeyDownListener=function(){this.getElementDocument().removeEventListener("keydown",this.onDocumentKeyDownHandler,!0)},OO.ui.SelectWidget.prototype.scrollItemIntoView=function(t){var e=this;this.blockMouseOverEvents++,t.scrollElementIntoView().done(function(){setTimeout(function(){e.blockMouseOverEvents--},200)})},OO.ui.SelectWidget.prototype.clearKeyPressBuffer=function(){this.keyPressBufferTimer&&(clearTimeout(this.keyPressBufferTimer),this.keyPressBufferTimer=null),this.keyPressBuffer=""},OO.ui.SelectWidget.prototype.onDocumentKeyPress=function(t){var e,i,n,o;if(!t.charCode)return t.keyCode===OO.ui.Keys.BACKSPACE&&""!==this.keyPressBuffer?(this.keyPressBuffer=this.keyPressBuffer.substr(0,this.keyPressBuffer.length-1),!1):void 0;e=String.fromCodePoint?String.fromCodePoint(t.charCode):String.fromCharCode(t.charCode),this.keyPressBufferTimer&&clearTimeout(this.keyPressBufferTimer),this.keyPressBufferTimer=setTimeout(this.clearKeyPressBuffer.bind(this),1500),o=this.findSelectedItems(),n=this.findHighlightedItem()||(Array.isArray(o)?o[0]:o),this.keyPressBuffer===e?n=n&&this.findRelativeSelectableItem(n,1):this.keyPressBuffer+=e,i=this.getItemMatcher(this.keyPressBuffer,!1),n&&i(n)||(n=this.findRelativeSelectableItem(n,1,i)),n&&(this.isVisible()&&n.constructor.static.highlightable?this.highlightItem(n):this.chooseItem(n),this.scrollItemIntoView(n)),t.preventDefault(),t.stopPropagation()},OO.ui.SelectWidget.prototype.getItemMatcher=function(t,i){var n=this.constructor.static.normalizeForMatching,o=n(t);return!0===i&&(i="exact"),function(t){var e=n(t.getMatchText());if(""===o)return"exact"!==i;switch(i){case"exact":return e===o;case"substring":return-1!==e.indexOf(o);default:return 0===e.indexOf(o)}}},OO.ui.SelectWidget.prototype.bindDocumentKeyPressListener=function(){this.getElementDocument().addEventListener("keypress",this.onDocumentKeyPressHandler,!0)},OO.ui.SelectWidget.prototype.unbindDocumentKeyPressListener=function(){this.getElementDocument().removeEventListener("keypress",this.onDocumentKeyPressHandler,!0),this.clearKeyPressBuffer()},OO.ui.SelectWidget.prototype.onToggle=function(t){t||this.clearKeyPressBuffer()},OO.ui.SelectWidget.prototype.findTargetItem=function(t){var e=$(t.target).closest(".oo-ui-optionWidget");return e.closest(".oo-ui-selectWidget").is(this.$element)&&e.data("oo-ui-optionWidget")||null},OO.ui.SelectWidget.prototype.findSelectedItems=function(){var t=this.items.filter(function(t){return t.isSelected()});return this.multiselect?t:t[0]||null},OO.ui.SelectWidget.prototype.findSelectedItem=function(){return this.findSelectedItems()},OO.ui.SelectWidget.prototype.findHighlightedItem=function(){var t,e;for(t=0,e=this.items.length;t<e;t++)if(this.items[t].isHighlighted())return this.items[t];return null},OO.ui.SelectWidget.prototype.togglePressed=function(t){void 0===t&&(t=!this.pressed),t!==this.pressed&&(this.$element.toggleClass("oo-ui-selectWidget-pressed",t).toggleClass("oo-ui-selectWidget-unpressed",!t),this.pressed=t)},OO.ui.SelectWidget.prototype.highlightItem=function(t){var e,i,n,o=!1;for(e=0,i=this.items.length;e<i;e++)n=this.items[e]===t,this.items[e].isHighlighted()!==n&&(this.items[e].setHighlighted(n),o=!0);return o&&(t?this.$focusOwner.attr("aria-activedescendant",t.getElementId()):this.$focusOwner.removeAttr("aria-activedescendant"),this.emit("highlight",t)),this},OO.ui.SelectWidget.prototype.getItemFromLabel=function(t,e){var i,n,o,s=this.items.length,l=this.getItemMatcher(t,"exact");for(i=0;i<s;i++)if((n=this.items[i])instanceof OO.ui.OptionWidget&&n.isSelectable()&&l(n))return n;if(e){for(o=null,l=this.getItemMatcher(t,"prefix"),i=0;i<s;i++)if((n=this.items[i])instanceof OO.ui.OptionWidget&&n.isSelectable()&&l(n)){if(o)return null;o=n}if(o)return o}return null},OO.ui.SelectWidget.prototype.selectItemByLabel=function(t,e){var i=this.getItemFromLabel(t,!!e);return void 0!==t&&i?this.selectItem(i):this.selectItem()},OO.ui.SelectWidget.prototype.selectItemByData=function(t){var e=this.findItemFromData(t);return void 0!==t&&e?this.selectItem(e):this.selectItem()},OO.ui.SelectWidget.prototype.unselectItem=function(t){return t?t.setSelected(!1):this.items.forEach(function(t){t.setSelected(!1)}),this.emit("select",this.findSelectedItems()),this},OO.ui.SelectWidget.prototype.selectItem=function(t){var e,i,n,o=!1;if(this.multiselect&&t)t.setSelected(!0);else for(e=0,i=this.items.length;e<i;e++)n=this.items[e]===t,this.items[e].isSelected()!==n&&(this.items[e].setSelected(n),o=!0);return o&&(t&&!t.constructor.static.highlightable&&(t?this.$focusOwner.attr("aria-activedescendant",t.getElementId()):this.$focusOwner.removeAttr("aria-activedescendant")),this.emit("select",this.findSelectedItems())),this},OO.ui.SelectWidget.prototype.pressItem=function(t){var e,i,n,o=!1;for(e=0,i=this.items.length;e<i;e++)n=this.items[e]===t,this.items[e].isPressed()!==n&&(this.items[e].setPressed(n),o=!0);return o&&this.emit("press",t),this},OO.ui.SelectWidget.prototype.chooseItem=function(t){return t&&(this.multiselect&&t.isSelected()?this.unselectItem(t):this.selectItem(t),this.emit("choose",t,t.isSelected())),this},OO.ui.SelectWidget.prototype.findRelativeSelectableItem=function(t,e,i){var n,o,s=0<e?1:-1,l=this.items.length;for(n=t instanceof OO.ui.OptionWidget?(this.items.indexOf(t)+s+l)%l:0<e?0:l-1,o=0;o<l;o++){if((t=this.items[n])instanceof OO.ui.OptionWidget&&t.isSelectable()&&(!i||i(t)))return t;n=(n+s+l)%l}return null},OO.ui.SelectWidget.prototype.findFirstSelectableItem=function(){return this.findRelativeSelectableItem(null,1)},OO.ui.SelectWidget.prototype.addItems=function(t,e){return OO.ui.mixin.GroupWidget.prototype.addItems.call(this,t,e),this.emit("add",t,void 0===e?this.items.length-t.length-1:e),this},OO.ui.SelectWidget.prototype.removeItems=function(t){var e,i;for(e=0,i=t.length;e<i;e++)t[e].isSelected()&&this.selectItem(null);return OO.ui.mixin.GroupWidget.prototype.removeItems.call(this,t),this.emit("remove",t),this},OO.ui.SelectWidget.prototype.clearItems=function(){var t=this.items.slice();return OO.ui.mixin.GroupWidget.prototype.clearItems.call(this),this.selectItem(null),this.emit("remove",t),this},OO.ui.SelectWidget.prototype.setFocusOwner=function(t){this.$focusOwner=t},OO.ui.DecoratedOptionWidget=function(t){OO.ui.DecoratedOptionWidget.parent.call(this,t),OO.ui.mixin.IconElement.call(this,t),OO.ui.mixin.IndicatorElement.call(this,t),this.$element.addClass("oo-ui-decoratedOptionWidget").prepend(this.$icon).append(this.$indicator)},OO.inheritClass(OO.ui.DecoratedOptionWidget,OO.ui.OptionWidget),OO.mixinClass(OO.ui.DecoratedOptionWidget,OO.ui.mixin.IconElement),OO.mixinClass(OO.ui.DecoratedOptionWidget,OO.ui.mixin.IndicatorElement),OO.ui.MenuOptionWidget=function(t){OO.ui.MenuOptionWidget.parent.call(this,t),this.checkIcon=new OO.ui.IconWidget({icon:"check",classes:["oo-ui-menuOptionWidget-checkIcon"]}),this.$element.prepend(this.checkIcon.$element).addClass("oo-ui-menuOptionWidget")},OO.inheritClass(OO.ui.MenuOptionWidget,OO.ui.DecoratedOptionWidget),OO.ui.MenuOptionWidget.static.scrollIntoViewOnSelect=!0,OO.ui.MenuSectionOptionWidget=function(t){OO.ui.MenuSectionOptionWidget.parent.call(this,t),this.$element.addClass("oo-ui-menuSectionOptionWidget").removeAttr("role aria-selected"),this.selected=!1},OO.inheritClass(OO.ui.MenuSectionOptionWidget,OO.ui.DecoratedOptionWidget),OO.ui.MenuSectionOptionWidget.static.selectable=!1,OO.ui.MenuSectionOptionWidget.static.highlightable=!1,OO.ui.MenuSelectWidget=function(t){t=t||{},OO.ui.MenuSelectWidget.parent.call(this,t),OO.ui.mixin.ClippableElement.call(this,$.extend({$clippable:this.$group},t)),OO.ui.mixin.FloatableElement.call(this,t),this.originalVerticalPosition=this.verticalPosition,this.autoHide=void 0===t.autoHide||!!t.autoHide,this.hideOnChoose=void 0===t.hideOnChoose||!!t.hideOnChoose,this.filterFromInput=!!t.filterFromInput,this.$input=t.$input?t.$input:t.input?t.input.$input:null,this.$widget=t.widget?t.widget.$element:null,this.$autoCloseIgnore=t.$autoCloseIgnore||$([]),this.onDocumentMouseDownHandler=this.onDocumentMouseDown.bind(this),this.onInputEditHandler=OO.ui.debounce(this.updateItemVisibility.bind(this),100),this.highlightOnFilter=!!t.highlightOnFilter,this.lastHighlightedItem=null,this.width=t.width,this.filterMode=t.filterMode,this.$element.addClass("oo-ui-menuSelectWidget"),t.widget&&this.setFocusOwner(t.widget.$tabIndexed),this.visible=!1,this.$element.addClass("oo-ui-element-hidden"),this.$focusOwner.attr("aria-expanded","false")},OO.inheritClass(OO.ui.MenuSelectWidget,OO.ui.SelectWidget),OO.mixinClass(OO.ui.MenuSelectWidget,OO.ui.mixin.ClippableElement),OO.mixinClass(OO.ui.MenuSelectWidget,OO.ui.mixin.FloatableElement),OO.ui.MenuSelectWidget.static.flippedPositions={below:"above",above:"below",top:"bottom",bottom:"top"},OO.ui.MenuSelectWidget.prototype.onDocumentMouseDown=function(t){this.isVisible()&&!OO.ui.contains(this.$element.add(this.$widget).add(this.$autoCloseIgnore).get(),t.target,!0)&&this.toggle(!1)},OO.ui.MenuSelectWidget.prototype.onDocumentKeyDown=function(t){var e=this.findHighlightedItem()||this.findSelectedItem();if(!this.isDisabled()&&this.isVisible())switch(t.keyCode){case OO.ui.Keys.LEFT:case OO.ui.Keys.RIGHT:this.$input||OO.ui.MenuSelectWidget.parent.prototype.onDocumentKeyDown.call(this,t);break;case OO.ui.Keys.ESCAPE:case OO.ui.Keys.TAB:e&&!this.multiselect&&e.setHighlighted(!1),this.toggle(!1),t.keyCode===OO.ui.Keys.ESCAPE&&(t.preventDefault(),t.stopPropagation());break;default:return void OO.ui.MenuSelectWidget.parent.prototype.onDocumentKeyDown.call(this,t)}},OO.ui.MenuSelectWidget.prototype.updateItemVisibility=function(){var t,e,i,n,o,s,l,u,a=!1,r=this.items.length,h=!this.isVisible(),d=!1;if(this.$input&&this.filterFromInput){for(l=h?null:this.getItemMatcher(this.$input.val(),this.filterMode),u=this.getItemMatcher(this.$input.val(),"exact"),t=0;t<r;t++)(e=this.items[t])instanceof OO.ui.MenuSectionOptionWidget?(o&&o.toggle(h||!s),o=e,s=!0):e instanceof OO.ui.OptionWidget&&(n=h||l(e),d=d||u(e),a=a||n,s=s&&!n,e.toggle(n));if(o&&o.toggle(h||!s),a||this.highlightItem(null),this.$element.toggleClass("oo-ui-menuSelectWidget-invisible",!a),this.highlightOnFilter&&(!this.lastHighlightedItem||!this.lastHighlightedItem.isVisible())){for(e=null,i=this.getItems(),t=0;t<i.length;t++)if(i[t].isVisible()){e=i[t];break}this.highlightItem(e),this.lastHighlightedItem=e}}this.clip()},OO.ui.MenuSelectWidget.prototype.bindDocumentKeyDownListener=function(){this.$input?this.$input.on("keydown",this.onDocumentKeyDownHandler):OO.ui.MenuSelectWidget.parent.prototype.bindDocumentKeyDownListener.call(this)},OO.ui.MenuSelectWidget.prototype.unbindDocumentKeyDownListener=function(){this.$input?this.$input.off("keydown",this.onDocumentKeyDownHandler):OO.ui.MenuSelectWidget.parent.prototype.unbindDocumentKeyDownListener.call(this)},OO.ui.MenuSelectWidget.prototype.bindDocumentKeyPressListener=function(){this.$input?this.filterFromInput&&(this.$input.on("keydown mouseup cut paste change input select",this.onInputEditHandler),this.updateItemVisibility()):OO.ui.MenuSelectWidget.parent.prototype.bindDocumentKeyPressListener.call(this)},OO.ui.MenuSelectWidget.prototype.unbindDocumentKeyPressListener=function(){this.$input?this.filterFromInput&&(this.$input.off("keydown mouseup cut paste change input select",this.onInputEditHandler),this.updateItemVisibility()):OO.ui.MenuSelectWidget.parent.prototype.unbindDocumentKeyPressListener.call(this)},OO.ui.MenuSelectWidget.prototype.chooseItem=function(t){return OO.ui.MenuSelectWidget.parent.prototype.chooseItem.call(this,t),this.hideOnChoose&&this.toggle(!1),this},OO.ui.MenuSelectWidget.prototype.addItems=function(t,e){return OO.ui.MenuSelectWidget.parent.prototype.addItems.call(this,t,e),this.updateItemVisibility(),this},OO.ui.MenuSelectWidget.prototype.removeItems=function(t){return OO.ui.MenuSelectWidget.parent.prototype.removeItems.call(this,t),this.updateItemVisibility(),this},OO.ui.MenuSelectWidget.prototype.clearItems=function(){return OO.ui.MenuSelectWidget.parent.prototype.clearItems.call(this),this.updateItemVisibility(),this},OO.ui.MenuSelectWidget.prototype.toggle=function(t){var e,i,n;return e=(t=(void 0===t?!this.visible:!!t)&&!!this.items.length)!==this.isVisible(),!t||this.warnedUnattached||this.isElementAttached()||(OO.ui.warnDeprecation("MenuSelectWidget#toggle: Before calling this method, the menu must be attached to the DOM."),this.warnedUnattached=!0),e&&t&&this.setVerticalPosition(this.originalVerticalPosition),OO.ui.MenuSelectWidget.parent.prototype.toggle.call(this,t),e&&(t?(this.width?this.setIdealSize(this.width):this.$floatableContainer&&(this.$clippable.css("width","auto"),this.setIdealSize(this.$floatableContainer[0].offsetWidth>this.$clippable[0].offsetWidth?this.$floatableContainer[0].offsetWidth:"auto"),this.$clippable.css("width","")),this.togglePositioning(!!this.$floatableContainer),this.toggleClipping(!0),this.bindDocumentKeyDownListener(),this.bindDocumentKeyPressListener(),(this.isClippedVertically()||this.isFloatableOutOfView())&&"center"!==this.originalVerticalPosition&&(i=this.$element.height(),this.setVerticalPosition(this.constructor.static.flippedPositions[this.originalVerticalPosition]),(this.isClippedVertically()||this.isFloatableOutOfView())&&this.$element.height()<i&&this.setVerticalPosition(this.originalVerticalPosition)),this.$focusOwner.attr("aria-expanded","true"),n=this.findSelectedItem(),!this.multiselect&&n&&(this.$focusOwner.attr("aria-activedescendant",n.getElementId()),n.scrollElementIntoView({duration:0})),this.autoHide&&this.getElementDocument().addEventListener("mousedown",this.onDocumentMouseDownHandler,!0),this.emit("ready")):(this.$focusOwner.removeAttr("aria-activedescendant"),this.unbindDocumentKeyDownListener(),this.unbindDocumentKeyPressListener(),this.$focusOwner.attr("aria-expanded","false"),this.getElementDocument().removeEventListener("mousedown",this.onDocumentMouseDownHandler,!0),this.togglePositioning(!1),this.toggleClipping(!1),this.lastHighlightedItem=null)),this},OO.ui.MenuSelectWidget.prototype.scrollToTop=function(){this.$element.scrollTop(0)},OO.ui.DropdownWidget=function(t){t=$.extend({indicator:"down"},t),OO.ui.DropdownWidget.parent.call(this,t),this.$handle=$("<span>"),this.$overlay=(!0===t.$overlay?OO.ui.getDefaultOverlay():t.$overlay)||this.$element,OO.ui.mixin.IconElement.call(this,t),OO.ui.mixin.IndicatorElement.call(this,t),OO.ui.mixin.LabelElement.call(this,t),OO.ui.mixin.TitledElement.call(this,$.extend({$titled:this.$label},t)),OO.ui.mixin.TabIndexedElement.call(this,$.extend({$tabIndexed:this.$handle},t)),this.menu=new OO.ui.MenuSelectWidget($.extend({widget:this,$floatableContainer:this.$element},t.menu)),this.$handle.on({click:this.onClick.bind(this),keydown:this.onKeyDown.bind(this),keypress:this.menu.onDocumentKeyPressHandler,blur:this.menu.clearKeyPressBuffer.bind(this.menu)}),this.menu.connect(this,{select:"onMenuSelect",toggle:"onMenuToggle"}),this.$label.attr({role:"textbox","aria-readonly":"true"}),this.$handle.addClass("oo-ui-dropdownWidget-handle").append(this.$icon,this.$label,this.$indicator).attr({role:"combobox","aria-autocomplete":"list","aria-expanded":"false","aria-haspopup":"true","aria-owns":this.menu.getElementId()}),this.$element.addClass("oo-ui-dropdownWidget").append(this.$handle),this.$overlay.append(this.menu.$element)},OO.inheritClass(OO.ui.DropdownWidget,OO.ui.Widget),OO.mixinClass(OO.ui.DropdownWidget,OO.ui.mixin.IconElement),OO.mixinClass(OO.ui.DropdownWidget,OO.ui.mixin.IndicatorElement),OO.mixinClass(OO.ui.DropdownWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.DropdownWidget,OO.ui.mixin.TitledElement),OO.mixinClass(OO.ui.DropdownWidget,OO.ui.mixin.TabIndexedElement),OO.ui.DropdownWidget.prototype.getMenu=function(){return this.menu},OO.ui.DropdownWidget.prototype.onMenuSelect=function(t){var e;t?((e=t.getLabel())instanceof $&&(e=e.clone()),this.setLabel(e)):this.setLabel(null)},OO.ui.DropdownWidget.prototype.onMenuToggle=function(t){this.$element.toggleClass("oo-ui-dropdownWidget-open",t)},OO.ui.DropdownWidget.prototype.onClick=function(t){return this.isDisabled()||t.which!==OO.ui.MouseButtons.LEFT||this.menu.toggle(),!1},OO.ui.DropdownWidget.prototype.onKeyDown=function(t){if(!this.isDisabled()&&(t.which===OO.ui.Keys.ENTER||t.which===OO.ui.Keys.SPACE&&""===this.menu.keyPressBuffer||!this.menu.isVisible()&&(t.which===OO.ui.Keys.UP||t.which===OO.ui.Keys.DOWN)))return this.menu.toggle(),!1},OO.ui.RadioOptionWidget=function(t){t=t||{},this.radio=new OO.ui.RadioInputWidget({value:t.data,tabIndex:-1}),OO.ui.RadioOptionWidget.parent.call(this,t),this.radio.$input.attr("role","presentation"),this.$element.addClass("oo-ui-radioOptionWidget").attr("role","radio").attr("aria-checked","false").removeAttr("aria-selected").prepend(this.radio.$element)},OO.inheritClass(OO.ui.RadioOptionWidget,OO.ui.OptionWidget),OO.ui.RadioOptionWidget.static.highlightable=!1,OO.ui.RadioOptionWidget.static.scrollIntoViewOnSelect=!0,OO.ui.RadioOptionWidget.static.pressable=!1,OO.ui.RadioOptionWidget.static.tagName="label",OO.ui.RadioOptionWidget.prototype.setSelected=function(t){return OO.ui.RadioOptionWidget.parent.prototype.setSelected.call(this,t),this.radio.setSelected(t),this.$element.attr("aria-checked",t.toString()).removeAttr("aria-selected"),this},OO.ui.RadioOptionWidget.prototype.setDisabled=function(t){return OO.ui.RadioOptionWidget.parent.prototype.setDisabled.call(this,t),this.radio.setDisabled(this.isDisabled()),this},OO.ui.RadioSelectWidget=function(t){OO.ui.RadioSelectWidget.parent.call(this,t),OO.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindDocumentKeyDownListener.bind(this),blur:this.unbindDocumentKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-radioSelectWidget").attr("role","radiogroup")},OO.inheritClass(OO.ui.RadioSelectWidget,OO.ui.SelectWidget),OO.mixinClass(OO.ui.RadioSelectWidget,OO.ui.mixin.TabIndexedElement),OO.ui.MultioptionWidget=function(t){t=t||{},OO.ui.MultioptionWidget.parent.call(this,t),OO.ui.mixin.ItemWidget.call(this),OO.ui.mixin.LabelElement.call(this,t),OO.ui.mixin.TitledElement.call(this,t),this.selected=null,this.$element.addClass("oo-ui-multioptionWidget").append(this.$label),this.setSelected(t.selected)},OO.inheritClass(OO.ui.MultioptionWidget,OO.ui.Widget),OO.mixinClass(OO.ui.MultioptionWidget,OO.ui.mixin.ItemWidget),OO.mixinClass(OO.ui.MultioptionWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.MultioptionWidget,OO.ui.mixin.TitledElement),OO.ui.MultioptionWidget.prototype.isSelected=function(){return this.selected},OO.ui.MultioptionWidget.prototype.setSelected=function(t){return t=!!t,this.selected!==t&&(this.selected=t,this.emit("change",t),this.$element.toggleClass("oo-ui-multioptionWidget-selected",t)),this},OO.ui.MultiselectWidget=function(t){OO.ui.MultiselectWidget.parent.call(this,t),t=t||{},OO.ui.mixin.GroupWidget.call(this,t),OO.ui.mixin.TitledElement.call(this,t),this.aggregate({change:"select"}),this.connect(this,{select:["emit","change"]}),t.items&&this.addItems(t.items),this.$group.addClass("oo-ui-multiselectWidget-group"),this.$element.addClass("oo-ui-multiselectWidget").append(this.$group)},OO.inheritClass(OO.ui.MultiselectWidget,OO.ui.Widget),OO.mixinClass(OO.ui.MultiselectWidget,OO.ui.mixin.GroupWidget),OO.mixinClass(OO.ui.MultiselectWidget,OO.ui.mixin.TitledElement),OO.ui.MultiselectWidget.prototype.findSelectedItems=function(){return this.items.filter(function(t){return t.isSelected()})},OO.ui.MultiselectWidget.prototype.findSelectedItemsData=function(){return this.findSelectedItems().map(function(t){return t.data})},OO.ui.MultiselectWidget.prototype.selectItems=function(i){return this.items.forEach(function(t){var e=-1!==i.indexOf(t);t.setSelected(e)}),this},OO.ui.MultiselectWidget.prototype.selectItemsByData=function(t){var e,i=this;return e=t.map(function(t){return i.findItemFromData(t)}),this.selectItems(e),this},OO.ui.CheckboxMultioptionWidget=function(t){t=t||{},this.checkbox=new OO.ui.CheckboxInputWidget,OO.ui.CheckboxMultioptionWidget.parent.call(this,t),this.checkbox.on("change",this.onCheckboxChange.bind(this)),this.$element.on("keydown",this.onKeyDown.bind(this)),this.$element.addClass("oo-ui-checkboxMultioptionWidget").prepend(this.checkbox.$element)},OO.inheritClass(OO.ui.CheckboxMultioptionWidget,OO.ui.MultioptionWidget),OO.ui.CheckboxMultioptionWidget.static.tagName="label",OO.ui.CheckboxMultioptionWidget.prototype.onCheckboxChange=function(){this.setSelected(this.checkbox.isSelected())},OO.ui.CheckboxMultioptionWidget.prototype.setSelected=function(t){return OO.ui.CheckboxMultioptionWidget.parent.prototype.setSelected.call(this,t),this.checkbox.setSelected(t),this},OO.ui.CheckboxMultioptionWidget.prototype.setDisabled=function(t){return OO.ui.CheckboxMultioptionWidget.parent.prototype.setDisabled.call(this,t),this.checkbox.setDisabled(this.isDisabled()),this},OO.ui.CheckboxMultioptionWidget.prototype.focus=function(){this.checkbox.focus()},OO.ui.CheckboxMultioptionWidget.prototype.onKeyDown=function(t){var e,i=this.getElementGroup();t.keyCode===OO.ui.Keys.LEFT||t.keyCode===OO.ui.Keys.UP?e=i.getRelativeFocusableItem(this,-1):t.keyCode!==OO.ui.Keys.RIGHT&&t.keyCode!==OO.ui.Keys.DOWN||(e=i.getRelativeFocusableItem(this,1)),e&&(t.preventDefault(),e.focus())},OO.ui.CheckboxMultiselectWidget=function(t){OO.ui.CheckboxMultiselectWidget.parent.call(this,t),this.$lastClicked=null,this.$group.on("click",this.onClick.bind(this)),this.$element.addClass("oo-ui-checkboxMultiselectWidget")},OO.inheritClass(OO.ui.CheckboxMultiselectWidget,OO.ui.MultiselectWidget),OO.ui.CheckboxMultiselectWidget.prototype.getRelativeFocusableItem=function(t,e){var i,n,o=0<e?1:-1,s=this.items.length;for(i=t?(this.items.indexOf(t)+o+s)%s:0<e?0:s-1,n=0;n<s;n++){if((t=this.items[i])&&!t.isDisabled())return t;i=(i+o+s)%s}return null},OO.ui.CheckboxMultiselectWidget.prototype.onClick=function(t){var e,i,n,o,s,l,u,a=this.$lastClicked,r=$(t.target).closest(".oo-ui-checkboxMultioptionWidget").not(".oo-ui-widget-disabled");if(a&&r.length&&t.shiftKey&&(i=(e=this.$group.find(".oo-ui-checkboxMultioptionWidget")).index(a),(n=e.index(r))!==i)){for(u=this.items,l=u[n].isSelected(),s=i<n?1:-1,o=i;o!==n;o+=s)u[o].isDisabled()||u[o].setSelected(!l);t.preventDefault(),setTimeout(function(){u[n].isDisabled()||u[n].setSelected(!l)})}r.length&&(this.$lastClicked=r)},OO.ui.CheckboxMultiselectWidget.prototype.focus=function(){var t;return this.isDisabled()||(t=this.getRelativeFocusableItem(null,1))&&t.focus(),this},OO.ui.CheckboxMultiselectWidget.prototype.simulateLabelClick=function(){this.focus()},OO.ui.ProgressBarWidget=function(t){t=t||{},OO.ui.ProgressBarWidget.parent.call(this,t),this.$bar=$("<div>"),this.progress=null,this.setProgress(void 0!==t.progress&&t.progress),this.$bar.addClass("oo-ui-progressBarWidget-bar"),this.$element.attr({role:"progressbar","aria-valuemin":0,"aria-valuemax":100}).addClass("oo-ui-progressBarWidget").append(this.$bar)},OO.inheritClass(OO.ui.ProgressBarWidget,OO.ui.Widget),OO.ui.ProgressBarWidget.static.tagName="div",OO.ui.ProgressBarWidget.prototype.getProgress=function(){return this.progress},OO.ui.ProgressBarWidget.prototype.setProgress=function(t){!1!==(this.progress=t)?(this.$bar.css("width",this.progress+"%"),this.$element.attr("aria-valuenow",this.progress)):(this.$bar.css("width",""),this.$element.removeAttr("aria-valuenow")),this.$element.toggleClass("oo-ui-progressBarWidget-indeterminate",!1===t)},OO.ui.InputWidget=function(t){t=t||{},OO.ui.InputWidget.parent.call(this,t),this.$input=t.$input||this.getInputElement(t),this.value="",this.inputFilter=t.inputFilter,OO.ui.mixin.TabIndexedElement.call(this,$.extend({$tabIndexed:this.$input},t)),OO.ui.mixin.TitledElement.call(this,$.extend({$titled:this.$input},t)),OO.ui.mixin.AccessKeyedElement.call(this,$.extend({$accessKeyed:this.$input},t)),this.$input.on("keydown mouseup cut paste change input select",this.onEdit.bind(this)),this.$input.addClass("oo-ui-inputWidget-input").attr("name",t.name).prop("disabled",this.isDisabled()),this.$element.addClass("oo-ui-inputWidget").append(this.$input),this.setValue(t.value),t.dir&&this.setDir(t.dir),void 0!==t.inputId&&this.setInputId(t.inputId)},OO.inheritClass(OO.ui.InputWidget,OO.ui.Widget),OO.mixinClass(OO.ui.InputWidget,OO.ui.mixin.TabIndexedElement),OO.mixinClass(OO.ui.InputWidget,OO.ui.mixin.TitledElement),OO.mixinClass(OO.ui.InputWidget,OO.ui.mixin.AccessKeyedElement),OO.ui.InputWidget.static.reusePreInfuseDOM=function(t,e){return(e=OO.ui.InputWidget.parent.static.reusePreInfuseDOM(t,e)).$input=$(t).find(".oo-ui-inputWidget-input"),e},OO.ui.InputWidget.static.gatherPreInfuseState=function(t,e){var i=OO.ui.InputWidget.parent.static.gatherPreInfuseState(t,e);return e.$input&&e.$input.length&&(i.value=e.$input.val(),i.focus=e.$input.is(":focus")),i},OO.ui.InputWidget.prototype.getInputElement=function(){return $("<input>")},OO.ui.InputWidget.prototype.onEdit=function(){var t=this;this.isDisabled()||setTimeout(function(){t.setValue(t.$input.val())})},OO.ui.InputWidget.prototype.getValue=function(){var t=this.$input.val();return this.value!==t&&this.setValue(t),this.value},OO.ui.InputWidget.prototype.setDir=function(t){return this.$input.prop("dir",t),this},OO.ui.InputWidget.prototype.setValue=function(t){return t=this.cleanUpValue(t),this.$input.val()!==t&&this.$input.val(t),this.value!==t&&(this.value=t,this.emit("change",this.value)),void 0===this.defaultValue&&(this.defaultValue=this.value,this.$input[0].defaultValue=this.defaultValue),this},OO.ui.InputWidget.prototype.cleanUpValue=function(t){return null==t?"":this.inputFilter?this.inputFilter(String(t)):String(t)},OO.ui.InputWidget.prototype.setDisabled=function(t){return OO.ui.InputWidget.parent.prototype.setDisabled.call(this,t),this.$input&&this.$input.prop("disabled",this.isDisabled()),this},OO.ui.InputWidget.prototype.setInputId=function(t){return this.$input.attr("id",t),this},OO.ui.InputWidget.prototype.restorePreInfuseState=function(t){OO.ui.InputWidget.parent.prototype.restorePreInfuseState.call(this,t),void 0!==t.value&&t.value!==this.getValue()&&this.setValue(t.value),t.focus&&this.focus()},OO.ui.HiddenInputWidget=function(t){t=$.extend({value:"",name:""},t),OO.ui.HiddenInputWidget.parent.call(this,t),this.$element.attr({type:"hidden",value:t.value,name:t.name}),this.$element.removeAttr("aria-disabled")},OO.inheritClass(OO.ui.HiddenInputWidget,OO.ui.Widget),OO.ui.HiddenInputWidget.static.tagName="input",OO.ui.ButtonInputWidget=function(t){(t=$.extend({type:"button",useInputTag:!1},t)).$input&&t.$input.empty(),this.useInputTag=t.useInputTag,OO.ui.ButtonInputWidget.parent.call(this,t),OO.ui.mixin.ButtonElement.call(this,$.extend({$button:this.$input},t)),OO.ui.mixin.IconElement.call(this,t),OO.ui.mixin.IndicatorElement.call(this,t),OO.ui.mixin.LabelElement.call(this,t),OO.ui.mixin.FlaggedElement.call(this,t),t.useInputTag||this.$input.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-buttonInputWidget")},OO.inheritClass(OO.ui.ButtonInputWidget,OO.ui.InputWidget),OO.mixinClass(OO.ui.ButtonInputWidget,OO.ui.mixin.ButtonElement),OO.mixinClass(OO.ui.ButtonInputWidget,OO.ui.mixin.IconElement),OO.mixinClass(OO.ui.ButtonInputWidget,OO.ui.mixin.IndicatorElement),OO.mixinClass(OO.ui.ButtonInputWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.ButtonInputWidget,OO.ui.mixin.FlaggedElement),OO.ui.ButtonInputWidget.static.tagName="span",OO.ui.ButtonInputWidget.prototype.getInputElement=function(t){var e;return e=-1!==["button","submit","reset"].indexOf(t.type)?t.type:"button",$("<"+(t.useInputTag?"input":"button")+' type="'+e+'">')},OO.ui.ButtonInputWidget.prototype.setLabel=function(t){return"function"==typeof t&&(t=OO.ui.resolveMsg(t)),this.useInputTag&&("string"!=typeof t&&(t=""),this.$input.val(t)),OO.ui.mixin.LabelElement.prototype.setLabel.call(this,t)},OO.ui.ButtonInputWidget.prototype.setValue=function(t){return this.useInputTag||OO.ui.ButtonInputWidget.parent.prototype.setValue.call(this,t),this},OO.ui.ButtonInputWidget.prototype.getInputId=function(){return null},OO.ui.CheckboxInputWidget=function(t){t=t||{},OO.ui.CheckboxInputWidget.parent.call(this,t),this.checkIcon=new OO.ui.IconWidget({icon:"check",classes:["oo-ui-checkboxInputWidget-checkIcon"]}),this.$element.addClass("oo-ui-checkboxInputWidget").append(this.checkIcon.$element),this.setSelected(void 0!==t.selected&&t.selected),this.setIndeterminate(void 0!==t.indeterminate&&t.indeterminate)},OO.inheritClass(OO.ui.CheckboxInputWidget,OO.ui.InputWidget),OO.ui.CheckboxInputWidget.static.tagName="span",OO.ui.CheckboxInputWidget.static.gatherPreInfuseState=function(t,e){var i=OO.ui.CheckboxInputWidget.parent.static.gatherPreInfuseState(t,e);return i.checked=e.$input.prop("checked"),i},OO.ui.CheckboxInputWidget.prototype.getInputElement=function(){return $("<input>").attr("type","checkbox")},OO.ui.CheckboxInputWidget.prototype.onEdit=function(){var t=this;this.isDisabled()||setTimeout(function(){t.setSelected(t.$input.prop("checked")),t.setIndeterminate(t.$input.prop("indeterminate"))})},OO.ui.CheckboxInputWidget.prototype.setSelected=function(t,e){return t=!!t,this.selected!==t&&(this.selected=t,this.$input.prop("checked",this.selected),e||(this.setIndeterminate(!1,!0),this.emit("change",this.selected,this.indeterminate))),void 0===this.defaultSelected&&(this.defaultSelected=this.selected,this.$input[0].defaultChecked=this.defaultSelected),this},OO.ui.CheckboxInputWidget.prototype.isSelected=function(){var t=this.$input.prop("checked");return this.selected!==t&&this.setSelected(t),this.selected},OO.ui.CheckboxInputWidget.prototype.setIndeterminate=function(t,e){return t=!!t,this.indeterminate!==t&&(this.indeterminate=t,this.$input.prop("indeterminate",this.indeterminate),e||(this.setSelected(!1,!0),this.emit("change",this.selected,this.indeterminate))),this},OO.ui.CheckboxInputWidget.prototype.isIndeterminate=function(){var t=this.$input.prop("indeterminate");return this.indeterminate!==t&&this.setIndeterminate(t),this.indeterminate},OO.ui.CheckboxInputWidget.prototype.simulateLabelClick=function(){this.isDisabled()||this.$handle.trigger("click"),this.focus()},OO.ui.CheckboxInputWidget.prototype.restorePreInfuseState=function(t){OO.ui.CheckboxInputWidget.parent.prototype.restorePreInfuseState.call(this,t),void 0!==t.checked&&t.checked!==this.isSelected()&&this.setSelected(t.checked)},OO.ui.DropdownInputWidget=function(t){t=t||{},this.dropdownWidget=new OO.ui.DropdownWidget($.extend({$overlay:t.$overlay},t.dropdown)),this.setOptionsData(t.options||[]),OO.ui.DropdownInputWidget.parent.call(this,t),this.dropdownWidget.getMenu().connect(this,{select:"onMenuSelect"}),this.$element.addClass("oo-ui-dropdownInputWidget").append(this.dropdownWidget.$element),OO.ui.isMobile()&&this.$element.addClass("oo-ui-isMobile"),this.setTabIndexedElement(this.dropdownWidget.$tabIndexed),this.setTitledElement(this.dropdownWidget.$handle)},OO.inheritClass(OO.ui.DropdownInputWidget,OO.ui.InputWidget),OO.ui.DropdownInputWidget.prototype.getInputElement=function(){return $("<select>").addClass("oo-ui-indicator-down")},OO.ui.DropdownInputWidget.prototype.onMenuSelect=function(t){this.setValue(t?t.getData():"")},OO.ui.DropdownInputWidget.prototype.setValue=function(t){var e;return t=this.cleanUpValue(t),e=this.dropdownWidget.getMenu().findItemFromData(t)||this.dropdownWidget.getMenu().findFirstSelectableItem(),this.dropdownWidget.getMenu().selectItem(e),t=e?e.getData():"",OO.ui.DropdownInputWidget.parent.prototype.setValue.call(this,t),this.optionsDirty&&this.updateOptionsInterface(),this},OO.ui.DropdownInputWidget.prototype.setDisabled=function(t){return this.dropdownWidget.setDisabled(t),OO.ui.DropdownInputWidget.parent.prototype.setDisabled.call(this,t),this},OO.ui.DropdownInputWidget.prototype.setOptions=function(t){var e=this.getValue();return this.setOptionsData(t),this.setValue(e),this},OO.ui.DropdownInputWidget.prototype.setOptionsData=function(t){var e,i,n,o,s,l;for(this.optionsDirty=!0,e=[],i=0;i<t.length;i++)void 0!==(n=t[i]).optgroup?o=s=this.createMenuSectionOptionWidget(n.optgroup):(l=this.cleanUpValue(n.data),s=this.createMenuOptionWidget(l,void 0!==n.label?n.label:l)),(void 0!==n.disabled||o instanceof OO.ui.MenuSectionOptionWidget&&o.isDisabled())&&s.setDisabled(!0),e.push(s);this.dropdownWidget.getMenu().clearItems().addItems(e)},OO.ui.DropdownInputWidget.prototype.createMenuOptionWidget=function(t,e){return new OO.ui.MenuOptionWidget({data:t,label:e})},OO.ui.DropdownInputWidget.prototype.createMenuSectionOptionWidget=function(t){return new OO.ui.MenuSectionOptionWidget({label:t})},OO.ui.DropdownInputWidget.prototype.updateOptionsInterface=function(){var i=this.$input,n=this.defaultValue,o=this;this.$input.empty(),this.dropdownWidget.getMenu().getItems().forEach(function(t){var e;t instanceof OO.ui.MenuSectionOptionWidget?(e=$("<optgroup>").attr("label",t.getLabel()),o.$input.append(e),i=e):((e=$("<option>").attr("value",t.getData()).text(t.getLabel()))[0].defaultSelected=t.getData()===n,i.append(e)),t.isDisabled()&&e.prop("disabled",!0)}),this.optionsDirty=!1},OO.ui.DropdownInputWidget.prototype.focus=function(){return this.dropdownWidget.focus(),this},OO.ui.DropdownInputWidget.prototype.blur=function(){return this.dropdownWidget.blur(),this},OO.ui.RadioInputWidget=function(t){t=t||{},OO.ui.RadioInputWidget.parent.call(this,t),this.$element.addClass("oo-ui-radioInputWidget").append($("<span>")),this.setSelected(void 0!==t.selected&&t.selected)},OO.inheritClass(OO.ui.RadioInputWidget,OO.ui.InputWidget),OO.ui.RadioInputWidget.static.tagName="span",OO.ui.RadioInputWidget.static.gatherPreInfuseState=function(t,e){var i=OO.ui.RadioInputWidget.parent.static.gatherPreInfuseState(t,e);return i.checked=e.$input.prop("checked"),i},OO.ui.RadioInputWidget.prototype.getInputElement=function(){return $("<input>").attr("type","radio")},OO.ui.RadioInputWidget.prototype.onEdit=function(){},OO.ui.RadioInputWidget.prototype.setSelected=function(t){return this.$input.prop("checked",t),void 0===this.defaultSelected&&(this.defaultSelected=t,this.$input[0].defaultChecked=this.defaultSelected),this},OO.ui.RadioInputWidget.prototype.isSelected=function(){return this.$input.prop("checked")},OO.ui.RadioInputWidget.prototype.simulateLabelClick=function(){this.isDisabled()||this.$input.trigger("click"),this.focus()},OO.ui.RadioInputWidget.prototype.restorePreInfuseState=function(t){OO.ui.RadioInputWidget.parent.prototype.restorePreInfuseState.call(this,t),void 0!==t.checked&&t.checked!==this.isSelected()&&this.setSelected(t.checked)},OO.ui.RadioSelectInputWidget=function(t){t=t||{},this.radioSelectWidget=new OO.ui.RadioSelectWidget,this.setOptionsData(t.options||[]),OO.ui.RadioSelectInputWidget.parent.call(this,t),this.radioSelectWidget.connect(this,{select:"onMenuSelect"}),this.$element.addClass("oo-ui-radioSelectInputWidget").append(this.radioSelectWidget.$element),this.setTabIndexedElement(this.radioSelectWidget.$tabIndexed)},OO.inheritClass(OO.ui.RadioSelectInputWidget,OO.ui.InputWidget),OO.ui.RadioSelectInputWidget.static.gatherPreInfuseState=function(t,e){var i=OO.ui.RadioSelectInputWidget.parent.static.gatherPreInfuseState(t,e);return i.value=$(t).find(".oo-ui-radioInputWidget .oo-ui-inputWidget-input:checked").val(),i},OO.ui.RadioSelectInputWidget.static.reusePreInfuseDOM=function(t,e){return delete(e=OO.ui.RadioSelectInputWidget.parent.static.reusePreInfuseDOM(t,e)).$input,e},OO.ui.RadioSelectInputWidget.prototype.getInputElement=function(){return $("<input>").addClass("oo-ui-element-hidden")},OO.ui.RadioSelectInputWidget.prototype.onMenuSelect=function(t){this.setValue(t.getData())},OO.ui.RadioSelectInputWidget.prototype.setValue=function(t){var e;return t=this.cleanUpValue(t),e=this.radioSelectWidget.findItemFromData(t)||this.radioSelectWidget.findFirstSelectableItem(),this.radioSelectWidget.selectItem(e),t=e?e.getData():"",OO.ui.RadioSelectInputWidget.parent.prototype.setValue.call(this,t),this},OO.ui.RadioSelectInputWidget.prototype.setDisabled=function(t){return this.radioSelectWidget.setDisabled(t),OO.ui.RadioSelectInputWidget.parent.prototype.setDisabled.call(this,t),this},OO.ui.RadioSelectInputWidget.prototype.setOptions=function(t){var e=this.getValue();return this.setOptionsData(t),this.setValue(e),this},OO.ui.RadioSelectInputWidget.prototype.setOptionsData=function(t){var i=this;this.radioSelectWidget.clearItems().addItems(t.map(function(t){var e=i.cleanUpValue(t.data);return new OO.ui.RadioOptionWidget({data:e,label:void 0!==t.label?t.label:e})}))},OO.ui.RadioSelectInputWidget.prototype.focus=function(){return this.radioSelectWidget.focus(),this},OO.ui.RadioSelectInputWidget.prototype.blur=function(){return this.radioSelectWidget.blur(),this},OO.ui.CheckboxMultiselectInputWidget=function(t){t=t||{},this.checkboxMultiselectWidget=new OO.ui.CheckboxMultiselectWidget,this.inputName=t.name,this.setOptionsData(t.options||[]),OO.ui.CheckboxMultiselectInputWidget.parent.call(this,t),this.checkboxMultiselectWidget.connect(this,{select:"onCheckboxesSelect"}),this.$element.addClass("oo-ui-checkboxMultiselectInputWidget").append(this.checkboxMultiselectWidget.$element),this.$input.detach()},OO.inheritClass(OO.ui.CheckboxMultiselectInputWidget,OO.ui.InputWidget),OO.ui.CheckboxMultiselectInputWidget.static.gatherPreInfuseState=function(t,e){var i=OO.ui.CheckboxMultiselectInputWidget.parent.static.gatherPreInfuseState(t,e);return i.value=$(t).find(".oo-ui-checkboxInputWidget .oo-ui-inputWidget-input:checked").toArray().map(function(t){return t.value}),i},OO.ui.CheckboxMultiselectInputWidget.static.reusePreInfuseDOM=function(t,e){return delete(e=OO.ui.CheckboxMultiselectInputWidget.parent.static.reusePreInfuseDOM(t,e)).$input,e},OO.ui.CheckboxMultiselectInputWidget.prototype.getInputElement=function(){return $("<unused>")},OO.ui.CheckboxMultiselectInputWidget.prototype.onCheckboxesSelect=function(){this.setValue(this.checkboxMultiselectWidget.findSelectedItemsData())},OO.ui.CheckboxMultiselectInputWidget.prototype.getValue=function(){var t=this.$element.find(".oo-ui-checkboxInputWidget .oo-ui-inputWidget-input:checked").toArray().map(function(t){return t.value});return this.value!==t&&this.setValue(t),this.value},OO.ui.CheckboxMultiselectInputWidget.prototype.setValue=function(t){return t=this.cleanUpValue(t),this.checkboxMultiselectWidget.selectItemsByData(t),OO.ui.CheckboxMultiselectInputWidget.parent.prototype.setValue.call(this,t),this.optionsDirty&&this.updateOptionsInterface(),this},OO.ui.CheckboxMultiselectInputWidget.prototype.cleanUpValue=function(t){var e,i,n=[];if(!Array.isArray(t))return n;for(e=0;e<t.length;e++)i=OO.ui.CheckboxMultiselectInputWidget.parent.prototype.cleanUpValue.call(this,t[e]),this.checkboxMultiselectWidget.findItemFromData(i)&&n.push(i);return n},OO.ui.CheckboxMultiselectInputWidget.prototype.setDisabled=function(t){return this.checkboxMultiselectWidget.setDisabled(t),OO.ui.CheckboxMultiselectInputWidget.parent.prototype.setDisabled.call(this,t),this},OO.ui.CheckboxMultiselectInputWidget.prototype.setOptions=function(t){var e=this.getValue();return this.setOptionsData(t),this.setValue(e),this},OO.ui.CheckboxMultiselectInputWidget.prototype.setOptionsData=function(t){var o=this;this.optionsDirty=!0,this.checkboxMultiselectWidget.clearItems().addItems(t.map(function(t){var e,i,n;return e=OO.ui.CheckboxMultiselectInputWidget.parent.prototype.cleanUpValue.call(o,t.data),n=void 0!==t.disabled&&t.disabled,(i=new OO.ui.CheckboxMultioptionWidget({data:e,label:void 0!==t.label?t.label:e,disabled:n})).checkbox.$input.attr("name",o.inputName),i.checkbox.setValue(e),i}))},OO.ui.CheckboxMultiselectInputWidget.prototype.updateOptionsInterface=function(){var i=this.defaultValue;this.checkboxMultiselectWidget.getItems().forEach(function(t){var e=-1!==i.indexOf(t.getData());t.checkbox.defaultSelected=e,t.checkbox.$input[0].defaultChecked=e}),this.optionsDirty=!1},OO.ui.CheckboxMultiselectInputWidget.prototype.focus=function(){return this.checkboxMultiselectWidget.focus(),this},OO.ui.TextInputWidget=function(t){t=$.extend({type:"text",labelPosition:"after"},t),OO.ui.TextInputWidget.parent.call(this,t),OO.ui.mixin.IconElement.call(this,t),OO.ui.mixin.IndicatorElement.call(this,t),OO.ui.mixin.PendingElement.call(this,$.extend({$pending:this.$input},t)),OO.ui.mixin.LabelElement.call(this,t),OO.ui.mixin.FlaggedElement.call(this,t),this.type=this.getSaneType(t),this.readOnly=!1,this.required=!1,this.validate=null,this.scrollWidth=null,this.setValidation(t.validate),this.setLabelPosition(t.labelPosition),this.$input.on({keypress:this.onKeyPress.bind(this),blur:this.onBlur.bind(this),focus:this.onFocus.bind(this)}),this.$icon.on("mousedown",this.onIconMouseDown.bind(this)),this.$indicator.on("mousedown",this.onIndicatorMouseDown.bind(this)),this.on("labelChange",this.updatePosition.bind(this)),this.on("change",OO.ui.debounce(this.onDebouncedChange.bind(this),250)),this.$element.addClass("oo-ui-textInputWidget oo-ui-textInputWidget-type-"+this.type).append(this.$icon,this.$indicator),this.setReadOnly(!!t.readOnly),this.setRequired(!!t.required),void 0!==t.placeholder&&this.$input.attr("placeholder",t.placeholder),void 0!==t.maxLength&&this.$input.attr("maxlength",t.maxLength),t.autofocus&&this.$input.attr("autofocus","autofocus"),!1===t.autocomplete&&(this.$input.attr("autocomplete","off"),$(window).on({beforeunload:function(){this.$input.removeAttr("autocomplete")}.bind(this),pageshow:function(){this.$input.attr("autocomplete","off")}.bind(this)})),void 0!==t.spellcheck&&this.$input.attr("spellcheck",t.spellcheck?"true":"false"),this.label&&(this.isWaitingToBeAttached=!0,this.installParentChangeDetector())},OO.inheritClass(OO.ui.TextInputWidget,OO.ui.InputWidget),OO.mixinClass(OO.ui.TextInputWidget,OO.ui.mixin.IconElement),OO.mixinClass(OO.ui.TextInputWidget,OO.ui.mixin.IndicatorElement),OO.mixinClass(OO.ui.TextInputWidget,OO.ui.mixin.PendingElement),OO.mixinClass(OO.ui.TextInputWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.TextInputWidget,OO.ui.mixin.FlaggedElement),OO.ui.TextInputWidget.static.validationPatterns={"non-empty":/.+/,integer:/^\d+$/},OO.ui.TextInputWidget.prototype.onIconMouseDown=function(t){if(t.which===OO.ui.MouseButtons.LEFT)return this.focus(),!1},OO.ui.TextInputWidget.prototype.onIndicatorMouseDown=function(t){if(t.which===OO.ui.MouseButtons.LEFT)return this.focus(),!1},OO.ui.TextInputWidget.prototype.onKeyPress=function(t){t.which===OO.ui.Keys.ENTER&&this.emit("enter",t)},OO.ui.TextInputWidget.prototype.onBlur=function(){this.setValidityFlag()},OO.ui.TextInputWidget.prototype.onFocus=function(){this.isWaitingToBeAttached&&this.onElementAttach(),this.setValidityFlag(!0)},OO.ui.TextInputWidget.prototype.onElementAttach=function(){this.isWaitingToBeAttached=!1,this.valCache=null,this.positionLabel()},OO.ui.TextInputWidget.prototype.onDebouncedChange=function(){this.setValidityFlag()},OO.ui.TextInputWidget.prototype.isReadOnly=function(){return this.readOnly},OO.ui.TextInputWidget.prototype.setReadOnly=function(t){return this.readOnly=!!t,this.$input.prop("readOnly",this.readOnly),this},OO.ui.TextInputWidget.prototype.isRequired=function(){return this.required},OO.ui.TextInputWidget.prototype.setRequired=function(t){return this.required=!!t,this.required?(this.$input.prop("required",!0).attr("aria-required","true"),null===this.getIndicator()&&this.setIndicator("required")):(this.$input.prop("required",!1).removeAttr("aria-required"),"required"===this.getIndicator()&&this.setIndicator(null)),this},OO.ui.TextInputWidget.prototype.installParentChangeDetector=function(){var t,o,s,e,i=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,n=this;if(i){if(this.isElementAttached())return;for(s=this.$element[0];s.parentNode;)s=s.parentNode;t=new i(function(t){var e,i,n;for(e=0;e<t.length;e++)for(n=t[e].removedNodes,i=0;i<n.length;i++)if(n[i]===s)return void setTimeout(o,0)}),o=function(){n.isElementAttached()&&n.onElementAttach(),t.disconnect(),n.installParentChangeDetector()},e=$("<div>").append(s)[0],t.observe(e,{childList:!0})}else this.$element.on("DOMNodeInsertedIntoDocument",this.onElementAttach.bind(this))},OO.ui.TextInputWidget.prototype.getInputElement=function(t){return"number"===this.getSaneType(t)?$("<input>").attr("step","any").attr("type","number"):$("<input>").attr("type",this.getSaneType(t))},OO.ui.TextInputWidget.prototype.getSaneType=function(t){return-1!==["text","password","email","url","number"].indexOf(t.type)?t.type:"text"},OO.ui.TextInputWidget.prototype.selectRange=function(t,e){var i,n,o,s=this.$input[0];n=(i=(e=e||t)<t)?e:t,o=i?t:e,this.focus();try{s.setSelectionRange(n,o,i?"backward":"forward")}catch(t){if(this.getElementDocument().body.contains(s))throw t}return this},OO.ui.TextInputWidget.prototype.getRange=function(){var t=this.$input[0],e=t.selectionStart,i=t.selectionEnd,n="backward"===t.selectionDirection;return{from:n?i:e,to:n?e:i}},OO.ui.TextInputWidget.prototype.getInputLength=function(){return this.$input[0].value.length},OO.ui.TextInputWidget.prototype.select=function(){return this.selectRange(0,this.getInputLength())},OO.ui.TextInputWidget.prototype.moveCursorToStart=function(){return this.selectRange(0)},OO.ui.TextInputWidget.prototype.moveCursorToEnd=function(){return this.selectRange(this.getInputLength())},OO.ui.TextInputWidget.prototype.insertContent=function(t){var e,i,n=this.getRange(),o=this.getValue();return e=Math.min(n.from,n.to),i=Math.max(n.from,n.to),this.setValue(o.slice(0,e)+t+o.slice(i)),this.selectRange(e+t.length),this},OO.ui.TextInputWidget.prototype.encapsulateContent=function(t,e){var i,n,o=this.getRange(),s=t.length;return i=Math.min(o.from,o.to),n=Math.max(o.from,o.to),this.selectRange(i).insertContent(t),this.selectRange(s+n).insertContent(e),this.selectRange(s+i,s+n),this},OO.ui.TextInputWidget.prototype.setValidation=function(t){t instanceof RegExp||t instanceof Function?this.validate=t:this.validate=this.constructor.static.validationPatterns[t]||/.*/},OO.ui.TextInputWidget.prototype.setValidityFlag=function(t){function e(t){t?i.$input.removeAttr("aria-invalid"):i.$input.attr("aria-invalid","true"),i.setFlags({invalid:!t})}var i=this;void 0!==t?e(t):this.getValidity().then(function(){e(!0)},function(){e(!1)})},OO.ui.TextInputWidget.prototype.getValidity=function(){var t;function e(t){return t?$.Deferred().resolve().promise():$.Deferred().reject().promise()}return void 0!==this.$input[0].checkValidity&&!1===this.$input[0].checkValidity()?e(!1):this.validate instanceof Function?(t=this.validate(this.getValue()))&&"function"==typeof t.promise?t.promise().then(function(t){return e(t)}):e(t):e(this.getValue().match(this.validate))},OO.ui.TextInputWidget.prototype.setLabelPosition=function(t){return this.labelPosition=t,this.label&&this.updatePosition(),this},OO.ui.TextInputWidget.prototype.updatePosition=function(){var t="after"===this.labelPosition;return this.$element.toggleClass("oo-ui-textInputWidget-labelPosition-after",!!this.label&&t).toggleClass("oo-ui-textInputWidget-labelPosition-before",!!this.label&&!t),this.valCache=null,this.scrollWidth=null,this.positionLabel(),this},OO.ui.TextInputWidget.prototype.positionLabel=function(){var t,e;return this.isWaitingToBeAttached?this:(e={"padding-right":"","padding-left":""},this.label?(this.$element.append(this.$label),e[(t="after"===this.labelPosition)==("rtl"===this.$element.css("direction"))?"padding-left":"padding-right"]=this.$label.outerWidth(!0)+(t?this.scrollWidth:0),this.$input.css(e),this):(this.$label.detach(),void this.$input.css(e)))},OO.ui.SearchInputWidget=function(t){t=$.extend({icon:"search"},t),OO.ui.SearchInputWidget.parent.call(this,t),this.connect(this,{change:"onChange"}),this.$indicator.on("click",this.onIndicatorClick.bind(this)),this.updateSearchIndicator(),this.connect(this,{disable:"onDisable"})},OO.inheritClass(OO.ui.SearchInputWidget,OO.ui.TextInputWidget),OO.ui.SearchInputWidget.prototype.getSaneType=function(){return"search"},OO.ui.SearchInputWidget.prototype.onIndicatorClick=function(t){if(t.which===OO.ui.MouseButtons.LEFT)return this.setValue(""),this.focus(),!1},OO.ui.SearchInputWidget.prototype.updateSearchIndicator=function(){""===this.getValue()||this.isDisabled()||this.isReadOnly()?this.setIndicator(null):this.setIndicator("clear")},OO.ui.SearchInputWidget.prototype.onChange=function(){this.updateSearchIndicator()},OO.ui.SearchInputWidget.prototype.onDisable=function(){this.updateSearchIndicator()},OO.ui.SearchInputWidget.prototype.setReadOnly=function(t){return OO.ui.SearchInputWidget.parent.prototype.setReadOnly.call(this,t),this.updateSearchIndicator(),this},OO.ui.MultilineTextInputWidget=function(t){t=$.extend({type:"text"},t),OO.ui.MultilineTextInputWidget.parent.call(this,t),this.autosize=!!t.autosize,this.styleHeight=null,this.minRows=void 0!==t.rows?t.rows:"",this.maxRows=t.maxRows||Math.max(2*(this.minRows||0),10),this.autosize&&(this.$clone=this.$input.clone().removeAttr("id").removeAttr("name").insertAfter(this.$input).attr("aria-hidden","true").addClass("oo-ui-element-hidden")),this.connect(this,{change:"onChange"}),t.rows&&this.$input.attr("rows",t.rows),this.autosize&&(this.$input.addClass("oo-ui-textInputWidget-autosized"),this.isWaitingToBeAttached=!0,this.installParentChangeDetector())},OO.inheritClass(OO.ui.MultilineTextInputWidget,OO.ui.TextInputWidget),OO.ui.MultilineTextInputWidget.static.gatherPreInfuseState=function(t,e){var i=OO.ui.MultilineTextInputWidget.parent.static.gatherPreInfuseState(t,e);return i.scrollTop=e.$input.scrollTop(),i},OO.ui.MultilineTextInputWidget.prototype.onElementAttach=function(){OO.ui.MultilineTextInputWidget.parent.prototype.onElementAttach.call(this),this.adjustSize()},OO.ui.MultilineTextInputWidget.prototype.onChange=function(){this.adjustSize()},OO.ui.MultilineTextInputWidget.prototype.updatePosition=function(){OO.ui.MultilineTextInputWidget.parent.prototype.updatePosition.call(this),this.adjustSize()},OO.ui.MultilineTextInputWidget.prototype.onKeyPress=function(t){(t.which===OO.ui.Keys.ENTER&&(t.ctrlKey||t.metaKey)||10===t.which)&&this.emit("enter",t)},OO.ui.MultilineTextInputWidget.prototype.adjustSize=function(){var t,e,i,n,o,s,l,u,a;return this.$input.val()!==this.valCache&&(this.autosize&&(this.$clone.val(this.$input.val()).attr("rows",this.minRows).css("height",0),this.$clone.removeClass("oo-ui-element-hidden"),this.valCache=this.$input.val(),t=this.$clone[0].scrollHeight,this.$clone.css("height",""),e=this.$clone.innerHeight(),i=this.$clone.outerHeight(),this.$clone.attr("rows",this.maxRows).css("height","auto").val(""),o=(n=this.$clone.innerHeight())-this.$clone[0].scrollHeight,s=Math.min(n,t+o),this.$clone.addClass("oo-ui-element-hidden"),(l=e<s?s+(i-e):"")!==this.styleHeight&&(this.$input.css("height",l),this.styleHeight=l,this.emit("resize"))),(u=this.$input[0].offsetWidth-this.$input[0].clientWidth)!==this.scrollWidth&&(a="rtl"===this.$element.css("direction")?"left":"right",this.$label.css({right:"",left:""}),this.$indicator.css({right:"",left:""}),u&&(this.$indicator.css(a,u),"after"===this.labelPosition&&this.$label.css(a,u)),this.scrollWidth=u,this.positionLabel())),this},OO.ui.MultilineTextInputWidget.prototype.getInputElement=function(){return $("<textarea>")},OO.ui.MultilineTextInputWidget.prototype.isAutosizing=function(){return!!this.autosize},OO.ui.MultilineTextInputWidget.prototype.restorePreInfuseState=function(t){OO.ui.MultilineTextInputWidget.parent.prototype.restorePreInfuseState.call(this,t),void 0!==t.scrollTop&&this.$input.scrollTop(t.scrollTop)},OO.ui.ComboBoxInputWidget=function(t){(t=$.extend({autocomplete:!1},t)).multiline=!1,t.$input&&t.$input.removeAttr("list"),OO.ui.ComboBoxInputWidget.parent.call(this,t),this.$overlay=(!0===t.$overlay?OO.ui.getDefaultOverlay():t.$overlay)||this.$element,this.dropdownButton=new OO.ui.ButtonWidget({classes:["oo-ui-comboBoxInputWidget-dropdownButton"],label:OO.ui.msg("ooui-combobox-button-label"),indicator:"down",invisibleLabel:!0,disabled:this.disabled}),this.menu=new OO.ui.MenuSelectWidget($.extend({widget:this,input:this,$floatableContainer:this.$element,disabled:this.isDisabled()},t.menu)),this.connect(this,{change:"onInputChange",enter:"onInputEnter"}),this.dropdownButton.connect(this,{click:"onDropdownButtonClick"}),this.menu.connect(this,{choose:"onMenuChoose",add:"onMenuItemsChange",remove:"onMenuItemsChange",toggle:"onMenuToggle"}),this.$input.attr({role:"combobox","aria-owns":this.menu.getElementId(),"aria-autocomplete":"list"}),this.dropdownButton.$button.attr({"aria-controls":this.menu.getElementId()}),void 0!==t.options&&this.setOptions(t.options),this.$field=$("<div>").addClass("oo-ui-comboBoxInputWidget-field").append(this.$input,this.dropdownButton.$element),this.$element.addClass("oo-ui-comboBoxInputWidget").append(this.$field),this.$overlay.append(this.menu.$element),this.onMenuItemsChange()},OO.inheritClass(OO.ui.ComboBoxInputWidget,OO.ui.TextInputWidget),OO.ui.ComboBoxInputWidget.prototype.getMenu=function(){return this.menu},OO.ui.ComboBoxInputWidget.prototype.getInput=function(){return this},OO.ui.ComboBoxInputWidget.prototype.onInputChange=function(t){var e=this.menu.findItemFromData(t);this.menu.selectItem(e),this.menu.findHighlightedItem()&&this.menu.highlightItem(e),this.isDisabled()||this.menu.toggle(!0)},OO.ui.ComboBoxInputWidget.prototype.onInputEnter=function(){this.isDisabled()||this.menu.toggle(!1)},OO.ui.ComboBoxInputWidget.prototype.onDropdownButtonClick=function(){this.menu.toggle(),this.focus()},OO.ui.ComboBoxInputWidget.prototype.onMenuChoose=function(t){this.setValue(t.getData())},OO.ui.ComboBoxInputWidget.prototype.onMenuItemsChange=function(){var t=this.menu.findItemFromData(this.getValue());this.menu.selectItem(t),this.menu.findHighlightedItem()&&this.menu.highlightItem(t),this.$element.toggleClass("oo-ui-comboBoxInputWidget-empty",this.menu.isEmpty())},OO.ui.ComboBoxInputWidget.prototype.onMenuToggle=function(t){this.$element.toggleClass("oo-ui-comboBoxInputWidget-open",t)},OO.ui.ComboBoxInputWidget.prototype.updateControlsDisabled=function(){var t=this.isDisabled()||this.isReadOnly();return this.dropdownButton&&this.dropdownButton.setDisabled(t),this.menu&&this.menu.setDisabled(t),this},OO.ui.ComboBoxInputWidget.prototype.setDisabled=function(){return OO.ui.ComboBoxInputWidget.parent.prototype.setDisabled.apply(this,arguments),this.updateControlsDisabled(),this},OO.ui.ComboBoxInputWidget.prototype.setReadOnly=function(){return OO.ui.ComboBoxInputWidget.parent.prototype.setReadOnly.apply(this,arguments),this.updateControlsDisabled(),this},OO.ui.ComboBoxInputWidget.prototype.setOptions=function(t){return this.getMenu().clearItems().addItems(t.map(function(t){return new OO.ui.MenuOptionWidget({data:t.data,label:void 0!==t.label?t.label:t.data})})),this},OO.ui.FieldLayout=function(t,e){if(OO.isPlainObject(t)&&void 0===e&&(t=(e=t).fieldWidget),void 0===t)throw new Error("Widget not found");e=$.extend({align:"left",helpInline:!1},e),OO.ui.FieldLayout.parent.call(this,e),OO.ui.mixin.LabelElement.call(this,$.extend({$label:$("<label>")},e)),OO.ui.mixin.TitledElement.call(this,$.extend({$titled:this.$label},e)),this.fieldWidget=t,this.errors=[],this.warnings=[],this.successMessages=[],this.notices=[],this.$field=this.isFieldInline()?$("<span>"):$("<div>"),this.$messages=$("<div>"),this.$header=$("<span>"),this.$body=$("<div>"),this.align=null,this.helpInline=e.helpInline,this.fieldWidget.connect(this,{disable:"onFieldDisable"}),this.$help=e.help?this.createHelpElement(e.help,e.$overlay):$([]),this.fieldWidget.getInputId()?(this.$label.attr("for",this.fieldWidget.getInputId()),this.helpInline&&this.$help.attr("for",this.fieldWidget.getInputId())):(this.$label.on("click",function(){this.fieldWidget.simulateLabelClick()}.bind(this)),this.helpInline&&this.$help.on("click",function(){this.fieldWidget.simulateLabelClick()}.bind(this))),this.$element.addClass("oo-ui-fieldLayout").toggleClass("oo-ui-fieldLayout-disabled",this.fieldWidget.isDisabled()).append(this.$body),this.$body.addClass("oo-ui-fieldLayout-body"),this.$header.addClass("oo-ui-fieldLayout-header"),this.$messages.addClass("oo-ui-fieldLayout-messages"),this.$field.addClass("oo-ui-fieldLayout-field").append(this.fieldWidget.$element),this.setErrors(e.errors||[]),this.setWarnings(e.warnings||[]),this.setSuccess(e.successMessages||[]),this.setNotices(e.notices||[]),this.setAlignment(e.align),this.updateTitle()},OO.inheritClass(OO.ui.FieldLayout,OO.ui.Layout),OO.mixinClass(OO.ui.FieldLayout,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.FieldLayout,OO.ui.mixin.TitledElement),OO.ui.FieldLayout.prototype.onFieldDisable=function(t){this.$element.toggleClass("oo-ui-fieldLayout-disabled",t)},OO.ui.FieldLayout.prototype.getField=function(){return this.fieldWidget},OO.ui.FieldLayout.prototype.isFieldInline=function(){return"span"===this.getField().$element.prop("tagName").toLowerCase()},OO.ui.FieldLayout.prototype.makeMessage=function(t,e){return new OO.ui.MessageWidget({type:t,inline:!0,label:e}).$element},OO.ui.FieldLayout.prototype.setAlignment=function(t){return t!==this.align&&(-1===["left","right","top","inline"].indexOf(t)&&(t="left"),"inline"!==t||this.isFieldInline()||(t="top"),this.helpInline?"top"===t?(this.$header.append(this.$label),this.$body.append(this.$header,this.$field,this.$help)):"inline"===t?(this.$header.append(this.$label,this.$help),this.$body.append(this.$field,this.$header)):(this.$header.append(this.$label,this.$help),this.$body.append(this.$header,this.$field)):"top"===t?(this.$header.append(this.$help,this.$label),this.$body.append(this.$header,this.$field)):"inline"===t?(this.$header.append(this.$help,this.$label),this.$body.append(this.$field,this.$header)):(this.$header.append(this.$label),this.$body.append(this.$header,this.$help,this.$field)),this.align&&this.$element.removeClass("oo-ui-fieldLayout-align-"+this.align),this.$element.addClass("oo-ui-fieldLayout-align-"+t),this.align=t),this},OO.ui.FieldLayout.prototype.setErrors=function(t){return this.errors=t.slice(),this.updateMessages(),this},OO.ui.FieldLayout.prototype.setWarnings=function(t){return this.warnings=t.slice(),this.updateMessages(),this},OO.ui.FieldLayout.prototype.setSuccess=function(t){return this.successMessages=t.slice(),this.updateMessages(),this},OO.ui.FieldLayout.prototype.setNotices=function(t){return this.notices=t.slice(),this.updateMessages(),this},OO.ui.FieldLayout.prototype.updateMessages=function(){var t;if(this.$messages.empty(),this.errors.length||this.warnings.length||this.successMessages.length||this.notices.length){for(this.$body.after(this.$messages),t=0;t<this.errors.length;t++)this.$messages.append(this.makeMessage("error",this.errors[t]));for(t=0;t<this.warnings.length;t++)this.$messages.append(this.makeMessage("warning",this.warnings[t]));for(t=0;t<this.successMessages.length;t++)this.$messages.append(this.makeMessage("success",this.successMessages[t]));for(t=0;t<this.notices.length;t++)this.$messages.append(this.makeMessage("notice",this.notices[t]))}else this.$messages.remove()},OO.ui.FieldLayout.prototype.formatTitleWithAccessKey=function(t){return this.fieldWidget&&this.fieldWidget.formatTitleWithAccessKey?this.fieldWidget.formatTitleWithAccessKey(t):t},OO.ui.FieldLayout.prototype.createHelpElement=function(t,e){var i,n;return i=this.helpInline?(n=new OO.ui.LabelWidget({label:t,classes:["oo-ui-inline-help"]})).getElementId():(n=new OO.ui.PopupButtonWidget({$overlay:e,popup:{padded:!0},classes:["oo-ui-fieldLayout-help"],framed:!1,icon:"info",label:OO.ui.msg("ooui-field-help"),invisibleLabel:!0}),t instanceof OO.ui.HtmlSnippet?n.getPopup().$body.html(t.toString()):n.getPopup().$body.text(t),n.getPopup().getBodyId()),(this.fieldWidget.$input||this.fieldWidget.$button||this.fieldWidget.$element).attr("aria-describedby",i),n.$element},OO.ui.ActionFieldLayout=function(t,e,i){OO.isPlainObject(t)&&void 0===i&&(t=(i=t).fieldWidget,e=i.buttonWidget),OO.ui.ActionFieldLayout.parent.call(this,t,i),this.buttonWidget=e,this.$button=$("<span>"),this.$input=this.isFieldInline()?$("<span>"):$("<div>"),this.$element.addClass("oo-ui-actionFieldLayout"),this.$button.addClass("oo-ui-actionFieldLayout-button").append(this.buttonWidget.$element),this.$input.addClass("oo-ui-actionFieldLayout-input").append(this.fieldWidget.$element),this.$field.append(this.$input,this.$button)},OO.inheritClass(OO.ui.ActionFieldLayout,OO.ui.FieldLayout),OO.ui.FieldsetLayout=function(t){var e;t=t||{},OO.ui.FieldsetLayout.parent.call(this,t),OO.ui.mixin.IconElement.call(this,t),OO.ui.mixin.LabelElement.call(this,t),OO.ui.mixin.GroupElement.call(this,t),this.$header=$("<legend>"),this.$header.addClass("oo-ui-fieldsetLayout-header").append(this.$icon,this.$label),this.$group.addClass("oo-ui-fieldsetLayout-group"),this.$element.addClass("oo-ui-fieldsetLayout").prepend(this.$header,this.$group),t.help&&(t.helpInline?(e=new OO.ui.LabelWidget({label:t.help,classes:["oo-ui-inline-help"]}),this.$element.prepend(this.$header,e.$element,this.$group)):(e=new OO.ui.PopupButtonWidget({$overlay:t.$overlay,popup:{padded:!0},classes:["oo-ui-fieldsetLayout-help"],framed:!1,icon:"info",label:OO.ui.msg("ooui-field-help"),invisibleLabel:!0}),t.help instanceof OO.ui.HtmlSnippet?e.getPopup().$body.html(t.help.toString()):e.getPopup().$body.text(t.help),this.$header.append(e.$element))),Array.isArray(t.items)&&this.addItems(t.items)},OO.inheritClass(OO.ui.FieldsetLayout,OO.ui.Layout),OO.mixinClass(OO.ui.FieldsetLayout,OO.ui.mixin.IconElement),OO.mixinClass(OO.ui.FieldsetLayout,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.FieldsetLayout,OO.ui.mixin.GroupElement),OO.ui.FieldsetLayout.static.tagName="fieldset",OO.ui.FormLayout=function(t){var e;t=t||{},OO.ui.FormLayout.parent.call(this,t),OO.ui.mixin.GroupElement.call(this,$.extend({$group:this.$element},t)),this.$element.on("submit",this.onFormSubmit.bind(this)),void 0===(e=t.action)||OO.ui.isSafeUrl(e)||(e="./"+e),this.$element.addClass("oo-ui-formLayout").attr({method:t.method,action:e,enctype:t.enctype}),Array.isArray(t.items)&&this.addItems(t.items)},OO.inheritClass(OO.ui.FormLayout,OO.ui.Layout),OO.mixinClass(OO.ui.FormLayout,OO.ui.mixin.GroupElement),OO.ui.FormLayout.static.tagName="form",OO.ui.FormLayout.prototype.onFormSubmit=function(){if(this.emit("submit"))return!1},OO.ui.PanelLayout=function(t){t=$.extend({scrollable:!1,padded:!1,expanded:!0,framed:!1},t),OO.ui.PanelLayout.parent.call(this,t),this.$element.addClass("oo-ui-panelLayout"),t.scrollable&&this.$element.addClass("oo-ui-panelLayout-scrollable"),t.padded&&this.$element.addClass("oo-ui-panelLayout-padded"),t.expanded&&this.$element.addClass("oo-ui-panelLayout-expanded"),t.framed&&this.$element.addClass("oo-ui-panelLayout-framed")},OO.inheritClass(OO.ui.PanelLayout,OO.ui.Layout),OO.ui.PanelLayout.static.reusePreInfuseDOM=function(t,e){return!1!==(e=OO.ui.PanelLayout.parent.static.reusePreInfuseDOM(t,e)).preserveContent&&(e.$content=$(t).contents()),e},OO.ui.PanelLayout.prototype.focus=function(){OO.ui.findFocusable(this.$element).focus()},OO.ui.HorizontalLayout=function(t){t=t||{},OO.ui.HorizontalLayout.parent.call(this,t),OO.ui.mixin.GroupElement.call(this,$.extend({$group:this.$element},t)),this.$element.addClass("oo-ui-horizontalLayout"),Array.isArray(t.items)&&this.addItems(t.items)},OO.inheritClass(OO.ui.HorizontalLayout,OO.ui.Layout),OO.mixinClass(OO.ui.HorizontalLayout,OO.ui.mixin.GroupElement),OO.ui.NumberInputWidget=function(t){var e=$("<div>").addClass("oo-ui-numberInputWidget-field");t=$.extend({min:-1/0,max:1/0,showButtons:!0},t),$.extend(t,t.input),this.input=this,OO.ui.NumberInputWidget.parent.call(this,$.extend(t,{type:"number"})),t.showButtons&&(this.minusButton=new OO.ui.ButtonWidget($.extend({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-minusButton"],icon:"subtract"},t.minusButton)),this.minusButton.$element.attr("aria-hidden","true"),this.plusButton=new OO.ui.ButtonWidget($.extend({disabled:this.isDisabled(),tabIndex:-1,classes:["oo-ui-numberInputWidget-plusButton"],icon:"add"},t.plusButton)),this.plusButton.$element.attr("aria-hidden","true")),this.$input.on({keydown:this.onKeyDown.bind(this),"wheel mousewheel DOMMouseScroll":this.onWheel.bind(this)}),t.showButtons&&(this.plusButton.connect(this,{click:["onButtonClick",1]}),this.minusButton.connect(this,{click:["onButtonClick",-1]})),e.append(this.$input),t.showButtons&&e.prepend(this.minusButton.$element).append(this.plusButton.$element),(t.allowInteger||t.isInteger)&&(t.step=1),this.setRange(t.min,t.max),this.setStep(t.buttonStep,t.pageStep,t.step),this.setValidation(this.validateNumber.bind(this)),this.$element.addClass("oo-ui-numberInputWidget").toggleClass("oo-ui-numberInputWidget-buttoned",t.showButtons).append(e)},OO.inheritClass(OO.ui.NumberInputWidget,OO.ui.TextInputWidget),OO.ui.NumberInputWidget.prototype.setAllowInteger=function(t){this.setStep(t?1:null)},OO.ui.NumberInputWidget.prototype.setIsInteger=OO.ui.NumberInputWidget.prototype.setAllowInteger,OO.ui.NumberInputWidget.prototype.getAllowInteger=function(){return 1===this.step},OO.ui.NumberInputWidget.prototype.getIsInteger=OO.ui.NumberInputWidget.prototype.getAllowInteger,OO.ui.NumberInputWidget.prototype.setRange=function(t,e){if(e<t)throw new Error("Minimum ("+t+") must not be greater than maximum ("+e+")");this.min=t,this.max=e,this.$input.attr("min",this.min),this.$input.attr("max",this.max),this.setValidityFlag()},OO.ui.NumberInputWidget.prototype.getRange=function(){return[this.min,this.max]},OO.ui.NumberInputWidget.prototype.setStep=function(t,e,i){if(void 0===t&&(t=i||1),void 0===e&&(e=10*t),null!==i&&i<=0)throw new Error("Step value, if given, must be positive");if(t<=0)throw new Error("Button step value must be positive");if(e<=0)throw new Error("Page step value must be positive");this.step=i,this.buttonStep=t,this.pageStep=e,this.$input.attr("step",this.step||"any"),this.setValidityFlag()},OO.ui.NumberInputWidget.prototype.setValue=function(t){return""===t&&this.$input.val(""),OO.ui.NumberInputWidget.parent.prototype.setValue.call(this,t)},OO.ui.NumberInputWidget.prototype.getStep=function(){return[this.buttonStep,this.pageStep,this.step]},OO.ui.NumberInputWidget.prototype.getNumericValue=function(){return+this.getValue()},OO.ui.NumberInputWidget.prototype.adjustValue=function(t){var e,i=this.getNumericValue();if(t=+t,isNaN(t)||!isFinite(t))throw new Error("Delta must be a finite number");isNaN(i)?e=0:(e=i+t,e=Math.max(Math.min(e,this.max),this.min),this.step&&(e=Math.round(e/this.step)*this.step)),e!==i&&this.setValue(e)},OO.ui.NumberInputWidget.prototype.validateNumber=function(t){var e=+t;return""===t?!this.isRequired():!(isNaN(e)||!isFinite(e))&&((!this.step||Math.floor(e/this.step)===e/this.step)&&!(e<this.min||e>this.max))},OO.ui.NumberInputWidget.prototype.onButtonClick=function(t){this.adjustValue(t*this.buttonStep)},OO.ui.NumberInputWidget.prototype.onWheel=function(t){var e=0;if(!this.isDisabled()&&!this.isReadOnly())return this.$input.is(":focus")?(void 0!==t.originalEvent.deltaMode&&(this.sawWheelEvent=!0),t.originalEvent.deltaY?e=-t.originalEvent.deltaY:t.originalEvent.deltaX&&(e=t.originalEvent.deltaX),this.sawWheelEvent||(t.originalEvent.wheelDeltaX?e=-t.originalEvent.wheelDeltaX:t.originalEvent.wheelDeltaY?e=t.originalEvent.wheelDeltaY:t.originalEvent.wheelDelta?e=t.originalEvent.wheelDelta:t.originalEvent.detail&&(e=-t.originalEvent.detail)),e&&(e=e<0?-1:1,this.adjustValue(e*this.buttonStep)),!1):void 0},OO.ui.NumberInputWidget.prototype.onKeyDown=function(t){if(!this.isDisabled()&&!this.isReadOnly())switch(t.which){case OO.ui.Keys.UP:return this.adjustValue(this.buttonStep),!1;case OO.ui.Keys.DOWN:return this.adjustValue(-this.buttonStep),!1;case OO.ui.Keys.PAGEUP:return this.adjustValue(this.pageStep),!1;case OO.ui.Keys.PAGEDOWN:return this.adjustValue(-this.pageStep),!1}},OO.ui.NumberInputWidget.prototype.updateControlsDisabled=function(){var t=this.isDisabled()||this.isReadOnly();return this.minusButton&&this.minusButton.setDisabled(t),this.plusButton&&this.plusButton.setDisabled(t),this},OO.ui.NumberInputWidget.prototype.setDisabled=function(t){return OO.ui.NumberInputWidget.parent.prototype.setDisabled.call(this,t),this.updateControlsDisabled(),this},OO.ui.NumberInputWidget.prototype.setReadOnly=function(){return OO.ui.NumberInputWidget.parent.prototype.setReadOnly.apply(this,arguments),this.updateControlsDisabled(),this},OO.ui.SelectFileInputWidget=function(t){var e=this;t=t||{},this.selectButton=new OO.ui.ButtonWidget($.extend({$element:$("<label>"),classes:["oo-ui-selectFileInputWidget-selectButton"],label:OO.ui.msg("ooui-selectfile-button-select")},t.button)),t=$.extend({accept:null,placeholder:OO.ui.msg("ooui-selectfile-placeholder"),$tabIndexed:this.selectButton.$tabIndexed},t),this.info=new OO.ui.SearchInputWidget({classes:["oo-ui-selectFileInputWidget-info"],placeholder:t.placeholder,$tabIndexed:$([])}).setIcon(t.icon),this.info.$input.attr("tabindex",-1),OO.ui.SelectFileInputWidget.parent.call(this,t),this.currentFiles=this.filterFiles(this.$input[0].files||[]),Array.isArray(t.accept)?this.accept=t.accept:this.accept=null,this.multiple=!!t.multiple,this.info.connect(this,{change:"onInfoChange"}),this.selectButton.$button.on({keypress:this.onKeyPress.bind(this)}),this.$input.on({change:this.onFileSelected.bind(this),focus:function(){e.$input.parent().prop("scrollTop",0)}}),this.connect(this,{change:"updateUI"}),this.fieldLayout=new OO.ui.ActionFieldLayout(this.info,this.selectButton,{align:"top"}),this.$input.attr({type:"file",tabindex:-1,"aria-disabled":null}),this.accept&&this.$input.attr("accept",this.accept.join(", ")),this.multiple&&this.$input.attr("multiple",""),this.selectButton.$button.append(this.$input),this.$element.addClass("oo-ui-selectFileInputWidget").append(this.fieldLayout.$element),this.updateUI()},OO.inheritClass(OO.ui.SelectFileInputWidget,OO.ui.InputWidget),OO.ui.SelectFileInputWidget.static.title="",OO.ui.SelectFileInputWidget.prototype.getFilename=function(){return this.currentFiles.length?this.currentFiles.map(function(t){return t.name}).join(", "):this.getValue().split("\\").pop()},OO.ui.SelectFileInputWidget.prototype.setValue=function(t){void 0!==t&&(t?this.value!==t&&(this.value=t,this.emit("change",this.value)):(this.currentFiles=[],OO.ui.SelectFileInputWidget.super.prototype.setValue.call(this,"")))},OO.ui.SelectFileInputWidget.prototype.onFileSelected=function(t){this.currentFiles=this.filterFiles(t.target.files||[])},OO.ui.SelectFileInputWidget.prototype.updateUI=function(){this.info.setValue(this.getFilename())},OO.ui.SelectFileInputWidget.prototype.filterFiles=function(t){var o=this.accept;return Array.prototype.filter.call(t,function(t){var e,i,n=t.type;if(!o||!n)return!0;for(e=0;e<o.length;e++){if((i=o[e])===n)return!0;if("/*"===i.substr(-2)&&(i=i.substr(0,i.length-1),n.substr(0,i.length)===i))return!0}return!1})},OO.ui.SelectFileInputWidget.prototype.onInfoChange=function(t){""===t&&this.setValue(null)},OO.ui.SelectFileInputWidget.prototype.onKeyPress=function(t){if(!this.isDisabled()&&this.$input&&(t.which===OO.ui.Keys.SPACE||t.which===OO.ui.Keys.ENTER))return this.$input.trigger("click"),this.selectButton.onDocumentKeyUp(t),!1},OO.ui.SelectFileInputWidget.prototype.setDisabled=function(t){return OO.ui.SelectFileInputWidget.parent.prototype.setDisabled.call(this,t),this.selectButton.setDisabled(t),this.info.setDisabled(t),this}}(OO),function(OO){"use strict";OO.ui.mixin.DraggableElement=function(t){t=t||{},this.index=null,this.$handle=t.$handle||this.$element,this.wasHandleUsed=null,this.$element.addClass("oo-ui-draggableElement").on({mousedown:this.onDragMouseDown.bind(this),dragstart:this.onDragStart.bind(this),dragover:this.onDragOver.bind(this),dragend:this.onDragEnd.bind(this),drop:this.onDrop.bind(this)}),this.$handle.addClass("oo-ui-draggableElement-handle"),this.toggleDraggable(void 0===t.draggable||!!t.draggable)},OO.initClass(OO.ui.mixin.DraggableElement),OO.ui.mixin.DraggableElement.static.cancelButtonMouseDownEvents=!1,OO.ui.mixin.DraggableElement.prototype.toggleDraggable=function(t){t=void 0!==t?!!t:!this.draggable,this.draggable!==t&&(this.draggable=t,this.$handle.toggleClass("oo-ui-draggableElement-undraggable",!this.draggable),this.$element.prop("draggable",this.draggable))},OO.ui.mixin.DraggableElement.prototype.isDraggable=function(){return this.draggable},OO.ui.mixin.DraggableElement.prototype.onDragMouseDown=function(t){this.isDraggable()&&(this.wasHandleUsed=this.$handle[0]===this.$element[0]||OO.ui.contains(this.$handle[0],t.target,!0))},OO.ui.mixin.DraggableElement.prototype.onDragStart=function(t){var e=this,i=t.originalEvent.dataTransfer;if(!this.wasHandleUsed||!this.isDraggable())return!1;i.dropEffect="none",i.effectAllowed="move";try{i.setData("application-x/OOUI-draggable",this.getIndex())}catch(t){}return this.$element.addClass("oo-ui-draggableElement-clone"),setTimeout(function(){e.$element.removeClass("oo-ui-draggableElement-clone").addClass("oo-ui-draggableElement-placeholder")}),this.emit("dragstart",this),!0},OO.ui.mixin.DraggableElement.prototype.onDragEnd=function(){this.$element.removeClass("oo-ui-draggableElement-placeholder"),this.emit("dragend")},OO.ui.mixin.DraggableElement.prototype.onDrop=function(t){t.preventDefault(),this.emit("drop",t)},OO.ui.mixin.DraggableElement.prototype.onDragOver=function(t){t.preventDefault()},OO.ui.mixin.DraggableElement.prototype.setIndex=function(t){this.index!==t&&(this.index=t,this.$element.data("index",t))},OO.ui.mixin.DraggableElement.prototype.getIndex=function(){return this.index},OO.ui.mixin.DraggableGroupElement=function(t){t=t||{},OO.ui.mixin.GroupElement.call(this,t),this.orientation=t.orientation||"vertical",this.dragItem=null,this.itemKeys={},this.dir=null,this.itemsOrder=null,this.draggable=void 0===t.draggable||!!t.draggable,this.aggregate({dragstart:"itemDragStart",dragend:"itemDragEnd",drop:"itemDrop"}),this.connect(this,{itemDragStart:"onItemDragStart",itemDrop:"onItemDropOrDragEnd",itemDragEnd:"onItemDropOrDragEnd"}),Array.isArray(t.items)&&this.addItems(t.items),this.$element.addClass("oo-ui-draggableGroupElement").toggleClass("oo-ui-draggableGroupElement-horizontal","horizontal"===this.orientation)},OO.mixinClass(OO.ui.mixin.DraggableGroupElement,OO.ui.mixin.GroupElement),OO.ui.mixin.DraggableGroupElement.prototype.toggleDraggable=function(t){t=void 0!==t?!!t:!this.draggable,this.draggable!==t&&(this.draggable=t,this.getItems().forEach(function(t){t.toggleDraggable(this.draggable)}.bind(this)),this.emit("draggable",this.draggable))},OO.ui.mixin.DraggableGroupElement.prototype.isDraggable=function(){return this.draggable},OO.ui.mixin.DraggableGroupElement.prototype.onItemDragStart=function(t){this.isDraggable()&&(this.itemsOrder=this.items.slice(),this.updateIndexes(),"horizontal"===this.orientation&&(this.dir=this.$element.css("direction")),this.setDragItem(t))},OO.ui.mixin.DraggableGroupElement.prototype.updateIndexes=function(){var t,e;for(t=0,e=this.itemsOrder.length;t<e;t++)this.itemsOrder[t].setIndex(t)},OO.ui.mixin.DraggableGroupElement.prototype.onItemDropOrDragEnd=function(){var t,e,i=this.getDragItem();return i&&(e=this.items.indexOf(i),(t=i.getIndex()+(i.getIndex()>e?1:0))!==e&&(this.reorder(this.getDragItem(),t),this.emit("reorder",this.getDragItem(),t)),this.updateIndexes()),this.unsetDragItem(),!1},OO.ui.mixin.DraggableGroupElement.prototype.onDragOver=function(t){var e,i,n=this.getDragItem(),o=n.getIndex();void 0!==(e=$(t.target).closest(".oo-ui-draggableElement").data("index"))&&e!==o&&(0<(i=e+(o<e?1:0))?this.$group.children().eq(i-1).after(n.$element):this.$group.prepend(n.$element),this.itemsOrder.splice(e,0,this.itemsOrder.splice(o,1)[0]),this.updateIndexes(),this.emit("drag",n,i)),t.preventDefault()},OO.ui.mixin.DraggableGroupElement.prototype.reorder=function(t,e){this.addItems([t],e)},OO.ui.mixin.DraggableGroupElement.prototype.setDragItem=function(t){this.dragItem!==t&&(this.dragItem=t,this.$element.on("dragover",this.onDragOver.bind(this)),this.$element.addClass("oo-ui-draggableGroupElement-dragging"))},OO.ui.mixin.DraggableGroupElement.prototype.unsetDragItem=function(){this.dragItem&&(this.dragItem=null,this.$element.off("dragover"),this.$element.removeClass("oo-ui-draggableGroupElement-dragging"))},OO.ui.mixin.DraggableGroupElement.prototype.getDragItem=function(){return this.dragItem},OO.ui.mixin.RequestManager=function(t){this.requestCache={},this.requestQuery=null,this.requestRequest=null,this.showPendingRequest=!!this.pushPending&&!1!==t.showPendingRequest},OO.initClass(OO.ui.mixin.RequestManager),OO.ui.mixin.RequestManager.prototype.getRequestData=function(){var e,i=this,n=this.getRequestQuery(),o=$.Deferred();return this.abortRequest(),Object.prototype.hasOwnProperty.call(this.requestCache,n)?o.resolve(this.requestCache[n]):(this.showPendingRequest&&this.pushPending(),this.requestQuery=n,(e=this.requestRequest=this.getRequest()).always(function(){i.showPendingRequest&&i.popPending()}).done(function(t){e===i.requestRequest&&(i.requestQuery=null,i.requestRequest=null,i.requestCache[n]=i.getRequestCacheDataFromResponse(t),o.resolve(i.requestCache[n]))}).fail(function(){e===i.requestRequest&&(i.requestQuery=null,i.requestRequest=null,o.reject())})),o.promise()},OO.ui.mixin.RequestManager.prototype.abortRequest=function(){var t=this.requestRequest;t&&(this.requestRequest=null,this.requestQuery=null,t.abort())},OO.ui.mixin.RequestManager.prototype.getRequestQuery=null,OO.ui.mixin.RequestManager.prototype.getRequest=null,OO.ui.mixin.RequestManager.prototype.getRequestCacheDataFromResponse=null,OO.ui.mixin.LookupElement=function(t){t=$.extend({highlightFirst:!0},t),OO.ui.mixin.RequestManager.call(this,t),this.$overlay=(!0===t.$overlay?OO.ui.getDefaultOverlay():t.$overlay)||this.$element,this.lookupMenu=new OO.ui.MenuSelectWidget($.extend({widget:this,input:this,$floatableContainer:t.$container||this.$element},t.menu)),this.allowSuggestionsWhenEmpty=t.allowSuggestionsWhenEmpty||!1,this.lookupsDisabled=!1,this.lookupInputFocused=!1,this.lookupHighlightFirstItem=t.highlightFirst,this.showSuggestionsOnFocus=!1!==t.showSuggestionsOnFocus,this.$input.on({focus:this.onLookupInputFocus.bind(this),blur:this.onLookupInputBlur.bind(this),mousedown:this.onLookupInputMouseDown.bind(this)}),this.connect(this,{change:"onLookupInputChange"}),this.lookupMenu.connect(this,{toggle:"onLookupMenuToggle",choose:"onLookupMenuItemChoose"}),this.$input.attr({role:"combobox","aria-owns":this.lookupMenu.getElementId(),"aria-autocomplete":"list"}),this.$element.addClass("oo-ui-lookupElement"),this.lookupMenu.$element.addClass("oo-ui-lookupElement-menu"),this.$overlay.append(this.lookupMenu.$element)},OO.mixinClass(OO.ui.mixin.LookupElement,OO.ui.mixin.RequestManager),OO.ui.mixin.LookupElement.prototype.onLookupInputFocus=function(){this.lookupInputFocused=!0,this.showSuggestionsOnFocus&&this.populateLookupMenu()},OO.ui.mixin.LookupElement.prototype.onLookupInputBlur=function(){this.closeLookupMenu(),this.lookupInputFocused=!1},OO.ui.mixin.LookupElement.prototype.onLookupInputMouseDown=function(){this.lookupMenu.isVisible()||!this.lookupInputFocused&&this.showSuggestionsOnFocus||this.populateLookupMenu()},OO.ui.mixin.LookupElement.prototype.onLookupInputChange=function(){this.lookupInputFocused&&this.populateLookupMenu()},OO.ui.mixin.LookupElement.prototype.onLookupMenuToggle=function(t){t||(this.abortLookupRequest(),this.lookupMenu.clearItems())},OO.ui.mixin.LookupElement.prototype.onLookupMenuItemChoose=function(t){this.setValue(t.getData())},OO.ui.mixin.LookupElement.prototype.getLookupMenu=function(){return this.lookupMenu},OO.ui.mixin.LookupElement.prototype.setLookupsDisabled=function(t){this.lookupsDisabled=!!t},OO.ui.mixin.LookupElement.prototype.openLookupMenu=function(){return this.lookupMenu.isEmpty()||this.lookupMenu.toggle(!0),this},OO.ui.mixin.LookupElement.prototype.closeLookupMenu=function(){return this.lookupMenu.toggle(!1),this.abortLookupRequest(),this.lookupMenu.clearItems(),this},OO.ui.mixin.LookupElement.prototype.populateLookupMenu=function(){var e=this,t=this.getValue();if(!this.lookupsDisabled&&!this.isReadOnly())return this.allowSuggestionsWhenEmpty||""!==t?t!==this.lookupQuery&&this.getLookupMenuItems().done(function(t){e.lookupMenu.clearItems(),t.length?(e.lookupMenu.addItems(t).toggle(!0),e.initializeLookupMenuSelection()):e.lookupMenu.toggle(!1)}).fail(function(){e.lookupMenu.clearItems(),e.lookupMenu.toggle(!1)}):this.closeLookupMenu(),this},OO.ui.mixin.LookupElement.prototype.initializeLookupMenuSelection=function(){this.lookupHighlightFirstItem&&!this.lookupMenu.findSelectedItem()&&this.lookupMenu.highlightItem(this.lookupMenu.findFirstSelectableItem())},OO.ui.mixin.LookupElement.prototype.getLookupMenuItems=function(){return this.getRequestData().then(function(t){return this.getLookupMenuOptionsFromData(t)}.bind(this))},OO.ui.mixin.LookupElement.prototype.abortLookupRequest=function(){this.abortRequest()},OO.ui.mixin.LookupElement.prototype.getLookupRequest=null,OO.ui.mixin.LookupElement.prototype.getLookupCacheDataFromResponse=null,OO.ui.mixin.LookupElement.prototype.getLookupMenuOptionsFromData=null,OO.ui.mixin.LookupElement.prototype.setReadOnly=function(t){return OO.ui.TextInputWidget.prototype.setReadOnly.call(this,t),this.isReadOnly()&&this.lookupMenu&&this.closeLookupMenu(),this},OO.ui.mixin.LookupElement.prototype.getRequestQuery=function(){return this.getValue()},OO.ui.mixin.LookupElement.prototype.getRequest=function(){return this.getLookupRequest()},OO.ui.mixin.LookupElement.prototype.getRequestCacheDataFromResponse=function(t){return this.getLookupCacheDataFromResponse(t)},OO.ui.TabPanelLayout=function(t,e){OO.isPlainObject(t)&&void 0===e&&(t=(e=t).name),e=$.extend({scrollable:!0},e),OO.ui.TabPanelLayout.parent.call(this,e),this.name=t,this.label=e.label,this.tabItem=null,this.active=!1,this.$element.addClass("oo-ui-tabPanelLayout").attr("role","tabpanel")},OO.inheritClass(OO.ui.TabPanelLayout,OO.ui.PanelLayout),OO.ui.TabPanelLayout.prototype.getName=function(){return this.name},OO.ui.TabPanelLayout.prototype.isActive=function(){return this.active},OO.ui.TabPanelLayout.prototype.getTabItem=function(){return this.tabItem},OO.ui.TabPanelLayout.prototype.setTabItem=function(t){return this.tabItem=t||null,t&&this.setupTabItem(),this},OO.ui.TabPanelLayout.prototype.setupTabItem=function(){return this.$element.attr("aria-labelledby",this.tabItem.getElementId()),this.tabItem.$element.attr("aria-controls",this.getElementId()),this.label&&this.tabItem.setLabel(this.label),this},OO.ui.TabPanelLayout.prototype.setActive=function(t){(t=!!t)!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-tabPanelLayout-active",this.active),this.emit("active",this.active))},OO.ui.PageLayout=function(t,e){OO.isPlainObject(t)&&void 0===e&&(t=(e=t).name),e=$.extend({scrollable:!0},e),OO.ui.PageLayout.parent.call(this,e),this.name=t,this.outlineItem=null,this.active=!1,this.$element.addClass("oo-ui-pageLayout")},OO.inheritClass(OO.ui.PageLayout,OO.ui.PanelLayout),OO.ui.PageLayout.prototype.getName=function(){return this.name},OO.ui.PageLayout.prototype.isActive=function(){return this.active},OO.ui.PageLayout.prototype.getOutlineItem=function(){return this.outlineItem},OO.ui.PageLayout.prototype.setOutlineItem=function(t){return this.outlineItem=t||null,t&&this.setupOutlineItem(),this},OO.ui.PageLayout.prototype.setupOutlineItem=function(){return this},OO.ui.PageLayout.prototype.setActive=function(t){(t=!!t)!==this.active&&(this.active=t,this.$element.toggleClass("oo-ui-pageLayout-active",t),this.emit("active",this.active))},OO.ui.StackLayout=function(t){t=$.extend({scrollable:!(!t||!t.continuous)},t),OO.ui.StackLayout.parent.call(this,t),OO.ui.mixin.GroupElement.call(this,$.extend({$group:this.$element},t)),this.currentItem=null,this.continuous=!!t.continuous,this.$element.addClass("oo-ui-stackLayout"),this.continuous&&(this.$element.addClass("oo-ui-stackLayout-continuous"),this.$element.on("scroll",OO.ui.debounce(this.onScroll.bind(this),250))),Array.isArray(t.items)&&this.addItems(t.items)},OO.inheritClass(OO.ui.StackLayout,OO.ui.PanelLayout),OO.mixinClass(OO.ui.StackLayout,OO.ui.mixin.GroupElement),OO.ui.StackLayout.prototype.onScroll=function(){var t,e=this.items.length,i=this.items.indexOf(this.currentItem),n=i,o=this.$element[0].getBoundingClientRect();if(o&&(o.top||o.bottom)){if((t=s(this.currentItem)).bottom<o.top)for(;++n<e&&!l(this.items[n]););else if(t.top>o.bottom)for(;0<=--n&&!l(this.items[n]););n!==i&&this.emit("visibleItemChange",this.items[n])}function s(t){return t.$element[0].getBoundingClientRect()}function l(t){var e=s(t);return e.bottom>o.top&&e.top<o.bottom}},OO.ui.StackLayout.prototype.getCurrentItem=function(){return this.currentItem},OO.ui.StackLayout.prototype.unsetCurrentItem=function(){null!==this.currentItem&&(this.currentItem=null,this.emit("set",null))},OO.ui.StackLayout.prototype.addItems=function(t,e){return this.updateHiddenState(t,this.currentItem),OO.ui.mixin.GroupElement.prototype.addItems.call(this,t,e),!this.currentItem&&t.length&&this.setItem(t[0]),this},OO.ui.StackLayout.prototype.removeItems=function(t){return OO.ui.mixin.GroupElement.prototype.removeItems.call(this,t),-1!==t.indexOf(this.currentItem)&&(this.items.length?this.setItem(this.items[0]):this.unsetCurrentItem()),this},OO.ui.StackLayout.prototype.clearItems=function(){return this.unsetCurrentItem(),OO.ui.mixin.GroupElement.prototype.clearItems.call(this),this},OO.ui.StackLayout.prototype.setItem=function(t){return t!==this.currentItem&&(this.updateHiddenState(this.items,t),-1!==this.items.indexOf(t)?(this.currentItem=t,this.emit("set",t)):this.unsetCurrentItem()),this},OO.ui.StackLayout.prototype.resetScroll=function(){return this.continuous?OO.ui.StackLayout.parent.prototype.resetScroll.call(this):(this.getItems().forEach(function(t){var e=t.$element.hasClass("oo-ui-element-hidden");t.$element.removeClass("oo-ui-element-hidden"),t.resetScroll(),e&&t.$element.addClass("oo-ui-element-hidden")}),this)},OO.ui.StackLayout.prototype.updateHiddenState=function(t,e){var i,n;if(!this.continuous){for(i=0,n=t.length;i<n;i++)e&&e===t[i]||(t[i].$element.addClass("oo-ui-element-hidden"),t[i].$element.attr("aria-hidden","true"));e&&(e.$element.removeClass("oo-ui-element-hidden"),e.$element.removeAttr("aria-hidden"))}},OO.ui.MenuLayout=function(t){t=$.extend({expanded:!0,showMenu:!0,menuPosition:"before"},t),OO.ui.MenuLayout.parent.call(this,t),this.menuPanel=null,this.contentPanel=null,this.expanded=!!t.expanded,this.$menu=$("<div>"),this.$content=$("<div>"),this.$menu.addClass("oo-ui-menuLayout-menu"),this.$content.addClass("oo-ui-menuLayout-content"),this.$element.addClass("oo-ui-menuLayout"),t.expanded?this.$element.addClass("oo-ui-menuLayout-expanded"):this.$element.addClass("oo-ui-menuLayout-static"),t.menuPanel&&this.setMenuPanel(t.menuPanel),t.contentPanel&&this.setContentPanel(t.contentPanel),this.setMenuPosition(t.menuPosition),this.toggleMenu(t.showMenu)},OO.inheritClass(OO.ui.MenuLayout,OO.ui.Layout),OO.ui.MenuLayout.prototype.toggleMenu=function(t){return t=void 0===t?!this.showMenu:!!t,this.showMenu!==t&&(this.showMenu=t,this.$element.toggleClass("oo-ui-menuLayout-showMenu",this.showMenu).toggleClass("oo-ui-menuLayout-hideMenu",!this.showMenu),this.$menu.attr("aria-hidden",this.showMenu?"false":"true")),this},OO.ui.MenuLayout.prototype.isMenuVisible=function(){return this.showMenu},OO.ui.MenuLayout.prototype.setMenuPosition=function(t){return-1===["top","bottom","before","after"].indexOf(t)&&(t="before"),this.$element.removeClass("oo-ui-menuLayout-"+this.menuPosition),this.menuPosition=t,"top"===this.menuPosition||"before"===this.menuPosition?this.$element.append(this.$menu,this.$content):this.$element.append(this.$content,this.$menu),this.$element.addClass("oo-ui-menuLayout-"+t),this},OO.ui.MenuLayout.prototype.getMenuPosition=function(){return this.menuPosition},OO.ui.MenuLayout.prototype.setMenuPanel=function(t){this.menuPanel=t,this.$menu.append(this.menuPanel.$element)},OO.ui.MenuLayout.prototype.setContentPanel=function(t){this.contentPanel=t,this.$content.append(this.contentPanel.$element)},OO.ui.MenuLayout.prototype.clearMenuPanel=function(){this.menuPanel=null,this.$menu.empty()},OO.ui.MenuLayout.prototype.clearContentPanel=function(){this.contentPanel=null,this.$content.empty()},OO.ui.MenuLayout.prototype.resetScroll=function(){return this.menuPanel&&this.menuPanel.resetScroll(),this.contentPanel&&this.contentPanel.resetScroll(),this},OO.ui.BookletLayout=function(t){t=t||{},OO.ui.BookletLayout.parent.call(this,t),this.currentPageName=null,this.pages={},this.ignoreFocus=!1,this.stackLayout=new OO.ui.StackLayout({continuous:!!t.continuous,expanded:this.expanded}),this.setContentPanel(this.stackLayout),this.autoFocus=void 0===t.autoFocus||!!t.autoFocus,this.outlineVisible=!1,this.outlined=!!t.outlined,this.outlined&&(this.editable=!!t.editable,this.outlineControlsWidget=null,this.outlineSelectWidget=new OO.ui.OutlineSelectWidget,this.outlinePanel=new OO.ui.PanelLayout({expanded:this.expanded,scrollable:!0}),this.setMenuPanel(this.outlinePanel),this.outlineVisible=!0,this.editable&&(this.outlineControlsWidget=new OO.ui.OutlineControlsWidget(this.outlineSelectWidget))),this.toggleMenu(this.outlined),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.outlined&&(this.outlineSelectWidget.connect(this,{select:"onOutlineSelectWidgetSelect"}),this.scrolling=!1,this.stackLayout.connect(this,{visibleItemChange:"onStackLayoutVisibleItemChange"})),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-bookletLayout"),this.stackLayout.$element.addClass("oo-ui-bookletLayout-stackLayout"),this.outlined&&(this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel").append(this.outlineSelectWidget.$element),this.editable&&this.outlinePanel.$element.addClass("oo-ui-bookletLayout-outlinePanel-editable").append(this.outlineControlsWidget.$element))},OO.inheritClass(OO.ui.BookletLayout,OO.ui.MenuLayout),OO.ui.BookletLayout.prototype.onStackLayoutFocus=function(t){var e,i;for(e in i=$(t.target).closest(".oo-ui-pageLayout"),this.pages)if(this.pages[e].$element[0]===i[0]&&e!==this.currentPageName){this.setPage(e);break}},OO.ui.BookletLayout.prototype.onStackLayoutVisibleItemChange=function(t){this.scrolling=!0,this.outlineSelectWidget.selectItemByData(t.getName()),this.scrolling=!1},OO.ui.BookletLayout.prototype.onStackLayoutSet=function(t){var e,i=this;t&&(e=this.stackLayout.continuous&&!this.scrolling?t.scrollElementIntoView():$.Deferred().resolve(),!this.autoFocus||OO.ui.isMobile()||this.scrolling||e.done(function(){i.focus()}))},OO.ui.BookletLayout.prototype.focus=function(t){var e,i=this.stackLayout.getItems();!(e=void 0!==t&&i[t]?i[t]:this.stackLayout.getCurrentItem())&&this.outlined&&(this.selectFirstSelectablePage(),e=this.stackLayout.getCurrentItem()),e&&(OO.ui.contains(e.$element[0],this.getElementDocument().activeElement,!0)||e.focus())},OO.ui.BookletLayout.prototype.focusFirstFocusable=function(){OO.ui.findFocusable(this.stackLayout.$element).focus()},OO.ui.BookletLayout.prototype.onOutlineSelectWidgetSelect=function(t){t&&this.setPage(t.getData())},OO.ui.BookletLayout.prototype.isOutlined=function(){return this.outlined},OO.ui.BookletLayout.prototype.isEditable=function(){return this.editable},OO.ui.BookletLayout.prototype.isOutlineVisible=function(){return this.outlined&&this.outlineVisible},OO.ui.BookletLayout.prototype.toggleOutline=function(t){var e=this;return this.outlined&&(t=void 0===t?!this.outlineVisible:!!t,this.outlineVisible=t,this.toggleMenu(t),t&&this.editable&&setTimeout(function(){OO.ui.Element.static.reconsiderScrollbars(e.outlinePanel.$element[0])},OO.ui.theme.getDialogTransitionDuration())),this},OO.ui.BookletLayout.prototype.findClosestPage=function(t){var e,i,n,o=this.stackLayout.getItems(),s=o.indexOf(t);if(-1!==s&&(e=o[s+1],i=o[s-1],this.outlined)){if(n=this.outlineSelectWidget.findItemFromData(t.getName()).getLevel(),i&&n===this.outlineSelectWidget.findItemFromData(i.getName()).getLevel())return i;if(e&&n===this.outlineSelectWidget.findItemFromData(e.getName()).getLevel())return e}return i||e||null},OO.ui.BookletLayout.prototype.getOutline=function(){return this.outlineSelectWidget},OO.ui.BookletLayout.prototype.getOutlineControls=function(){return this.outlineControlsWidget},OO.ui.BookletLayout.prototype.getPage=function(t){return this.pages[t]},OO.ui.BookletLayout.prototype.getCurrentPage=function(){var t=this.getCurrentPageName();return t?this.getPage(t):void 0},OO.ui.BookletLayout.prototype.getCurrentPageName=function(){return this.currentPageName},OO.ui.BookletLayout.prototype.addPages=function(t,e){var i,n,o,s,l,u,a=this.stackLayout.getItems(),r=[],h=[];for(i=0,n=t.length;i<n;i++)o=(s=t[i]).getName(),Object.prototype.hasOwnProperty.call(this.pages,o)&&(-1!==(u=a.indexOf(this.pages[o]))&&u+1<e&&e--,r.push(this.pages[o]));for(r.length&&this.removePages(r),i=0,n=t.length;i<n;i++)o=(s=t[i]).getName(),this.pages[s.getName()]=s,this.outlined&&(l=new OO.ui.OutlineOptionWidget({data:o}),s.setOutlineItem(l),h.push(l));return this.outlined&&h.length&&(this.outlineSelectWidget.addItems(h,e),this.selectFirstSelectablePage()),this.stackLayout.addItems(t,e),this.emit("add",t,e),this},OO.ui.BookletLayout.prototype.removePages=function(t){var e,i,n,o,s=[];for(e=0,i=t.length;e<i;e++)n=(o=t[e]).getName(),delete this.pages[n],this.outlined&&(s.push(this.outlineSelectWidget.findItemFromData(n)),o.setOutlineItem(null));return this.outlined&&s.length&&(this.outlineSelectWidget.removeItems(s),this.selectFirstSelectablePage()),this.stackLayout.removeItems(t),this.emit("remove",t),this},OO.ui.BookletLayout.prototype.clearPages=function(){var t,e,i=this.stackLayout.getItems();if(this.pages={},this.currentPageName=null,this.outlined)for(this.outlineSelectWidget.clearItems(),t=0,e=i.length;t<e;t++)i[t].setOutlineItem(null);return this.stackLayout.clearItems(),this.emit("remove",i),this},OO.ui.BookletLayout.prototype.setPage=function(t){var e,i,n=this.pages[t],o=this.currentPageName&&this.pages[this.currentPageName];t!==this.currentPageName&&(this.outlined&&(e=this.outlineSelectWidget.findSelectedItem())&&e.getData()!==t&&this.outlineSelectWidget.selectItemByData(t),n&&(o&&(o.setActive(!1),this.autoFocus&&!OO.ui.isMobile()&&this.stackLayout.continuous&&0!==OO.ui.findFocusable(n.$element).length&&(i=o.$element.find(":focus")).length&&i[0].blur()),this.currentPageName=t,n.setActive(!0),this.stackLayout.setItem(n),!this.stackLayout.continuous&&o&&(i=o.$element.find(":focus")).length&&i[0].blur(),this.emit("set",n)))},OO.ui.BookletLayout.prototype.resetScroll=function(){return OO.ui.BookletLayout.parent.prototype.resetScroll.call(this),this.outlined&&this.stackLayout.continuous&&this.outlineSelectWidget.findFirstSelectableItem()&&(this.scrolling=!0,this.outlineSelectWidget.selectItem(this.outlineSelectWidget.findFirstSelectableItem()),this.scrolling=!1),this},OO.ui.BookletLayout.prototype.selectFirstSelectablePage=function(){return this.outlineSelectWidget.findSelectedItem()||this.outlineSelectWidget.selectItem(this.outlineSelectWidget.findFirstSelectableItem()),this},OO.ui.IndexLayout=function(t){t=$.extend({},t,{menuPosition:"top"}),OO.ui.IndexLayout.parent.call(this,t),this.currentTabPanelName=null,this.tabPanels=t.tabPanels||{},this.ignoreFocus=!1,this.stackLayout=this.contentPanel||new OO.ui.StackLayout({continuous:!!t.continuous,expanded:this.expanded}),this.setContentPanel(this.stackLayout),this.autoFocus=void 0===t.autoFocus||!!t.autoFocus,this.tabSelectWidget=t.tabSelectWidget||new OO.ui.TabSelectWidget({framed:void 0===t.framed||t.framed}),this.tabPanel=this.menuPanel||new OO.ui.PanelLayout({expanded:this.expanded}),this.setMenuPanel(this.tabPanel),this.toggleMenu(!0),this.stackLayout.connect(this,{set:"onStackLayoutSet"}),this.tabSelectWidget.connect(this,{select:"onTabSelectWidgetSelect"}),this.autoFocus&&this.stackLayout.$element.on("focusin",this.onStackLayoutFocus.bind(this)),this.$element.addClass("oo-ui-indexLayout"),this.stackLayout.$element.addClass("oo-ui-indexLayout-stackLayout"),this.tabPanel.$element.addClass("oo-ui-indexLayout-tabPanel").append(this.tabSelectWidget.$element),this.selectFirstSelectableTabPanel()},OO.inheritClass(OO.ui.IndexLayout,OO.ui.MenuLayout),OO.ui.IndexLayout.prototype.onStackLayoutFocus=function(t){var e,i;for(e in i=$(t.target).closest(".oo-ui-tabPanelLayout"),this.tabPanels)if(this.tabPanels[e].$element[0]===i[0]&&e!==this.currentTabPanelName){this.setTabPanel(e);break}},OO.ui.IndexLayout.prototype.onStackLayoutSet=function(t){t&&this.autoFocus&&!OO.ui.isMobile()&&this.focus()},OO.ui.IndexLayout.prototype.focus=function(t){var e,i=this.stackLayout.getItems();(e=void 0!==t&&i[t]?i[t]:this.stackLayout.getCurrentItem())||(this.selectFirstSelectableTabPanel(),e=this.stackLayout.getCurrentItem()),e&&(OO.ui.contains(e.$element[0],this.getElementDocument().activeElement,!0)||e.focus())},OO.ui.IndexLayout.prototype.focusFirstFocusable=function(){OO.ui.findFocusable(this.stackLayout.$element).focus()},OO.ui.IndexLayout.prototype.onTabSelectWidgetSelect=function(t){t&&this.setTabPanel(t.getData())},OO.ui.IndexLayout.prototype.getClosestTabPanel=function(t){var e,i,n,o=this.stackLayout.getItems(),s=o.indexOf(t);if(-1!==s){if(e=o[s+1],i=o[s-1],n=this.tabSelectWidget.findItemFromData(t.getName()).getLevel(),i&&n===this.tabSelectWidget.findItemFromData(i.getName()).getLevel())return i;if(e&&n===this.tabSelectWidget.findItemFromData(e.getName()).getLevel())return e}return i||e||null},OO.ui.IndexLayout.prototype.getTabs=function(){return this.tabSelectWidget},OO.ui.IndexLayout.prototype.getTabPanel=function(t){return this.tabPanels[t]},OO.ui.IndexLayout.prototype.getCurrentTabPanel=function(){var t=this.getCurrentTabPanelName();return t?this.getTabPanel(t):void 0},OO.ui.IndexLayout.prototype.getCurrentTabPanelName=function(){return this.currentTabPanelName},OO.ui.IndexLayout.prototype.addTabPanels=function(t,e){var i,n,o,s,l,u,a=this.stackLayout.getItems(),r=[],h=[];for(i=0,n=t.length;i<n;i++)o=(s=t[i]).getName(),Object.prototype.hasOwnProperty.call(this.tabPanels,o)&&(-1!==(u=a.indexOf(this.tabPanels[o]))&&u+1<e&&e--,r.push(this.tabPanels[o]));for(r.length&&this.removeTabPanels(r),i=0,n=t.length;i<n;i++)o=(s=t[i]).getName(),this.tabPanels[s.getName()]=s,l=new OO.ui.TabOptionWidget({data:o}),s.setTabItem(l),h.push(l);return h.length&&(this.tabSelectWidget.addItems(h,e),this.selectFirstSelectableTabPanel()),this.stackLayout.addItems(t,e),this.emit("add",t,e),this},OO.ui.IndexLayout.prototype.removeTabPanels=function(t){var e,i,n,o,s=[];for(e=0,i=t.length;e<i;e++)n=(o=t[e]).getName(),delete this.tabPanels[n],s.push(this.tabSelectWidget.findItemFromData(n)),o.setTabItem(null);return s.length&&(this.tabSelectWidget.removeItems(s),this.selectFirstSelectableTabPanel()),this.stackLayout.removeItems(t),this.emit("remove",t),this},OO.ui.IndexLayout.prototype.clearTabPanels=function(){var t,e,i=this.stackLayout.getItems();for(this.tabPanels={},this.currentTabPanelName=null,this.tabSelectWidget.clearItems(),t=0,e=i.length;t<e;t++)i[t].setTabItem(null);return this.stackLayout.clearItems(),this.emit("remove",i),this},OO.ui.IndexLayout.prototype.setTabPanel=function(t){var e,i,n,o=this.tabPanels[t];t!==this.currentTabPanelName&&(n=this.getCurrentTabPanel(),(e=this.tabSelectWidget.findSelectedItem())&&e.getData()!==t&&this.tabSelectWidget.selectItemByData(t),o&&(n&&(n.setActive(!1),this.autoFocus&&!OO.ui.isMobile()&&this.stackLayout.continuous&&0!==OO.ui.findFocusable(o.$element).length&&(i=n.$element.find(":focus")).length&&i[0].blur()),this.currentTabPanelName=t,o.setActive(!0),this.stackLayout.setItem(o),!this.stackLayout.continuous&&n&&(i=n.$element.find(":focus")).length&&i[0].blur(),this.emit("set",o)))},OO.ui.IndexLayout.prototype.selectFirstSelectableTabPanel=function(){return this.tabSelectWidget.findSelectedItem()||this.tabSelectWidget.selectItem(this.tabSelectWidget.findFirstSelectableItem()),this},OO.ui.ToggleWidget=function(t){t=t||{},OO.ui.ToggleWidget.parent.call(this,t),OO.ui.mixin.TitledElement.call(this,t),this.value=null,this.$element.addClass("oo-ui-toggleWidget"),this.setValue(!!t.value)},OO.inheritClass(OO.ui.ToggleWidget,OO.ui.Widget),OO.mixinClass(OO.ui.ToggleWidget,OO.ui.mixin.TitledElement),OO.ui.ToggleWidget.prototype.getValue=function(){return this.value},OO.ui.ToggleWidget.prototype.setValue=function(t){return t=!!t,this.value!==t&&(this.value=t,this.emit("change",t),this.$element.toggleClass("oo-ui-toggleWidget-on",t),this.$element.toggleClass("oo-ui-toggleWidget-off",!t)),this},OO.ui.ToggleButtonWidget=function(t){t=t||{},OO.ui.ToggleButtonWidget.parent.call(this,t),OO.ui.mixin.ButtonElement.call(this,$.extend({active:this.active},t)),OO.ui.mixin.IconElement.call(this,t),OO.ui.mixin.IndicatorElement.call(this,t),OO.ui.mixin.LabelElement.call(this,t),OO.ui.mixin.FlaggedElement.call(this,t),OO.ui.mixin.TabIndexedElement.call(this,$.extend({$tabIndexed:this.$button},t)),this.connect(this,{click:"onAction"}),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.addClass("oo-ui-toggleButtonWidget").append(this.$button),this.setTitledElement(this.$button)},OO.inheritClass(OO.ui.ToggleButtonWidget,OO.ui.ToggleWidget),OO.mixinClass(OO.ui.ToggleButtonWidget,OO.ui.mixin.ButtonElement),OO.mixinClass(OO.ui.ToggleButtonWidget,OO.ui.mixin.IconElement),OO.mixinClass(OO.ui.ToggleButtonWidget,OO.ui.mixin.IndicatorElement),OO.mixinClass(OO.ui.ToggleButtonWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.ToggleButtonWidget,OO.ui.mixin.FlaggedElement),OO.mixinClass(OO.ui.ToggleButtonWidget,OO.ui.mixin.TabIndexedElement),OO.ui.ToggleButtonWidget.static.tagName="span",OO.ui.ToggleButtonWidget.prototype.onAction=function(){this.setValue(!this.value)},OO.ui.ToggleButtonWidget.prototype.setValue=function(t){return(t=!!t)!==this.value&&(this.$button&&this.$button.attr("aria-pressed",t.toString()),this.setActive(t)),OO.ui.ToggleButtonWidget.parent.prototype.setValue.call(this,t),this},OO.ui.ToggleButtonWidget.prototype.setButtonElement=function(t){this.$button&&this.$button.removeAttr("aria-pressed"),OO.ui.mixin.ButtonElement.prototype.setButtonElement.call(this,t),this.$button.attr("aria-pressed",this.value.toString())},OO.ui.ToggleSwitchWidget=function(t){OO.ui.ToggleSwitchWidget.parent.call(this,t),OO.ui.mixin.TabIndexedElement.call(this,t),this.dragging=!1,this.dragStart=null,this.sliding=!1,this.$glow=$("<span>"),this.$grip=$("<span>"),this.$element.on({click:this.onClick.bind(this),keypress:this.onKeyPress.bind(this)}),this.$glow.addClass("oo-ui-toggleSwitchWidget-glow"),this.$grip.addClass("oo-ui-toggleSwitchWidget-grip"),this.$element.addClass("oo-ui-toggleSwitchWidget").attr("role","checkbox").append(this.$glow,this.$grip)},OO.inheritClass(OO.ui.ToggleSwitchWidget,OO.ui.ToggleWidget),OO.mixinClass(OO.ui.ToggleSwitchWidget,OO.ui.mixin.TabIndexedElement),OO.ui.ToggleSwitchWidget.prototype.onClick=function(t){return this.isDisabled()||t.which!==OO.ui.MouseButtons.LEFT||this.setValue(!this.value),!1},OO.ui.ToggleSwitchWidget.prototype.onKeyPress=function(t){if(!this.isDisabled()&&(t.which===OO.ui.Keys.SPACE||t.which===OO.ui.Keys.ENTER))return this.setValue(!this.value),!1},OO.ui.ToggleSwitchWidget.prototype.setValue=function(t){return OO.ui.ToggleSwitchWidget.parent.prototype.setValue.call(this,t),this.$element.attr("aria-checked",this.value.toString()),this},OO.ui.ToggleSwitchWidget.prototype.simulateLabelClick=function(){this.isDisabled()||this.setValue(!this.value),this.focus()},OO.ui.OutlineControlsWidget=function(t,e){OO.isPlainObject(t)&&void 0===e&&(t=(e=t).outline),e=e||{},OO.ui.OutlineControlsWidget.parent.call(this,e),OO.ui.mixin.GroupElement.call(this,e),this.outline=t,this.$movers=$("<div>"),this.upButton=new OO.ui.ButtonWidget({framed:!1,icon:"collapse",title:OO.ui.msg("ooui-outline-control-move-up")}),this.downButton=new OO.ui.ButtonWidget({framed:!1,icon:"expand",title:OO.ui.msg("ooui-outline-control-move-down")}),this.removeButton=new OO.ui.ButtonWidget({framed:!1,icon:"trash",title:OO.ui.msg("ooui-outline-control-remove")}),this.abilities={move:!0,remove:!0},t.connect(this,{select:"onOutlineChange",add:"onOutlineChange",remove:"onOutlineChange"}),this.upButton.connect(this,{click:["emit","move",-1]}),this.downButton.connect(this,{click:["emit","move",1]}),this.removeButton.connect(this,{click:["emit","remove"]}),this.$element.addClass("oo-ui-outlineControlsWidget"),this.$group.addClass("oo-ui-outlineControlsWidget-items"),this.$movers.addClass("oo-ui-outlineControlsWidget-movers").append(this.removeButton.$element,this.upButton.$element,this.downButton.$element),this.$element.append(this.$icon,this.$group,this.$movers),this.setAbilities(e.abilities||{})},OO.inheritClass(OO.ui.OutlineControlsWidget,OO.ui.Widget),OO.mixinClass(OO.ui.OutlineControlsWidget,OO.ui.mixin.GroupElement),OO.ui.OutlineControlsWidget.prototype.setAbilities=function(t){var e;for(e in this.abilities)void 0!==t[e]&&(this.abilities[e]=!!t[e]);this.onOutlineChange()},OO.ui.OutlineControlsWidget.prototype.onOutlineChange=function(){var t,e,i,n,o=this.outline.getItems(),s=this.outline.findSelectedItem(),l=this.abilities.move&&s&&s.isMovable(),u=this.abilities.remove&&s&&s.isRemovable();if(l){for(t=-1,e=o.length;++t<e;)if(o[t].isMovable()){i=o[t];break}for(t=e;t--;)if(o[t].isMovable()){n=o[t];break}}this.upButton.setDisabled(!l||s===i),this.downButton.setDisabled(!l||s===n),this.removeButton.setDisabled(!u)},OO.ui.OutlineOptionWidget=function(t){t=t||{},OO.ui.OutlineOptionWidget.parent.call(this,t),this.level=0,this.movable=!!t.movable,this.removable=!!t.removable,this.$element.addClass("oo-ui-outlineOptionWidget"),this.setLevel(t.level)},OO.inheritClass(OO.ui.OutlineOptionWidget,OO.ui.DecoratedOptionWidget),OO.ui.OutlineOptionWidget.static.highlightable=!0,OO.ui.OutlineOptionWidget.static.scrollIntoViewOnSelect=!0,OO.ui.OutlineOptionWidget.static.levelClass="oo-ui-outlineOptionWidget-level-",OO.ui.OutlineOptionWidget.static.levels=3,OO.ui.OutlineOptionWidget.prototype.isMovable=function(){return this.movable},OO.ui.OutlineOptionWidget.prototype.isRemovable=function(){return this.removable},OO.ui.OutlineOptionWidget.prototype.getLevel=function(){return this.level},OO.ui.OutlineOptionWidget.prototype.setPressed=function(t){return OO.ui.OutlineOptionWidget.parent.prototype.setPressed.call(this,t),this},OO.ui.OutlineOptionWidget.prototype.setMovable=function(t){return this.movable=!!t,this.updateThemeClasses(),this},OO.ui.OutlineOptionWidget.prototype.setRemovable=function(t){return this.removable=!!t,this.updateThemeClasses(),this},OO.ui.OutlineOptionWidget.prototype.setSelected=function(t){return OO.ui.OutlineOptionWidget.parent.prototype.setSelected.call(this,t),this},OO.ui.OutlineOptionWidget.prototype.setLevel=function(t){var e=this.constructor.static.levels,i=this.constructor.static.levelClass,n=e;for(this.level=t?Math.max(0,Math.min(e-1,t)):0;n--;)this.level===n?this.$element.addClass(i+n):this.$element.removeClass(i+n);return this.updateThemeClasses(),this},OO.ui.OutlineSelectWidget=function(t){OO.ui.OutlineSelectWidget.parent.call(this,t),OO.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindDocumentKeyDownListener.bind(this),blur:this.unbindDocumentKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-outlineSelectWidget")},OO.inheritClass(OO.ui.OutlineSelectWidget,OO.ui.SelectWidget),OO.mixinClass(OO.ui.OutlineSelectWidget,OO.ui.mixin.TabIndexedElement),OO.ui.ButtonOptionWidget=function(t){t=t||{},OO.ui.ButtonOptionWidget.parent.call(this,t),OO.ui.mixin.ButtonElement.call(this,t),OO.ui.mixin.IconElement.call(this,t),OO.ui.mixin.IndicatorElement.call(this,t),this.$element.addClass("oo-ui-buttonOptionWidget"),this.$button.append(this.$icon,this.$label,this.$indicator),this.$element.append(this.$button),this.setTitledElement(this.$button)},OO.inheritClass(OO.ui.ButtonOptionWidget,OO.ui.OptionWidget),OO.mixinClass(OO.ui.ButtonOptionWidget,OO.ui.mixin.ButtonElement),OO.mixinClass(OO.ui.ButtonOptionWidget,OO.ui.mixin.IconElement),OO.mixinClass(OO.ui.ButtonOptionWidget,OO.ui.mixin.IndicatorElement),OO.ui.ButtonOptionWidget.static.cancelButtonMouseDownEvents=!1,OO.ui.ButtonOptionWidget.static.highlightable=!1,OO.ui.ButtonOptionWidget.prototype.setSelected=function(t){return OO.ui.ButtonOptionWidget.parent.prototype.setSelected.call(this,t),this.constructor.static.selectable&&this.setActive(t),this},OO.ui.ButtonSelectWidget=function(t){OO.ui.ButtonSelectWidget.parent.call(this,t),OO.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindDocumentKeyDownListener.bind(this),blur:this.unbindDocumentKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-buttonSelectWidget")},OO.inheritClass(OO.ui.ButtonSelectWidget,OO.ui.SelectWidget),OO.mixinClass(OO.ui.ButtonSelectWidget,OO.ui.mixin.TabIndexedElement),OO.ui.TabOptionWidget=function(t){t=t||{},OO.ui.TabOptionWidget.parent.call(this,t),this.$element.addClass("oo-ui-tabOptionWidget").attr("role","tab")},OO.inheritClass(OO.ui.TabOptionWidget,OO.ui.OptionWidget),OO.ui.TabOptionWidget.static.highlightable=!1,OO.ui.TabSelectWidget=function(t){OO.ui.TabSelectWidget.parent.call(this,t),OO.ui.mixin.TabIndexedElement.call(this,t),this.$element.on({focus:this.bindDocumentKeyDownListener.bind(this),blur:this.unbindDocumentKeyDownListener.bind(this)}),this.$element.addClass("oo-ui-tabSelectWidget").attr("role","tablist"),this.toggleFramed(void 0===t.framed||t.framed),OO.ui.isMobile()&&this.$element.addClass("oo-ui-tabSelectWidget-mobile")},OO.inheritClass(OO.ui.TabSelectWidget,OO.ui.SelectWidget),OO.mixinClass(OO.ui.TabSelectWidget,OO.ui.mixin.TabIndexedElement),OO.ui.TabSelectWidget.prototype.isFramed=function(){return this.framed},OO.ui.TabSelectWidget.prototype.toggleFramed=function(t){return(t=void 0===t?!this.framed:!!t)!==this.framed&&(this.framed=t,this.$element.toggleClass("oo-ui-tabSelectWidget-frameless",!t).toggleClass("oo-ui-tabSelectWidget-framed",t)),this},OO.ui.TagItemWidget=function(t){t=t||{},OO.ui.TagItemWidget.parent.call(this,t),OO.ui.mixin.ItemWidget.call(this),OO.ui.mixin.LabelElement.call(this,t),OO.ui.mixin.FlaggedElement.call(this,t),OO.ui.mixin.TabIndexedElement.call(this,t),OO.ui.mixin.DraggableElement.call(this,t),this.valid=void 0===t.valid||!!t.valid,this.fixed=!!t.fixed,this.closeButton=new OO.ui.ButtonWidget({framed:!1,icon:"close",tabIndex:-1,title:OO.ui.msg("ooui-item-remove")}),this.closeButton.setDisabled(this.isDisabled()),this.closeButton.connect(this,{click:"remove"}),this.$element.on("click",this.select.bind(this)).on("keydown",this.onKeyDown.bind(this)).on("mousedown",function(t){t.stopPropagation()}),this.$element.addClass("oo-ui-tagItemWidget").append(this.$label,this.closeButton.$element)},OO.inheritClass(OO.ui.TagItemWidget,OO.ui.Widget),OO.mixinClass(OO.ui.TagItemWidget,OO.ui.mixin.ItemWidget),OO.mixinClass(OO.ui.TagItemWidget,OO.ui.mixin.LabelElement),OO.mixinClass(OO.ui.TagItemWidget,OO.ui.mixin.FlaggedElement),OO.mixinClass(OO.ui.TagItemWidget,OO.ui.mixin.TabIndexedElement),OO.mixinClass(OO.ui.TagItemWidget,OO.ui.mixin.DraggableElement),OO.ui.TagItemWidget.prototype.setFixed=function(t){return t=void 0===t?!this.fixed:!!t,this.fixed!==t&&(this.fixed=t,this.closeButton&&this.closeButton.toggle(!this.fixed),this.fixed||!this.elementGroup||this.elementGroup.isDraggable()||this.toggleDraggable(!this.fixed),this.$element.toggleClass("oo-ui-tagItemWidget-fixed",this.fixed),this.emit("fixed",this.isFixed())),this},OO.ui.TagItemWidget.prototype.isFixed=function(){return this.fixed},OO.ui.TagItemWidget.prototype.setDisabled=function(t){return t&&this.elementGroup&&!this.elementGroup.isDisabled()&&OO.ui.warnDeprecation("TagItemWidget#setDisabled: Disabling individual items is deprecated and will result in inconsistent behavior. Use #setFixed instead. See T193571."),OO.ui.TagItemWidget.parent.prototype.setDisabled.call(this,t),t||!this.toggleDraggable||!this.elementGroup||this.isFixed()||this.elementGroup.isDraggable()||this.toggleDraggable(!t),this.closeButton&&this.closeButton.setDisabled(t),this},OO.ui.TagItemWidget.prototype.remove=function(){this.isDisabled()||this.isFixed()||this.emit("remove")},OO.ui.TagItemWidget.prototype.onKeyDown=function(t){var e;return this.isDisabled()||this.isFixed()||t.keyCode!==OO.ui.Keys.BACKSPACE&&t.keyCode!==OO.ui.Keys.DELETE?t.keyCode===OO.ui.Keys.ENTER?(this.select(),!1):t.keyCode===OO.ui.Keys.LEFT||t.keyCode===OO.ui.Keys.RIGHT?(e="rtl"===OO.ui.Element.static.getDir(this.$element)?{left:"forwards",right:"backwards"}:{left:"backwards",right:"forwards"},this.emit("navigate",t.keyCode===OO.ui.Keys.LEFT?e.left:e.right),!1):void 0:(this.remove(),!1)},OO.ui.TagItemWidget.prototype.select=function(){this.isDisabled()||this.emit("select")},OO.ui.TagItemWidget.prototype.toggleValid=function(t){t=void 0===t?!this.valid:!!t,this.valid!==t&&(this.valid=t,this.setFlags({invalid:!this.valid}),this.emit("valid",this.valid))},OO.ui.TagItemWidget.prototype.isValid=function(){return this.valid},OO.ui.TagMultiselectWidget=function(t){var e,i=window.requestAnimationFrame||setTimeout,n=this,o=$("<span>").addClass("oo-ui-tagMultiselectWidget-focusTrap");t=t||{},OO.ui.TagMultiselectWidget.parent.call(this,t),OO.ui.mixin.GroupWidget.call(this,t),OO.ui.mixin.IndicatorElement.call(this,t),OO.ui.mixin.IconElement.call(this,t),OO.ui.mixin.TabIndexedElement.call(this,t),OO.ui.mixin.FlaggedElement.call(this,t),OO.ui.mixin.DraggableGroupElement.call(this,t),OO.ui.mixin.TitledElement.call(this,t),this.toggleDraggable(void 0===t.allowReordering||!!t.allowReordering),this.inputPosition=-1<this.constructor.static.allowedInputPositions.indexOf(t.inputPosition)?t.inputPosition:"inline",this.allowEditTags=void 0===t.allowEditTags||!!t.allowEditTags,this.allowArbitrary=!!t.allowArbitrary,this.allowDuplicates=!!t.allowDuplicates,this.allowedValues=t.allowedValues||[],this.allowDisplayInvalidTags=t.allowDisplayInvalidTags,this.hasInput="none"!==this.inputPosition,this.tagLimit=t.tagLimit,this.height=null,this.valid=!0,this.$content=$("<div>").addClass("oo-ui-tagMultiselectWidget-content"),this.$handle=$("<div>").addClass("oo-ui-tagMultiselectWidget-handle").append(this.$indicator,this.$icon,this.$content.append(this.$group.addClass("oo-ui-tagMultiselectWidget-group"))),this.aggregate({remove:"itemRemove",navigate:"itemNavigate",select:"itemSelect",fixed:"itemFixed"}),this.connect(this,{itemRemove:"onTagRemove",itemSelect:"onTagSelect",itemFixed:"onTagFixed",itemNavigate:"onTagNavigate",change:"onChangeTags"}),this.$handle.on({mousedown:this.onMouseDown.bind(this)}),this.$element.addClass("oo-ui-tagMultiselectWidget").append(this.$handle),this.hasInput?(t.inputWidget?this.input=t.inputWidget:this.input=new OO.ui.TextInputWidget($.extend({placeholder:t.placeholder,classes:["oo-ui-tagMultiselectWidget-input"]},t.input)),this.input.setDisabled(this.isDisabled()),e={focus:this.onInputFocus.bind(this),blur:this.onInputBlur.bind(this),"propertychange change click mouseup keydown keyup input cut paste select focus":OO.ui.debounce(this.updateInputSize.bind(this)),keydown:this.onInputKeyDown.bind(this),keypress:this.onInputKeyPress.bind(this)},this.input.$input.on(e),this.inputPlaceholder=this.input.$input.attr("placeholder"),"outline"===this.inputPosition?(this.input.$element.css("max-width","inherit"),this.$element.addClass("oo-ui-tagMultiselectWidget-outlined").append(this.input.$element)):(this.$element.addClass("oo-ui-tagMultiselectWidget-inlined"),this.$content.append(this.input.$input))):this.$content.append(o),this.setTabIndexedElement(this.hasInput?this.input.$input:o),t.selected&&this.setValue(t.selected),i(function(){n.hasInput&&n.updateInputSize()})},OO.inheritClass(OO.ui.TagMultiselectWidget,OO.ui.Widget),OO.mixinClass(OO.ui.TagMultiselectWidget,OO.ui.mixin.GroupWidget),OO.mixinClass(OO.ui.TagMultiselectWidget,OO.ui.mixin.DraggableGroupElement),OO.mixinClass(OO.ui.TagMultiselectWidget,OO.ui.mixin.IndicatorElement),OO.mixinClass(OO.ui.TagMultiselectWidget,OO.ui.mixin.IconElement),OO.mixinClass(OO.ui.TagMultiselectWidget,OO.ui.mixin.TabIndexedElement),OO.mixinClass(OO.ui.TagMultiselectWidget,OO.ui.mixin.FlaggedElement),OO.mixinClass(OO.ui.TagMultiselectWidget,OO.ui.mixin.TitledElement),OO.ui.TagMultiselectWidget.static.allowedInputPositions=["inline","outline","none"],OO.ui.TagMultiselectWidget.prototype.onMouseDown=function(t){if(!(this.isDisabled()||this.hasInput&&t.target===this.input.$input[0]||t.which!==OO.ui.MouseButtons.LEFT))return this.focus(),!1},OO.ui.TagMultiselectWidget.prototype.onInputKeyPress=function(t){var e,i=t.metaKey||t.ctrlKey;if(!this.isDisabled())return t.which===OO.ui.Keys.ENTER&&(e=this.doInputEnter(t,i)),setTimeout(this.updateInputSize.bind(this),0),e},OO.ui.TagMultiselectWidget.prototype.onInputKeyDown=function(t){var e,i,n,o,s,l=this,u=t.metaKey||t.ctrlKey;if(!this.isDisabled()){if(t.keyCode===OO.ui.Keys.BACKSPACE)return this.doInputBackspace(t,u);if(t.keyCode===OO.ui.Keys.ESCAPE)return this.doInputEscape(t);if((t.keyCode===OO.ui.Keys.LEFT||t.keyCode===OO.ui.Keys.RIGHT)&&(e="rtl"===OO.ui.Element.static.getDir(this.$element)?{left:"forwards",right:"backwards"}:{left:"backwards",right:"forwards"},i=t.keyCode===OO.ui.Keys.LEFT?e.left:e.right,!this.hasInput||(n=i,o=l.input.getRange(),s=l.hasInput&&l.input.getValue(),"forwards"===n&&o.to>s.length-1||"backwards"===n&&o.from<=0)))return this.doInputArrow(t,i,u)}},OO.ui.TagMultiselectWidget.prototype.onInputFocus=function(){this.$element.addClass("oo-ui-tagMultiselectWidget-focus"),this.toggleValid(!0)},OO.ui.TagMultiselectWidget.prototype.onInputBlur=function(){this.$element.removeClass("oo-ui-tagMultiselectWidget-focus"),this.addTagFromInput(),this.toggleValid(this.checkValidity()&&(!this.hasInput||!this.input.getValue()))},OO.ui.TagMultiselectWidget.prototype.doInputEnter=function(){return this.addTagFromInput(),!1},OO.ui.TagMultiselectWidget.prototype.doInputBackspace=function(t,e){var i,n;if("inline"===this.inputPosition&&""===this.input.getValue()&&!this.isEmpty())return(n=(i=this.getItems())[i.length-1]).isDisabled()||n.isFixed()||(this.removeItems([n]),e||this.input.setValue(n.getLabel())),!1},OO.ui.TagMultiselectWidget.prototype.doInputEscape=function(){this.clearInput()},OO.ui.TagMultiselectWidget.prototype.doInputArrow=function(t,e){"inline"!==this.inputPosition||this.isEmpty()||"backwards"!==e||this.getPreviousItem().focus()},OO.ui.TagMultiselectWidget.prototype.onTagSelect=function(t){this.hasInput&&this.allowEditTags&&!t.isFixed()&&(this.input.getValue()&&this.addTagFromInput(),this.input.setValue(t.getLabel()),this.removeItems([t]),this.focus())},OO.ui.TagMultiselectWidget.prototype.onTagFixed=function(t){var e,i=this.getItems();for(e=0;e<i.length&&(i[e]===t||i[e].isFixed());e++);this.addItems(t,e)},OO.ui.TagMultiselectWidget.prototype.onChangeTags=function(){var t=this.isUnderLimit();this.toggleValid(this.checkValidity()&&!(this.hasInput&&this.input.getValue())),this.hasInput&&(this.updateInputSize(),t||this.input.setValue(""),"outline"===this.inputPosition?(this.input.$input.attr("placeholder",t?this.inputPlaceholder:""),this.input.setDisabled(!t)):this.input.$input.toggleClass("oo-ui-element-hidden",!t)),this.updateIfHeightChanged()},OO.ui.TagMultiselectWidget.prototype.setDisabled=function(e){OO.ui.TagMultiselectWidget.parent.prototype.setDisabled.call(this,e),this.hasInput&&this.input&&(e||this.updateInputSize(),this.input.setDisabled(!!e&&!this.isUnderLimit())),this.items&&this.getItems().forEach(function(t){t.setDisabled(!!e)})},OO.ui.TagMultiselectWidget.prototype.onTagRemove=function(t){this.removeTagByData(t.getData())},OO.ui.TagMultiselectWidget.prototype.onTagNavigate=function(t,e){var i=this.getItems()[0];"forwards"===e?this.getNextItem(t).focus():"inline"!==!this.inputPosition&&t===i||this.getPreviousItem(t).focus()},OO.ui.TagMultiselectWidget.prototype.addTagFromInput=function(){var t=this.input.getValue(),e=this.isAllowedData(t);t&&(e||this.allowDisplayInvalidTags)&&(this.clearInput(),this.addTag(t))},OO.ui.TagMultiselectWidget.prototype.clearInput=function(){this.input.setValue("")},OO.ui.TagMultiselectWidget.prototype.isDuplicateData=function(t){return!!this.findItemFromData(t)},OO.ui.TagMultiselectWidget.prototype.isAllowedData=function(e){return!(!this.allowDuplicates&&this.isDuplicateData(e))&&(!!this.allowArbitrary||!!this.getAllowedValues().some(function(t){return e===t}))},OO.ui.TagMultiselectWidget.prototype.getAllowedValues=function(){return this.allowedValues},OO.ui.TagMultiselectWidget.prototype.addAllowedValue=function(t){-1===this.allowedValues.indexOf(t)&&this.allowedValues.push(t)},OO.ui.TagMultiselectWidget.prototype.getValue=function(){return this.getItems().filter(function(t){return t.isValid()}).map(function(t){return t.getData()})},OO.ui.TagMultiselectWidget.prototype.setValue=function(t){t=Array.isArray(t)?t:[t],this.clearItems(),t.forEach(function(t){"string"==typeof t?this.addTag(t):this.addTag(t.data,t.label)}.bind(this))},OO.ui.TagMultiselectWidget.prototype.addTag=function(t,e){var i,n=this.isAllowedData(t);return!(!this.isUnderLimit()||!n&&!this.allowDisplayInvalidTags)&&((i=this.createTagItemWidget(t,e)).toggleValid(n),this.addItems([i]),!0)},OO.ui.TagMultiselectWidget.prototype.isUnderLimit=function(){return!this.tagLimit||this.getItemCount()<this.tagLimit},OO.ui.TagMultiselectWidget.prototype.removeTagByData=function(t){var e=this.findItemFromData(t);this.removeItems([e])},OO.ui.TagMultiselectWidget.prototype.createTagItemWidget=function(t,e){return e=e||t,new OO.ui.TagItemWidget({data:t,label:e})},OO.ui.TagMultiselectWidget.prototype.getNextItem=function(t){var e=this.items.indexOf(t);return void 0===t||-1===e?this.items[0]:e===this.items.length-1?this.hasInput?this.input:this.items[0]:this.items[e+1]},OO.ui.TagMultiselectWidget.prototype.getPreviousItem=function(t){var e=this.items.indexOf(t);return void 0===t||-1===e?this.items[this.items.length-1]:0===e?this.hasInput?this.input:this.items[this.items.length-1]:this.items[e-1]},OO.ui.TagMultiselectWidget.prototype.updateInputSize=function(){var t,e,i,n;if("inline"!==this.inputPosition||this.isDisabled())this.updateIfHeightChanged();else{if(0===this.input.$input[0].scrollWidth)return;if(this.input.$input.css("width","1em"),t=this.$group.children().last(),e=OO.ui.Element.static.getDir(this.$handle),void 0===this.contentWidthWithPlaceholder&&""===this.input.getValue()&&void 0!==this.input.$input.attr("placeholder")&&(this.input.setValue(this.input.$input.attr("placeholder")),this.contentWidthWithPlaceholder=this.input.$input[0].scrollWidth,this.input.setValue("")),(i=Math.max(this.input.$input[0].scrollWidth,void 0===this.contentWidthWithPlaceholder?0:this.contentWidthWithPlaceholder))<this.input.$input.width())return void this.updateIfHeightChanged();n=0===t.length?this.$content.innerWidth():"ltr"===e?this.$content.innerWidth()-t.position().left-t.outerWidth():t.position().left,(n-=13)<i&&(n=this.$content.innerWidth()-13),this.input.$input.width(Math.floor(n)),this.updateIfHeightChanged()}},OO.ui.TagMultiselectWidget.prototype.updateIfHeightChanged=function(){var t=this.$element.height();t!==this.height&&(this.height=t,this.emit("resize"))},OO.ui.TagMultiselectWidget.prototype.checkValidity=function(){return this.getItems().every(function(t){return t.isValid()})},OO.ui.TagMultiselectWidget.prototype.toggleValid=function(t){t=void 0===t?!this.valid:!!t,this.valid!==t&&(this.valid=t,this.setFlags({invalid:!this.valid}),this.emit("valid",this.valid))},OO.ui.TagMultiselectWidget.prototype.isValid=function(){return this.valid},OO.ui.PopupTagMultiselectWidget=function(t){var e,i={popup:{}};t=t||{},OO.ui.PopupTagMultiselectWidget.parent.call(this,$.extend({inputPosition:"none"},t)),this.$overlay=(!0===t.$overlay?OO.ui.getDefaultOverlay():t.$overlay)||this.$element,t.popup||(e=new OO.ui.TextInputWidget,i.popupInput=e,i.popup.$content=e.$element,i.popup.padded=!0,this.$element.addClass("oo-ui-popupTagMultiselectWidget-defaultPopup")),i.popup.$overlay=this.$overlay,i.popup.$autoCloseIgnore=this.hasInput?this.input.$element.add(this.$overlay):this.$overlay,t=$.extend(i,t),OO.ui.mixin.PopupElement.call(this,t),this.hasInput&&this.input.$input.on("focus",this.popup.toggle.bind(this.popup,!0)),this.popupInput=t.popupInput,this.popupInput&&this.popupInput.connect(this,{enter:"onPopupInputEnter"}),this.on("resize",this.popup.updateDimensions.bind(this.popup)),this.popup.connect(this,{toggle:"onPopupToggle"}),this.$tabIndexed.on("focus",this.onFocus.bind(this)),this.$element.append(this.popup.$element).addClass("oo-ui-popupTagMultiselectWidget"),OO.ui.warnDeprecation("PopupTagMultiselectWidget: Deprecated widget. Use MenuTagMultiselectWidget instead. See T208821.")},OO.inheritClass(OO.ui.PopupTagMultiselectWidget,OO.ui.TagMultiselectWidget),OO.mixinClass(OO.ui.PopupTagMultiselectWidget,OO.ui.mixin.PopupElement),OO.ui.PopupTagMultiselectWidget.prototype.onFocus=function(){this.popup.toggle(!0)},OO.ui.PopupTagMultiselectWidget.prototype.onPopupToggle=function(t){t&&this.popupInput&&this.popupInput.focus()},OO.ui.PopupTagMultiselectWidget.prototype.onPopupInputEnter=function(){this.popupInput&&(this.addTagByPopupValue(this.popupInput.getValue()),this.popupInput.setValue(""))},OO.ui.PopupTagMultiselectWidget.prototype.onTagSelect=function(t){this.popupInput&&this.allowEditTags?(this.popupInput.setValue(t.getData()),this.removeItems([t]),this.popup.toggle(!0),this.popupInput.focus()):OO.ui.PopupTagMultiselectWidget.parent.prototype.onTagSelect.call(this,t)},OO.ui.PopupTagMultiselectWidget.prototype.addTagByPopupValue=function(t,e){this.addTag(t,e)},OO.ui.MenuTagMultiselectWidget=function(t){var e=$([]);t=t||{},OO.ui.MenuTagMultiselectWidget.parent.call(this,t),e=e.add(this.$group),this.hasInput&&(e=e.add(this.input.$element)),this.$overlay=(!0===t.$overlay?OO.ui.getDefaultOverlay():t.$overlay)||this.$element,this.clearInputOnChoose=void 0===t.clearInputOnChoose||!!t.clearInputOnChoose,this.menu=this.createMenuWidget($.extend({widget:this,hideOnChoose:!1,input:this.hasInput?this.input:null,$input:this.hasInput?this.input.$input:null,filterFromInput:!!this.hasInput,highlightOnFilter:!this.allowArbitrary,multiselect:!0,$autoCloseIgnore:e,$floatableContainer:this.hasInput&&"outline"===this.inputPosition?this.input.$element:this.$element,$overlay:this.$overlay,disabled:this.isDisabled()},t.menu)),this.addOptions(t.options||[]),this.menu.connect(this,{choose:"onMenuChoose",toggle:"onMenuToggle"}),this.hasInput&&this.input.connect(this,{change:"onInputChange"}),this.connect(this,{resize:"onResize"}),this.$overlay.append(this.menu.$element),this.$element.addClass("oo-ui-menuTagMultiselectWidget"),this.menu.$focusOwner.removeAttr("aria-expanded"),t.selected&&this.setValue(t.selected)},OO.inheritClass(OO.ui.MenuTagMultiselectWidget,OO.ui.TagMultiselectWidget),OO.ui.MenuTagMultiselectWidget.prototype.onResize=function(){this.menu.position()},OO.ui.MenuTagMultiselectWidget.prototype.onInputFocus=function(){OO.ui.MenuTagMultiselectWidget.parent.prototype.onInputFocus.call(this),this.menu.toggle(!0)},OO.ui.MenuTagMultiselectWidget.prototype.onInputChange=function(){this.menu.toggle(!0)},OO.ui.MenuTagMultiselectWidget.prototype.onMenuChoose=function(t,e){this.hasInput&&this.clearInputOnChoose&&this.input.setValue(""),e&&!this.findItemFromData(t.getData())?this.addTag(t.getData(),t.getLabel()):this.removeTagByData(t.getData())},OO.ui.MenuTagMultiselectWidget.prototype.onMenuToggle=function(t){t||(this.menu.highlightItem(null),this.menu.scrollToTop()),setTimeout(function(){this.menu.$focusOwner.removeAttr("aria-expanded")}.bind(this))},OO.ui.MenuTagMultiselectWidget.prototype.onTagSelect=function(t){var e=this.menu.findItemFromData(t.getData());this.allowArbitrary?OO.ui.MenuTagMultiselectWidget.parent.prototype.onTagSelect.call(this,t):(this.hasInput&&this.menu.filterFromInput&&this.input.setValue(""),this.focus(),this.menu.highlightItem(e),this.menu.scrollItemIntoView(e))},OO.ui.MenuTagMultiselectWidget.prototype.removeItems=function(t){var i=this;OO.ui.MenuTagMultiselectWidget.parent.prototype.removeItems.call(this,t),t.forEach(function(t){var e=i.menu.findItemFromData(t.getData());e&&i.menu.unselectItem(e)})},OO.ui.MenuTagMultiselectWidget.prototype.setValue=function(t){t=Array.isArray(t)?t:[t],this.menu&&(this.clearItems(),t.forEach(function(t){var e,i,n;"string"==typeof t?e=i=t:(e=t.data,i=t.label),(n=this.menu.getItemFromLabel(i)||this.menu.findItemFromData(e))?(this.addTag(n.getData(),n.getLabel()),this.menu.selectItem(n)):this.allowArbitrary&&this.addTag(e,i)}.bind(this)))},OO.ui.MenuTagMultiselectWidget.prototype.setDisabled=function(t){OO.ui.MenuTagMultiselectWidget.parent.prototype.setDisabled.call(this,t),this.menu&&this.menu.setDisabled(t)},OO.ui.MenuTagMultiselectWidget.prototype.initializeMenuSelection=function(){var t;this.menu.highlightItem(this.allowArbitrary?null:this.menu.findFirstSelectableItem()),(t=this.menu.findHighlightedItem())&&this.menu.scrollItemIntoView(t)},OO.ui.MenuTagMultiselectWidget.prototype.addTagFromInput=function(){var t=this.input.getValue(),e=this.menu.findHighlightedItem()||this.menu.findItemFromData(t),i=e?e.getData():t,n=this.isAllowedData(i);t&&(n||this.allowDisplayInvalidTags)&&(this.clearInput(),e?this.addTag(i,e.getLabel()):this.addTag(t))},OO.ui.MenuTagMultiselectWidget.prototype.getMenuVisibleItems=function(){return this.menu.getItems().filter(function(t){return t.isVisible()})},OO.ui.MenuTagMultiselectWidget.prototype.createMenuWidget=function(t){return new OO.ui.MenuSelectWidget(t)},OO.ui.MenuTagMultiselectWidget.prototype.addOptions=function(t){var e=this,i=t.map(function(t){return e.createMenuOptionWidget(t.data,t.label,t.icon)});this.menu.addItems(i)},OO.ui.MenuTagMultiselectWidget.prototype.createMenuOptionWidget=function(t,e,i){return new OO.ui.MenuOptionWidget({data:t,label:e||t,icon:i})},OO.ui.MenuTagMultiselectWidget.prototype.getMenu=function(){return this.menu},OO.ui.MenuTagMultiselectWidget.prototype.getAllowedValues=function(){var t=[];return this.menu&&(t=this.menu.getItems().map(function(t){return t.getData()})),this.allowedValues.concat(t)},OO.ui.SelectFileWidget=function(t){var e,i,n=this.constructor.static.isSupported();t=$.extend({notsupported:OO.ui.msg("ooui-selectfile-not-supported"),droppable:!0,buttonOnly:!1,showDropTarget:!1,thumbnailSizeLimit:20},t),n||(t.disabled=!0),OO.ui.SelectFileWidget.parent.call(this,t),OO.ui.mixin.PendingElement.call(this),n||this.info.setValue(t.notsupported),i=t.droppable&&n,this.showDropTarget=i&&t.showDropTarget&&!this.multiple,this.thumbnailSizeLimit=t.thumbnailSizeLimit,this.showDropTarget?(this.selectButton.setIcon("upload"),this.$thumbnail=$("<div>").addClass("oo-ui-selectFileWidget-thumbnail"),this.setPendingElement(this.$thumbnail),this.$element.addClass("oo-ui-selectFileWidget-dropTarget").on({click:this.onDropTargetClick.bind(this)}).append(this.$thumbnail,this.info.$element,this.selectButton.$element,$("<span>").addClass("oo-ui-selectFileWidget-dropLabel").text(OO.ui.msg("ooui-selectfile-dragdrop-placeholder"))),this.fieldLayout.$element.remove()):t.buttonOnly&&(this.selectButton.$element.addClass(this.$element.attr("class")).addClass("oo-ui-selectFileWidget-buttonOnly"),this.$element=this.selectButton.$element),i&&(e=this.onDragEnterOrOver.bind(this),this.$element.on({dragenter:e,dragover:e,dragleave:this.onDragLeave.bind(this),drop:this.onDrop.bind(this)})),this.$input.on("click",function(t){t.stopPropagation()}),this.$element.addClass("oo-ui-selectFileWidget"),this.updateUI()},OO.inheritClass(OO.ui.SelectFileWidget,OO.ui.SelectFileInputWidget),OO.mixinClass(OO.ui.SelectFileWidget,OO.ui.mixin.PendingElement),OO.ui.SelectFileWidget.static.isSupported=function(){var t;return null===OO.ui.SelectFileWidget.static.isSupportedCache&&(t=$("<input>").attr("type","file"),OO.ui.SelectFileWidget.static.isSupportedCache=void 0!==t[0].files),OO.ui.SelectFileWidget.static.isSupportedCache},OO.ui.SelectFileWidget.static.isSupportedCache=null,OO.ui.SelectFileWidget.prototype.getValue=function(){return this.multiple?this.currentFiles:this.currentFiles[0]},OO.ui.SelectFileWidget.prototype.setValue=function(t){function e(t){return $.extend({},t)}t&&!this.multiple&&(t=t.slice(0,1)),OO.compare(t&&t.map(e),this.currentFiles&&this.currentFiles.map(e))||(this.currentFiles=t||[],this.emit("change",this.currentFiles))},OO.ui.SelectFileWidget.prototype.getFilename=function(){return this.currentFiles.map(function(t){return t.name}).join(", ")},OO.ui.SelectFileWidget.prototype.onEdit=function(){},OO.ui.SelectFileWidget.prototype.updateUI=function(){this.selectButton&&this.constructor.static.isSupported()&&(OO.ui.SelectFileWidget.super.prototype.updateUI.call(this),this.currentFiles.length?(this.$element.removeClass("oo-ui-selectFileInputWidget-empty"),this.showDropTarget&&(this.pushPending(),this.loadAndGetImageUrl(this.currentFiles[0]).done(function(t){this.$thumbnail.css("background-image","url( "+t+" )")}.bind(this)).fail(function(){this.$thumbnail.append(new OO.ui.IconWidget({icon:"attachment",classes:["oo-ui-selectFileWidget-noThumbnail-icon"]}).$element)}.bind(this)).always(function(){this.popPending()}.bind(this)),this.$element.off("click"))):(this.showDropTarget&&(this.$element.off("click"),this.$element.on({click:this.onDropTargetClick.bind(this)}),this.$thumbnail.empty().css("background-image","")),this.$element.addClass("oo-ui-selectFileInputWidget-empty")))},OO.ui.SelectFileWidget.prototype.loadAndGetImageUrl=function(t){var i=$.Deferred(),e=new FileReader;return 0===(OO.getProp(t,"type")||"").indexOf("image/")&&t.size<1024*this.thumbnailSizeLimit*1024?(e.onload=function(t){var e=document.createElement("img");e.addEventListener("load",function(){0===e.naturalWidth||0===e.naturalHeight||!1===e.complete?i.reject():i.resolve(t.target.result)}),e.src=t.target.result},e.readAsDataURL(t)):i.reject(),i.promise()},OO.ui.SelectFileWidget.prototype.onFileSelected=function(t){var e;this.inputClearing||(e=this.filterFiles(t.target.files||[]),this.inputClearing=!0,this.$input[0].value="",this.inputClearing=!1,this.setValue(e))},OO.ui.SelectFileWidget.prototype.onDropTargetClick=function(){if(!this.isDisabled()&&this.$input)return this.$input.trigger("click"),!1},OO.ui.SelectFileWidget.prototype.onDragEnterOrOver=function(t){var e,i=!1,n=t.originalEvent.dataTransfer;return t.preventDefault(),t.stopPropagation(),this.isDisabled()?(this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),!(n.dropEffect="none")):((e=n.items||n.files)&&e.length?this.filterFiles(e).length&&(i=!0):-1!==Array.prototype.indexOf.call(OO.getProp(n,"types")||[],"Files")&&(i=!0),this.$element.toggleClass("oo-ui-selectFileWidget-canDrop",i),i||(n.dropEffect="none"),!1)},OO.ui.SelectFileWidget.prototype.onDragLeave=function(){this.$element.removeClass("oo-ui-selectFileWidget-canDrop")},OO.ui.SelectFileWidget.prototype.onDrop=function(t){var e,i=t.originalEvent.dataTransfer;return t.preventDefault(),t.stopPropagation(),this.$element.removeClass("oo-ui-selectFileWidget-canDrop"),this.isDisabled()||(e=this.filterFiles(i.files||[]),this.setValue(e)),!1},OO.ui.SelectFileWidget.prototype.setDisabled=function(t){t=t||!this.constructor.static.isSupported(),OO.ui.SelectFileWidget.parent.prototype.setDisabled.call(this,t)},OO.ui.SearchWidget=function(t){t=t||{},OO.ui.SearchWidget.parent.call(this,t),this.query=new OO.ui.TextInputWidget({icon:"search",placeholder:t.placeholder,value:t.value}),this.results=new OO.ui.SelectWidget,this.$query=$("<div>"),this.$results=$("<div>"),this.query.connect(this,{change:"onQueryChange",enter:"onQueryEnter"}),this.query.$input.on("keydown",this.onQueryKeydown.bind(this)),this.$query.addClass("oo-ui-searchWidget-query").append(this.query.$element),this.$results.addClass("oo-ui-searchWidget-results").append(this.results.$element),this.$element.addClass("oo-ui-searchWidget").append(this.$results,this.$query)},OO.inheritClass(OO.ui.SearchWidget,OO.ui.Widget),OO.ui.SearchWidget.prototype.onQueryKeydown=function(t){var e,i,n=t.which===OO.ui.Keys.DOWN?1:t.which===OO.ui.Keys.UP?-1:0;n&&(e=(e=this.results.findHighlightedItem())||this.results.findSelectedItem(),i=this.results.findRelativeSelectableItem(e,n),this.results.highlightItem(i),i.scrollElementIntoView())},OO.ui.SearchWidget.prototype.onQueryChange=function(){this.results.clearItems()},OO.ui.SearchWidget.prototype.onQueryEnter=function(){var t=this.results.findHighlightedItem();t&&this.results.chooseItem(t)},OO.ui.SearchWidget.prototype.getQuery=function(){return this.query},OO.ui.SearchWidget.prototype.getResults=function(){return this.results}}(OO),function(OO){"use strict";OO.ui.WikimediaUITheme=function(){OO.ui.WikimediaUITheme.parent.call(this)},OO.inheritClass(OO.ui.WikimediaUITheme,OO.ui.Theme),OO.ui.WikimediaUITheme.prototype.getElementClasses=function(t){var e,i,n,o,s={invert:!1,progressive:!1,destructive:!1,error:!1,warning:!1,success:!1},l=OO.ui.WikimediaUITheme.parent.prototype.getElementClasses.call(this,t);for(e in t instanceof OO.ui.IconWidget&&t.$element.hasClass("oo-ui-checkboxInputWidget-checkIcon")?s.invert=!0:t.supports(["hasFlag"])&&(i=t.supports(["isFramed"])&&t.isFramed(),n=t.supports(["isActive"])&&t.isActive(),o=OO.ui.Tool&&t instanceof OO.ui.Tool||OO.ui.ToolGroup&&t instanceof OO.ui.ToolGroup,i&&(n||t.isDisabled()||t.hasFlag("primary"))||o&&t.hasFlag("primary")?s.invert=!0:i||!t.isDisabled()||t.hasFlag("invert")?t.isDisabled()||(s.progressive=t.hasFlag("progressive")||o&&n||(t instanceof OO.ui.MenuOptionWidget||OO.ui.OutlineOptionWidget&&t instanceof OO.ui.OutlineOptionWidget)&&(t.isPressed()||t.isSelected()),s.destructive=t.hasFlag("destructive"),s.invert=t.hasFlag("invert"),s.error=t.hasFlag("error"),s.warning=t.hasFlag("warning"),s.success=t.hasFlag("success")):s.invert=!1),s)l[s[e]?"on":"off"].push("oo-ui-image-"+e);return l},OO.ui.WikimediaUITheme.prototype.getDialogTransitionDuration=function(){return 250},OO.ui.theme=new OO.ui.WikimediaUITheme}(OO);