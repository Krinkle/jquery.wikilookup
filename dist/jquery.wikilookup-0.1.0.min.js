!function(e){e.wikilookup||(e.wikilookup={})}(jQuery),$.wikilookup.tools={getPropValue:function(e,t){for(var i=e||{},n=0;i=i[t[n]],n++,i&&n<t.length;);return i}};var Api=function(e){e=e||{},this.cache={},this.standardURLs={restBase:"https://{{lang}}.wikipedia.org/api/rest_v1/page/summary/{{pageName}}",api:"https://{{lang}}.wikipedia.org/w/api.php"},this.lang=e.lang||"en",this.useRestbase=!!e.useRestbase,this.baseURL=e.baseURL,this.baseURL||(this.baseURL=this.useRestbase?this.standardURLs.restBase:this.standardURLs.api)};Api.prototype.getPageInfo=function(e){var t=this.getCacheKey(e);return this.cache[t]?$.Deferred().resolve(this.cache[t]):this.fetch(e).then(this.updateCache.bind(this,e))},Api.prototype.fetch=function(e){return $.ajax(this.getApiParams(e)).then(this.processApiResult.bind(this),function(){return"error"}).then(function(e){if("error"===e)return $.Deferred().reject("error")})},Api.prototype.processApiResult=function(e){var t,i;return e?this.useRestbase?"https://mediawiki.org/wiki/HyperSwitch/errors/not_found"===e.type?"missing":{title:e.displaytitle,content:e.extract,thumbnail:e.thumbnail,url:e.content_urls.desktop.page}:(t=(i=$.wikilookup.tools.getPropValue(e,["query","pages"]))[Object.keys(i)[0]])?{title:t.title,content:t.extract,thumbnail:t.thumbnail,url:t.canonicalurl}:"error":"error"},Api.prototype.updateCache=function(e,t){this.cache[this.getCacheKey(e)]=t},Api.prototype.getCacheKey=function(e){return e.trim().toLowerCase().replace(new RegExp(/\s/g),"_")},Api.prototype.getApiParams=function(e){var t=this.baseURL;return t=t.replace("{{lang}}",encodeURIComponent(this.lang)).replace("{{pageName}}",encodeURIComponent(e)),this.useRestbase?{url:t,data:{redirect:!0}}:{url:t,dataType:"jsonp",data:{action:"query",format:"json",prop:"info|pageimages|extracts",titles:e,inprop:"url",piprop:"thumbnail",pithumbsize:300,redirects:"1",explaintext:"1",exintro:"1"}}},$.wikilookup.Api=Api;var PageInfoWidget=function(e){e=e||{},this.$element=e.$element||$("<div>"),this.messages=$.extend({},{link:"Read more",pending:"",error:"There was a problem loading this page information."},e.messags),this.$pending=this.buildPending(),this.$view=this.buildView(),this.$error=this.buildError(),this.setState("pending"),this.$element.addClass("wl-pageInfoWidget").append(this.$pending,this.$error,this.$view)};PageInfoWidget.prototype.setState=function(t){var e=["pending","ready","error"];this.state!==t&&-1<e.indexOf(t)&&(e.forEach(function(e){this.$element.toggleClass("wl-pageInfoWidget-state-"+e,t===e)}.bind(this)),this.state=t)},PageInfoWidget.prototype.getState=function(){return this.state},PageInfoWidget.prototype.buildView=function(){return this.$title=$("<h1>").addClass("wl-pageInfoWidget-view-title"),this.$content=$("<div>").addClass("wl-pageInfoWidget-view-content"),this.$thumb=$("<div>").addClass("wl-pageInfoWidget-view-thumb"),this.$link=$("<a>").addClass("wl-pageInfoWidget-view-link").append(this.messages.link),$("<div>").append(this.$title,$("<div>").addClass("wl-pageInfoWidget-box").append(this.$content,this.$link),$("<div>").addClass("wl-pageInfoWidget-box").append(this.$thumb)).contents()},PageInfoWidget.prototype.setData=function(e){this.$title.text(e.title),this.$content.text(e.content),this.$thumb.css({backgroundImage:"url( "+e.source+" )",width:e.width,height:"100%",backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"}),this.$link.attr("href",e.url)},PageInfoWidget.prototype.buildPending=function(){return $("<div>").append(this.messages.pending)},PageInfoWidget.prototype.buildError=function(){return $("<div>").append(this.messages.error)},$.wikilookup.PageInfoWidget=PageInfoWidget;